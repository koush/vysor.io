function getWhitelist(e){chrome.storage.local.get("whitelist",function(t){var r={};if(!t.whitelist||t.whitelist.constructor.name!="Array"){e(r);return}$.each(t.whitelist,function(e,t){r[t]=true});e(r)})}function saveWhitelist(e,t){chrome.storage.local.set({whitelist:Object.keys(e)},t)}function addToWhitelist(e,t){getWhitelist(function(r){r[e]=true;saveWhitelist(r,t)})}function clearWhitelist(){chrome.storage.local.remove("whitelist")}function isWhitelisted(e,t){chrome.storage.local.get(["whitelist","serverMode"],function(r){if(r.serverMode==1){t(true);return}if(r.serverMode!=2){var i={};if(!r.whitelist||r.whitelist.constructor.name!="Array"){t(false,true);return}t(r.whitelist.indexOf(e)!=-1,true);return}getAuthToken(false,function(r){if(!r){console.error("unable to get token for vysor enterprise whitelist check");t(false);return}$.ajax({type:"get",url:"https://vysor-1026.appspot.com/whitelist",headers:{Authorization:"Bearer "+r},data:{email:e},error:function(){console.error("failure checking vysor enterprise whitelist",arguments);t(false)},success:function(r){if(!r.whitelist)console.error("access denied to",e,r);t(r.whitelist,false)}})})})}function getVysorWhitelistStatus(e){chrome.storage.local.get(["whitelist","serverMode"],function(t){if(t.serverMode==1){e("Any user can access this server.");return}if(t.serverMode==2){e("Your Vysor Enterprise users can access this server.");return}var r;if(!t.whitelist||t.whitelist.constructor.name!="Array")r=0;else r=t.whitelist.length;e(r+" user(s) can access this server.")})}$(document).ready(function(){getWhitelist(function(e){var t="// enter one email per line";$.each(Object.keys(e),function(e,r){t+="\n"+r});$("textarea").text(t)});chrome.storage.local.get("serverMode",function(e){$("#server-mode").prop("selectedIndex",e.serverMode||0).change()});$("#save").click(function(e){var t=$("textarea")[0].value;var r={};var i=t.split("\n");$.each(i,function(e,t){t=t.trim();if(t.startsWith("//")||!t.length)return;r[t]=true});saveWhitelist(r,function(){chrome.storage.local.set({serverMode:$("#server-mode")[0].selectedIndex},function(){chrome.app.window.current().close()})})});$("#server-mode").change(function(){if(this.selectedIndex)$("textarea").attr("disabled","disabled");else $("textarea").removeAttr("disabled")})});
