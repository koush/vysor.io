!function(t){function e(t){return n(t.length)+t}function n(t){for(var e=t.toString(16);e.length<4;)e="0"+e;return e}function i(t){return"ArrayBuffer"==t.constructor.name&&(t=new Uint8Array(t)),e=String.fromCharCode.apply(null,t),decodeURIComponent(escape(e));var e}function o(t,e,n){var i=(t=unescape(encodeURIComponent(t))).length;n&&i++,e||(e=new ArrayBuffer(i));var o=new Uint8Array(e);n&&(o[t.length]=0);for(var r=0,s=t.length;r<s;r++)o[r]=t.charCodeAt(r);return e}window.IS_RELEASE=!0,function(){var t,e;try{e=!navigator}catch(t){e=!0}if(e)t=global;else{t=window,window.exports=window,window.chrome||(window.chrome={});var n={"node-fetch":window.fetch,wrtc:window},i=window.require;window.require=function(t){if(t.startsWith("."))return window;var e=n[t];return e||(i?i.apply(null,arguments):window)}}t.isNode=function(){return e}}();var r="\n".charCodeAt(0);function s(t,e,n){"Object"==e.constructor.name&&(e=JSON.stringify(e)),l(t,e+"\n",n)}function c(t,e){var n=[];!function o(){t.read(function(s){for(var c=0;c<s.byteLength;c++)if(s[c]==r){var a=s.subarray(0,c);n.push(a);var u="";for(var l in n)u+=i(l=n[l]);var f=s.subarray(c+1);return t.unshift(f),void e(u)}n.push(s),o()})}()}function a(t,e,n){var i=function(i){if(4!=i.byteLength)return t.destroy(),void e(null);var r=new DataView(i.buffer,i.byteOffset,4).getInt32(0,n);t.read(r,o)},o=function(t){r(),e(t)},r=function(){t.read(4,i)};r()}function u(t,e){var n="";t.onClose=function(){e(n)},t.read(function e(o){n+=i(o),t.read(e)})}function l(t,e,n){"Object"==e.constructor.name&&(e=JSON.stringify(e)),t.write(o(e),n)}function f(t,e){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n}Uint8Array.prototype.sliceArrayBuffer=function(){return this.buffer.slice(this.byteOffset,this.byteOffset+this.byteLength)},Number.prototype.pad=function(t){for(var e=String(this);e.length<(t||2);)e="0"+e;return e};(new Date).getTime();function h(t){for(var e=new ArrayBuffer(t.length/2),n=new Uint8Array(e),i=0;i<t.length/2;i++){var o=t.substr(2*i,2);n[i]=parseInt(o,16)}return e}function d(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,o=0;o<i;o++)e+=String.fromCharCode(n[o]);return window.btoa(e)}function w(t,e){e||(e=window.location);for(var n=e.search.substring(1).split("&"),i=0;i<n.length;i++){var o=n[i].split("=");if(decodeURIComponent(o[0])==t)return decodeURIComponent(o[1])}}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}}),Object.fromArray=function(t){var e={};for(var n in t){var i=t[n];e[i]=i}return e};try{$.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var i=new XMLHttpRequest,o=t.url,r=t.type,s=t.async||!0,c=t.responseType||"blob",a=t.data||null,u=t.username||null,l=t.password||null;for(var f in i.addEventListener("load",function(){var e={};e[t.dataType]=i.response,n(i.status,i.statusText,e,i.getAllResponseHeaders())}),i.addEventListener("error",function(){n(i.status,i.statusText,null,i.getAllResponseHeaders())}),i.open(r,o,s,u,l),e)i.setRequestHeader(f,e[f]);i.responseType=c,i.send(a)},abort:function(){n.abort()}}})}catch(t){}function v(t,e,n,i,o){if(t||(t={items:[]}),t.items.push(e),!t.timeout){function r(){delete t.timeout,i(t.items),t.items=[]}o&&r(t.items),t.timeout=setTimeout(r,n)}return t}function p(t){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=t,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function y(t,e){if(console.log("notification:",t),window.chrome&&window.chrome.notifications){var n=chrome.runtime.getManifest(),i=n.name;e=e||n.icons[128],chrome.notifications.create({type:"basic",iconUrl:e,title:i,message:t})}}var m;m={};function g(){}function b(t,e){this.promise=fetch(t).then(function(t){this.connected=!0,this.response=t,this.reader=this.response.body.getReader(),this.reader.closed.then(function(){this.onClose&&this.dataReceived(null)}.bind(this)),this.onResume(),e(this)}.bind(this),function(t){e(null,t)})}function A(t){this.internalRead=this.read,this.read=this.readWrapper,this.file=t,this.fileRead=0}function S(t){t&&(this.dataReceived(t),this.dataReceived(null))}function k(){return{showSoftKeys:!0,pinTitleBar:!0,alwaysOnTop:!1,bitrate:0,resolution:0,decoder:0,displaySettings:I[0],dimDisplay:!1}}function x(t){return t?(t.friendlyName&&!t.friendlyName.length&&delete t.friendlyName,t):null}function E(t){window.chrome&&window.chrome.storage?chrome.storage.local.get("device-settings",function(e){t(e["device-settings"]||{})}):t({})}function T(t){$("#new-display-name").prop("value",t.friendlyName||null),$("#softkeys-check").prop("checked",!!t.showSoftKeys).change(),$("#pin-title-check").prop("checked",!!t.pinTitleBar).change(),$("#always-on-top-check").prop("checked",!!t.alwaysOnTop).change(),$("#bitrate").prop("selectedIndex",t.bitrate||0),$("#decoder").prop("selectedIndex",t.decoder||0),$("#resolution").prop("selectedIndex",t.resolution||0);var e=t.displaySettings&&t.displaySettings.name,n=0;for(var i in I){if(I[i].name==e){n=i;break}}$("#display-settings").prop("selectedIndex",n),$("#dim-display").prop("checked",!!t.dimDisplay),$("#auto-audio").prop("checked",!!t.autoAudio)}!function(){var t=function*(){}();t.constructor.prototype.async=function(){var e=this,n=e.next();if(!n.done){var i,o,r=new Promise(function(t,e){i=t,o=e});return a(),r}function s(){n=e.throw(new Error(arguments)),a()}function c(){var t=arguments[0];n=e.next(t),a()}function a(r){var a,u;if(n.done)i(n.value);else if(n.value)if(n.value.constructor!=Promise)if(n.value.constructor!=t.constructor){if(n.value==Error)a=!0,n=e.next(s);else{if(n.value!=g)throw new Error("Unexpected yield value for callback. Only Error and Success allowed.");u=!0,n=e.next(c)}if(!n.value)throw new Error("Double yield callbacks must explicitly define both Error and Success");if(n.value==Error&&a)throw new Error("Error callback already defined");if(n.value==g&&u)throw new Error("Success callback already defined");if(n.value!=Error&&n.value!=g)throw new Error("Unexpected yield value for callback. Only Error and Success allowed.");try{n=a?e.next(c):e.next(s)}catch(t){o(t)}}else n.value.async().then(c).catch(s);else n.value.then(c).catch(s);else n=e.next(c)}}}(),isNode()||(window.isElectron=function(){return-1!=navigator.userAgent.indexOf("Electron")},isElectron()||(window.sharedGlobals=window)),function(){if(!isNode()){var t="";if(window.IS_RELEASE){console.log,console.error,console.warn,console.info;function e(e){return function(){e.apply(console,arguments),function(e){try{for(var n in e)e[n]&&e[n].constructor!=String&&(e[n]=JSON.stringify(e[n]));t+=e.join(" ")+"\n"}catch(t){}}(Array.prototype.slice.call(arguments))}}console.error=e(console.error),console.log=e(console.log),console.warn=e(console.warn),console.info=e(console.info)}sharedGlobals.getConsoleLog=function(e){e(t)},window.gistConsoleLog=function(t,e){chrome.runtime.getBackgroundPage(function(i){n(i).then(function(e){t["background.txt"]=e;var i=chrome.app.window.getAll().map(function(e){return n(e.contentWindow).then(function(n){t["window-"+e.id+".txt"]=n})});return Promise.all(i)}).then(function(){var n={description:chrome.runtime.getManifest().name+" console log",public:!1,files:t};fetch("https://vysor.io/gist",{method:"POST",body:JSON.stringify(n)}).then(function(t){t.json().then(function(t){e(t.html_url)})})})})}}function n(t){return new Promise(function(e,n){t.getConsoleLog?t.getConsoleLog(function(t){e({content:t&&t.length?t:"log is empty"})}):e("getConsoleLog not found")})}}(),t.str2ab=o,t.ab2str=i,t.readString=u,t.readLine=c,t.writeString=l,function(){function t(t){this.buffer=new ArrayBuffer(t),this.dataView=new DataView(this.buffer),this.uint8array=new Uint8Array(this.buffer),this.littleEndian=!1,this.position=0,this.limit=t,this.capacity=t}function e(e,n){var i=e+8*n,o="get"+i,r="set"+i,s="put"+i;t.prototype[o]=function(){if(this.position+n>this.limit)throw new Error("Not enough room in byte buffer");var t=this.dataView[o](this.position,this.littleEndian);return this.position+=n,t},t.prototype[s]=function(t){if(this.position+n>this.limit)throw new Error("Not enough room in byte buffer");if(null==t||void 0==t||NaN==t||t.constructor!=Number)throw new Error("no value provided");return this.dataView[r](this.position,t,this.littleEndian),this.position+=n,this}}t.prototype.flip=function(){this.limit=this.position,this.position=0},t.prototype.asUint8Array=function(){return this.uint8array.subarray(this.position,this.limit)};var n={Int:[1,2,4],Uint:[1,2,4],Float:[4,8]};for(var i in n){var r=n[i];for(var s in r){e(i,s=r[s])}}t.prototype.put=function(t){if(t.constructor==Number)return this.putInt8(t);if(t.constructor==String&&(t=o(t)),t.constructor==ArrayBuffer&&(t=new Uint8Array(t)),this.position+t.byteLength>this.limit)throw new Error("Not enough room in byte buffer");return this.uint8array.set(t,this.position),this.position+=t.byteLength,this},t.prototype.putByte=t.prototype.putInt8,t.prototype.putShort=t.prototype.putInt16,t.prototype.putInt=t.prototype.putInt32,t.prototype.putFloat=t.prototype.putFloat32,t.prototype.putDouble=t.prototype.putFloat64,window.ByteBuffer=t}(),function(){try{var e=require("buffer").Buffer}catch(t){}function n(t,e){if(t.socketId)this.socketId=t.socketId,n.readers[this.socketId]=this;else if(chrome&&chrome.sockets)chrome.sockets.tcp.create(function(i){this.socketId=i.socketId,chrome.sockets.tcp.connect(this.socketId,t.host,t.port,function(t){t?(chrome.runtime.lastError,this.destroy(),e(null)):(n.readers[i.socketId]=this,e(this))}.bind(this))}.bind(this));else{var i;t.ns?(this.ns=t.ns,i=!0):(this.ns=new require("net").Socket(),this.ns.connect({port:t.port,host:t.host},function(){i=!0,e(this)}.bind(this))),this.ns.on("close",function(){this.destroy(),i||e(null)}.bind(this)),this.ns.on("data",function(t){this.dataReceived(t)}.bind(this))}}function i(){}chrome&&chrome.sockets&&(chrome.sockets.tcp.onReceive.addListener(function(t){var e=n.readers[t.socketId];null!=e&&e.dataReceived(new Uint8Array(t.data))}),chrome.sockets.tcp.onReceiveError.addListener(function(t){var e=n.readers[t.socketId];null!=e&&(e.destroy(),e.dataReceived(null))}),chrome.sockets.tcpServer.onAccept.addListener(function(t){chrome.sockets.tcp.setPaused(t.clientSocketId,!1);var e=i.listeners[t.socketId];null!=e&&e(new n({socketId:t.clientSocketId}))})),n.readers={},n.connect=function(t,e){return new n(t,e)},n.pump=function(t,e,n){if(!t||!e)return console.error("Socket.pump called with null socket",t,e),void n();var i=function(){t.read(o)}.bind(t),o=function(t){var n=t.buffer;(t.byteOffset||t.length!=n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+t.length)),e.write(n,i)}.bind(e);t.read(o),t.onClose=n},n.stream=function(t,e,i){n.pump(t,e,function(){if(e&&e.destroy(),i){var t=i;i=null,t()}}),n.pump(e,t,function(){if(t&&t.destroy(),i){var e=i;i=null,e()}})},n.eat=function(t){!function e(){t.read(e)}()},n.prototype.read=function(){if(this.pendingCallback)throw new Error("double callback");if(!this.closed||this.pending){var t=0;"Number"==arguments[t].constructor.name?this.pendingLength=arguments[t++]:this.pendingLength=0;a=arguments[t];if(this.pending&&!this.paused){if(this.pendingLength){if(this.pendingLength>this.buffered())return void(this.pendingCallback=a)}else this.pendingLength=this.buffered();for(var e,n=0;n<this.pendingLength;){var i=this.pending.shift();this.bufferedLength-=i.length,this.pending.length||delete this.pending;var o=i,r=Math.min(o.byteLength,this.pendingLength-n);if(r!=o.byteLength){var s=o.subarray(0,r),c=o.subarray(r);this.unshift(c),o=s}e||o.byteLength==this.pendingLength||(e=new Uint8Array(this.pendingLength)),e?e.set(o,n):e=o,n+=o.byteLength}a(e)}else this.pendingCallback=a}else{var a;(a=this.onClose)&&(delete this.onClose,a())}},n.prototype.write=function(t,n){if(this.pendingWrite)if(this.bufferWrites){null!=n&&console.error("using callbacks in buffered mode?");var i=this.pendingWrite;this.pendingWrite=function(){i&&i(),this.write(t,n)}.bind(this)}else console.error("write is already in progress!");if(null==n&&(this.bufferWrites||console.error("write callback is null?"),n=function(){}),this.pendingWrite=n,chrome&&chrome.sockets)chrome.sockets.tcp.send(this.socketId,t,function(e){chrome.runtime.lastError,e&&!e.resultCode?e.bytesSent<t.byteLength?this.write(t.slice(e.bytesSent),n):(delete this.pendingWrite,n()):delete this.pendingWrite}.bind(this));else{if(!this.ns)return;if(!t.byteLength)return void process.nextTick(function(){delete this.pendingWrite,n()}.bind(this));this.ns.write(e.from(t),function(){delete this.pendingWrite,n()}.bind(this))}},n.prototype.destroy=function(t,e){chrome&&chrome.sockets?chrome.sockets.tcp.close(this.socketId,function(){chrome.runtime.lastError}):(this.dataReceived(null),this.ns&&(this.ns.destroy(),delete this.ns))},n.prototype.unshift=function(t){0!=t.byteLength&&(this.pending?this.pending.unshift(t):this.pending=[t],this.bufferedLength||(this.bufferedLength=0),this.bufferedLength+=t.length)},n.prototype.dataReceived=function(t){if(t&&(t.asUint8Array&&(t=t.asUint8Array()),t.constructor==ArrayBuffer&&(t=new Uint8Array(t))),t&&t.length){var e=new Uint8Array(t);this.pending?this.pending.push(e):this.pending=[e]}if(null==t?this.closed=!0:(this.bufferedLength||(this.bufferedLength=0),this.bufferedLength+=t.length),!this.paused&&this.pending&&this.pending.length){var n=this.pendingLength;(i=this.pendingCallback)&&(delete this.pendingCallback,this.read(n,i))}else{var i=this.onClose;this.closed&&i&&(delete this.onClose,i())}},n.prototype.buffered=function(){return this.bufferedLength},n.prototype.pause=function(){this.paused||(this.paused=!0,this.onPause())},n.prototype.resume=function(){this.paused&&(this.paused=!1,this.onResume())},n.prototype.onResume=function(){chrome.sockets.tcp.setPaused(this.socketId,!1,function(){})},n.prototype.onPause=function(){chrome.sockets.tcp.setPaused(this.socketId,!0,function(){})},i.listeners={},i.prototype.__proto__=n.prototype,i.prototype.destroy=function(){chrome&&chrome.sockets?chrome.sockets.tcpServer.close(this.socketId,function(){chrome.runtime.lastError}):this.ns&&(this.ns.close(),delete this.ns)},i.prototype.listen=function(t,e,o){var r,s;"Number"==t.constructor.name?(r=t,s="0.0.0.0"):(s=t.address,r=t.port),chrome&&chrome.sockets?chrome.sockets.tcpServer.create(function(t){this.socketId=t.socketId,i.listeners[this.socketId]=e,chrome.sockets.tcpServer.listen(t.socketId,s,r,function(t){if(chrome.runtime.lastError,t)return this.destroy(),void(o&&o(t));chrome.sockets.tcpServer.getInfo(this.socketId,function(e){this.localAddress=e.localAddress,this.localPort=e.localPort,o&&o(t)}.bind(this))}.bind(this))}.bind(this)):(this.ns=require("net").createServer(function(t){e(new n({ns:t}))}.bind(this)),this.ns.on("close",function(){this.destroy()}.bind(this)),this.ns.on("error",function(t){o&&o(t)}.bind(this)),this.ns.on("listening",function(){var t=this.ns.address();this.localAddress=t.address,this.localPort=t.port,o&&o()}.bind(this)),this.ns.listen({port:r,host:s}))},t.Socket=n,t.Server=i}(),b.connect=function(t,e){new b(t,e)},b.prototype.write=function(t,e){throw new Error("write not supported on fetch socket")},b.prototype.destroy=function(){this.promise&&this.promise.cancel&&this.promise.cancel()},b.prototype.unshift=Socket.prototype.unshift,b.prototype.dataReceived=Socket.prototype.dataReceived,b.prototype.read=Socket.prototype.read,b.prototype.pause=Socket.prototype.pause,b.prototype.resume=Socket.prototype.resume,b.prototype.buffered=Socket.prototype.buffered,b.prototype.onPause=function(){},b.prototype.onResume=function(){this.reader.read().then(function(t){t.value&&(this.dataReceived(t.value),this.paused||this.onResume())}.bind(this))},A.prototype.write=function(t,e){throw new Error("write not supported on file socket")},A.prototype.destroy=function(){},A.prototype.buffered=Socket.prototype.buffered,A.prototype.unshift=Socket.prototype.unshift,A.prototype.dataReceived=Socket.prototype.dataReceived,A.prototype.read=Socket.prototype.read,A.prototype.pause=Socket.prototype.pause,A.prototype.resume=Socket.prototype.resume,A.prototype.buffered=Socket.prototype.buffered,A.prototype.onPause=function(){},A.prototype.onResume=function(){},A.prototype.readWrapper=function(){if(this.internalRead.apply(this,arguments),this.pendingCallback){var t=this.pendingLength;if(t||(t=65536),0!=(t=Math.min(this.file.size-this.fileRead,t))){var e=this.file.slice(this.fileRead,this.fileRead+t);this.fileRead+=t;var n=new FileReader;n.addEventListener("loadend",function(t){this.dataReceived(new Uint8Array(n.result))}.bind(this)),n.readAsArrayBuffer(e)}else this.dataReceived(null)}},function(){var e,n=require("wrtc"),i=n.RTCSessionDescription||n.webkitRTCSessionDescription,o=n.RTCPeerConnection||n.webkitRTCPeerConnection,r=n.RTCIceCandidate||n.webkitRTCIceCandidate,s=require("./socket").Socket,c=require("node-fetch"),{str2ab:a,ab2str:u}=require("../base/util");function l(t,e){this.conn=t,this.dc=e,this.gotEof=!1,e.onmessage=function(t){var e=new Uint8Array(t.data),n=1==e[e.byteLength-1];this.dataReceived(e.subarray(0,e.byteLength-1)),n&&(this.gotEof=!0,this.destroy())}.bind(this),e.onclose=e.onerror=this.destroy.bind(this),this.needsBufferShim=isNode()||parseInt(/Chrome\/(\d\d)/.exec(navigator.userAgent)[1])<70,this.needsBufferShim||(e.bufferedAmountLowThreshold=0,e.onbufferedamountlow=this.writeable.bind(this))}function f(t,e,n){this.manager=t,this.peerConnection=e,this.key=n,this.peerConnection.oniceconnectionstatechange=function(){"disconnected"!=this.peerConnection.iceConnectionState&&"closed"!=this.peerConnection.iceConnectionState&&"failed"!=this.peerConnection.iceConnectionState||this.destroy()}.bind(this)}function h(t,e,n){this.senders=t,this.registrationId=e,this.rtcc=n,this.gcmRtcConnections={},this.gcmRtcListeners={},this.amazonTokens={}}l.prototype.buffered=s.prototype.buffered,l.prototype.unshift=s.prototype.unshift,l.prototype.dataReceived=s.prototype.dataReceived,l.prototype.read=s.prototype.read,l.prototype.pause=s.prototype.pause,l.prototype.resume=s.prototype.resume,l.prototype.buffered=s.prototype.buffered,l.prototype.writeable=function(){var t=this.writeCallback;t&&(delete this.writeCallback,t())},l.prototype.write=function(t,e){if(this.dc&&"open"==this.dc.readyState){this.writeCallback=e;var n=new Uint8Array(t.byteLength+1);if(n.set(new Uint8Array(t)),this.dc.send(n.buffer),!this.reentrantWrite)try{for(this.reentrantWrite=!0;this.writeCallback&&(0==this.dc.bufferedAmount||this.needsBufferShim);)this.writeable();this.writeCallback&&console.log("waiting for writable")}finally{this.reentrantWrite=!1}}else this.destroy()},l.prototype.destroy=function(){if(this.dataReceived(null),null!=this.dc){var t=this.dc;if(this.dc=null,t.onclose=null,t.onerror=null,"open"==t.readyState)try{t.send(new Uint8Array([1])),this.gotEof?this.conn.recycleChannel(t):this.conn.waitForEof(t)}catch(t){}}},f.prototype.waitForCommand=function(t){t.onmessage=function(e){if(1!=e.data.byteLength){this.removeChannel(t);var n=u(e.data),i=new l(this,t);this.openSocket(n,i)}}.bind(this)},f.prototype.compactChannels=function(){this.inboundChannels&&!this.inboundChannels.length&&(this.inboundChannels=null),this.outboundChannels&&!this.outboundChannels.length&&(this.outboundChannels=null)},f.prototype.getAppropriateChannels=function(t,e){var n;return t.inbound?(!this.inboundChannels&&e&&(this.inboundChannels=[]),n=this.inboundChannels):(!this.outboundChannels&&e&&(this.outboundChannels=[]),n=this.outboundChannels),n},f.prototype.removeChannel=function(t){if(channels=this.getAppropriateChannels(t),channels){var e=channels.indexOf(t);-1!=e&&(channels.splice(e,1),this.compactChannels())}},f.prototype.waitForEof=function(t){t.onmessage=function(e){var n=new Uint8Array(e.data);1==n[n.byteLength-1]&&this.recycleChannel(t)}.bind(this)},f.prototype.recycleChannel=function(t){this.getAppropriateChannels(t,!0).push(t),t.onclose=t.onerror=function(){this.removeChannel(t)}.bind(this),this.waitForCommand(t)},f.prototype.addCandidates=function(t){for(var e in t.candidates)console.log("remote candidate",t.candidates[e]),this.peerConnection.addIceCandidate(new r(t.candidates[e]))},f.prototype.setupPinger=function(t){var e;t.onmessage=function(t){},t.onclose=t.onerror=function(){clearTimeout(e),this.destroy()}.bind(this),function n(){t.send(a("ping")),e=setTimeout(n,1e3)}()},f.prototype.listenSockets=function(){this.peerConnection.ondatachannel=function(t){t.channel.inbound=!0,this.waitForCommand(t.channel)}.bind(this)},f.prototype.prepareChannel=function(t){var e=this.peerConnection.createDataChannel(t||"gcm",{ordered:!0});return e.binaryType="arraybuffer",e},f.prototype.newSocket=function(t,e){if("closed"!=this.peerConnection.signalingState)if(this.outboundChannels){var n=this.outboundChannels.shift();this.compactChannels(),n.send(a(t));var i=new l(this,n);e(i,this)}else{var o;(n=this.prepareChannel("gcm")).onopen=function(){if(!o){o=!0,n.send(a(t));var i=new l(this,n);e(i,this)}}.bind(this),"open"==n.readyState&&n.onopen()}else e()},f.prototype.destroy=function(){delete this.manager.gcmRtcConnections[this.key],"closed"!=this.peerConnection.signalingState&&this.peerConnection.close();var t=this.onClose;t&&(delete this.onClose,t())},h.prototype.onMessage=function(t){var e=JSON.parse(t.message),n=t.type,i=t.senderId,o=t.src,r=t.srcPort,s=t.dst||this.registrationId,c=t.dstPort;if("offer"!=n){if("answer"==n){var a=h.getKey(o,r,c),u=this.gcmRtcConnections[a];return u?void u.manager.incoming(i,o,r,s,c,e):(console.error("pending connection not found"),void console.error(t))}h.onUnknownMessage?h.onUnknownMessage(t):console.log("unknown message "+n)}else{var l=this.gcmRtcListeners[c];l?l.listener.incoming(i,o,r,s,c,e,l.listenCallback):console.log("not listening on "+c)}},h.hasLoadedChannels=!1,h.start=function(t,e,n){if(console.log("starting GtcRtcManger"),chrome&&chrome.gcm){var i=Object.keys(t);chrome.gcm.register(i,function(i){if(chrome.runtime.lastError,i){var o=new h(t,i,e);chrome.gcm.onMessage.addListener(function(t){o.onMessage(t.data)}),n(o)}else n()})}else{function o(t){var e=t("https://push.clockworkmod.com");e.on("registration",function(t){t="web:"+t,r.registrationId?(r.registrationId=t,r.onRegistrationIdChanged&&r.onRegistrationIdChanged(t)):(r.registrationId=t,n(r))}),e.on("data",function(t){r.onMessage(t)})}var r=new h(t,null,e);if(isNode())o(require("socket.io-client"));else{s="https://push.clockworkmod.com/socket.io/socket.io.js",c=function(){o(io)},a=document.createElement("script"),u=document.getElementsByTagName("script")[0],a.async=1,a.onload=a.onreadystatechange=function(t,e){(e||!a.readyState||/loaded|complete/.test(a.readyState))&&(a.onload=a.onreadystatechange=null,a=void 0,e||c&&c())},a.src=s,u.parentNode.insertBefore(a,u)}}var s,c,a,u},h.prototype.wrapMessage=function(t,e,n,i,o,r,s){return{senderId:t,src:i,srcPort:o,dst:e,dstPort:n,type:r,message:JSON.stringify(s)}},h.prototype.sendGcm=function(t,e,n,i,o,r,s){var c=this.wrapMessage(t,e,n,i,o,r,s);return this.sendWrappedMessage(t,e,c)},h.prototype.sendWrappedMessage=function(t,e,n){if(t||(t=this.defaultSenderId),e.startsWith("web:"))return c(e.substring(4),{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(t=>t.json());if(e.startsWith("amzn")){var i;if(!this.amazonTokens[t]||this.amazonTokens[t].accessTokenExpiration<Date.now()){var o=this.senders[t];console.log(t,o);var r={grant_type:"client_credentials",scope:"messaging:push",client_id:t,client_secret:o},s=Object.entries(r).map(([t,e])=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");i=c("https://api.amazon.com/auth/O2/token",{method:"POST",body:s,headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(t=>t.json()).then(e=>(this.amazonTokens[t]={},this.amazonTokens[t].accessToken=e.access_token,this.amazonTokens[t].accessTokenExpiration=Date.now()+e.expires_in-30,e.access_token))}else console.log("token valid for",this.amazonTokens[t].accessTokenExpiration-Date.now()),i=Promise.resolve(this.amazonTokens[t].accessToken);return i.then(t=>c(`https://api.amazon.com/messaging/registrations/${e}/messages`,{method:"POST",body:JSON.stringify({data:n}),headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${t}`,"X-Amzn-Type-Version":"com.amazon.device.messaging.ADMMessage@1.0","X-Amzn-Accept-Type":"com.amazon.device.messaging.ADMSendResult@1.0"}}).then(t=>t.json()))}return c("https://fcm.googleapis.com/fcm/send",{method:"POST",body:JSON.stringify({to:e,data:n}),headers:{"Content-Type":"application/json",Authorization:"key="+this.senders[t]}}).then(t=>t.json())},h.getKey=function(t,e,n){return n+":"+e+":"+t},h.dictionaryKeys="0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p q r s t u v w x y z".split(" "),h.sdpDictionary={},h.addDictionary=function(t){var e=h.dictionaryKeys[Object.keys(h.sdpDictionary).length];h.sdpDictionary[e]=t},h.replaceAll=function(t,e,n){e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var i=new RegExp(e,"g");return t.replace(i,n)},h.compressSdp=function(t){for(var e in t=t.replace("\\","\\\\"),h.sdpDictionary){var n=h.sdpDictionary[e];t=h.replaceAll(t,n,"\\"+e)}return t},h.decompressSdp=function(t){for(var e in h.sdpDictionary){var n=h.sdpDictionary[e];t=t.replace(new RegExp(`([^\\\\])\\\\${e}`,"g"),"$1"+n)}return t},(e=h.addDictionary)("a=rtpmap:"),e("a=extmap:"),e("a=rtcp-fb:"),e("a=fmtp:"),e("level-asymmetry-allowed="),e("packetization-mode="),e("profile-level-id="),e("90000"),e("rtx/90000"),e("H264/90000"),e("transport-cc"),e("x-google-profile-id"),e("nack pli"),e("goog-remb"),e("ccm fir"),e("telephone-event/"),e("http://www.webrtc.org/experiments/rtp-hdrext/"),e("urn:ietf:params:rtp-hdrext:toffset"),e("http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e("urn:3gpp:video-orientation"),e("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"),e("http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"),e("http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"),e("http://www.webrtc.org/experiments/rtp-hdrext/video-timing"),e("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"),h.prototype.setupPeerConnection=function(t,e,n,i,r,s,c){var a,u=new o(this.rtcc),l=function(o){var a,u=[],l=c(),f=(l.sdp,{type:l.type,sdp:h.compressSdp(l.sdp)}),d=JSON.stringify(f).length;for(var w in o)null!=(w=o[w])&&(u.push(w),d+JSON.stringify(u).length>3200&&(a=!0,this.sendGcm(e,n,i,r,s,t,{desc:f,candidates:u}),u=[]));(u.length>0||!a)&&this.sendGcm(e,n,i,r,s,t,{desc:f,candidates:u})}.bind(this);u.onicecandidate=function(t){t.candidate?(console.log("candidate",t.candidate),a=function(t,e,n,i,o){if(t||(t={items:[]}),t.items.push(e),!t.timeout){function r(){delete t.timeout,i(t.items),t.items=[]}o&&r(t.items),t.timeout=setTimeout(r,n)}return t}(a,t.candidate,500,l)):console.log("done sending ice candidates")}.bind(this);var d=h.getKey(n,i,s),w=new f(this,u,d);return w.sendConnect=l,u.onsignalingstatechange=function(t){"stable"==u.signalingState?this.gcmRtcConnections[d]:"closed"==u.signalingState&&w.destroy()}.bind(this),this.gcmRtcConnections[d]=w,w},h.prototype.connect=function(t){return new Promise((e,n)=>{var i=t.senderId,o=t.registrationId,r=t.port;if(!o)throw new Error("registrationId was null on connect");var s,c=Math.random().toString(16),a=this.setupPeerConnection("offer",i,o,r,this.registrationId,c,function(){return s}),u=a.peerConnection;try{-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&t.offerToReceiveAudio&&t.offerToReceiveVideo&&(u.addTransceiver("audio"),u.addTransceiver("video"))}catch(t){}var l=setTimeout(function(){a.destroy(),n(new Error("Timeout waiting for RTC Connection"))},3e4);function f(t){u.createOffer(t).then(function(t){s=t,console.log(t),u.setLocalDescription(t),a.sendConnect([])})}if(t.offerToReceiveAudio||t.offerToReceiveVideo||t.audio){function h(){u.ontrack=function(t){console.log("got the remote stream"),clearTimeout(l),e(a)},f({offerToReceiveAudio:!!t.offerToReceiveAudio,offerToReceiveVideo:!!t.offerToReceiveVideo,voiceActivityDetection:!1})}if(!t.audio)return void h();navigator.webkitGetUserMedia({audio:!0,video:!1},function(t){u.addStream(t),h()},function(){console.error("audio fail",arguments),h()})}else{var d=a.prepareChannel("pinger");d.onopen=function(){console.log("got rtc pinger"),a.setupPinger(d),clearTimeout(l),e(a)},a.listenSockets(),f({})}})},h.prototype.isListening=function(t){return null!=this.gcmRtcListeners[t]},h.prototype.stopListen=function(t){delete this.gcmRtcListeners[t]},h.prototype.listen=function(t,e){this.gcmRtcListeners[t]?console.log("already listening on gcm port "+t):this.gcmRtcListeners[t]={listener:this,listenCallback:e}},h.prototype.incoming=function(t,e,n,o,r,s,c){var a=h.getKey(e,n,r),u=this.gcmRtcConnections[a];if(u){if(!u.remoteDesc){d=s.desc.sdp;s.desc.sdp=h.decompressSdp(d),u.remoteDesc=new i(s.desc),(f=u.peerConnection).setRemoteDescription(u.remoteDesc)}}else{if(!e)return void console.warn("received null registraition on incoming message. ignoring");var l;u=this.setupPeerConnection("answer",t,e,n,o,r,function(){return l});var f,d=s.desc.sdp;s.desc.sdp=h.decompressSdp(d),u.remoteDesc=new i(s.desc),(f=u.peerConnection).ondatachannel=function(t){console.log("got rtc pinger"),this.setupPinger(t.channel),c(u),this.listenSockets()}.bind(u),f.setRemoteDescription(u.remoteDesc,function(){f.createAnswer().then(function(t){l=t,f.setLocalDescription(t)},function(){console.error("answer error",arguments)})})}u.addCandidates(s)},t.GcmRtcSocket=l,t.GcmRtcManager=h}(),S.prototype.write=function(t,e){throw new Error("write not supported on dummy socket")},S.prototype.destroy=function(){this.dataReceived(null)},S.prototype.buffered=Socket.prototype.buffered,S.prototype.unshift=Socket.prototype.unshift,S.prototype.dataReceived=Socket.prototype.dataReceived,S.prototype.read=Socket.prototype.read,S.prototype.pause=Socket.prototype.pause,S.prototype.resume=Socket.prototype.resume,S.prototype.buffered=Socket.prototype.buffered,S.prototype.onPause=function(){},S.prototype.onResume=function(){},function(){var t={};function e(){}t.sendHostCommand=function(t,e){Socket.connect({host:"127.0.0.1",port:5037},function(r){if(r){var s=t;t=n(t.length)+t,r.read(4,function(t){var n=i(t);if("OKAY"!=n)return console.error("error in response to adb host command",s,n),r.destroy(),void e();r.read(4,function(t){var n=i(t);0!=(t=parseInt(n,16))&&"OKAY"!=n?r.read(t,function(t){e(r,t)}):e(r,new ArrayBuffer(0))})}),r.write(o(t),function(){})}else e()})},t.devices=function(e){var n={};function o(t){var e=t,i=(t=t.replace("\t"," ")).indexOf(" ");if(-1!=i){var o,r=t.substring(0,i);for(t=t.substring(i).trim();o!=t;)o=t,t=t.replace("  "," ");var s={},c=t.indexOf(" ");-1==c&&(c=t.length);var a,u=t.substring(0,c);for(t=t.substring(c+1);t.length&&-1!=(i=t.indexOf(":"));){var l,f=t.substring(0,i),h=t.substring(i+1),d=h.indexOf(" "),w=h.indexOf(":");if(-1==d||-1==w)l=h,t="";else for(;-1!=d&&d<w;)l=h.substring(0,d),t=h.substring(d+1),d=h.indexOf(" ",d+1);s[f]=l}a=s.model?s.model.replace("_"," "):r,n[r]={serialno:r,name:a,status:u,properties:e}}}t.sendHostCommand("host:devices-l",function(t,r){if(t){t.destroy(),r=i(r),console.log("ADB devices:",r);var s=(r=r.trim()).split("\n");for(var c in s)o(c=s[c]);console.log("parsed ADB devices:",n),e(n)}else e()})},t.killServer=function(e){t.sendHostCommand("host:kill-server",function(t,n){t?(t.destroy(),n=i(n),e&&e()):e()})},t.sendClientCommand=function(t,e){var r=t.command,s=t.serialno;Socket.connect({host:"127.0.0.1",port:5037},function(t){if(t){t.read(4,function(s){if("OKAY"!=i(s))return t.destroy(),void e(null);var c=r;c=n(c.length)+c,t.read(4,function(n){if("OKAY"!=i(n))return t.destroy(),void e(null);e(t)}),t.write(o(c),function(){})});var c="host:transport:"+s;c=n(c.length)+c,t.write(o(c),function(){})}else e()})},t.shell=function(e,n){var i=e.command;e.serialno;t.getOrCreateSockFactory(e).newSocket("shell:"+i,function(t){t?u(t,function(t){n(t)}):n()})},t.forward=function(e,n){var i="host-serial:"+e.serialno+":forward:"+e.from+";"+e.to;t.sendHostCommand(i,function(t,e){t&&t.destroy(),n(t,e)})},t.reverse=function(e,n){var i="reverse:forward:"+e.from+";"+e.to;t.sendClientCommand({serialno:e.serialno,command:i},function(t,e){t?u(t,n):n()})},e.MKID=function(t,e,n,i){return t.charCodeAt(0)|e.charCodeAt(0)<<8|n.charCodeAt(0)<<16|i.charCodeAt(0)<<24},e.ID_RECV=e.MKID("R","E","C","V"),e.ID_SEND=e.MKID("S","E","N","D"),e.ID_DONE=e.MKID("D","O","N","E"),e.ID_DATA=e.MKID("D","A","T","A"),e.DATA_MAX=65536,t.pull=function(n,i){var r,s=n.file,c=(n.serialno,n.fileEntry),a=n.socket;a||(a={write:function(t,e){r?(r.onwriteend=e,r.write(new Blob([t]))):c.createWriter(function(n){r=n,a.write(t,e)})}});var u=new S;Socket.pump(u,a,function(){i(c)}),t.getOrCreateSockFactory(n).newSocket("sync:",function(t){if(t){var n=new ArrayBuffer(8),r=new DataView(n);r.setUint32(0,e.ID_RECV,!0),r.setUint32(4,s.length,!0),t.write(n,function(){t.write(o(s),function(){c()})})}else i();function c(){t.read(8,function(n){var o=new DataView(n.buffer,n.byteOffset,n.byteLength),r=o.getUint32(0,!0);r!=e.ID_DATA?(t.destroy(),r!=e.ID_DONE?i():u.dataReceived(null)):function(e){t.read(e,function(t){u.dataReceived(t),c()})}(o.getUint32(4,!0))})}})},t.createSocketFactory=function(e){return{newSocket:function(n,i){t.sendClientCommand({serialno:e,command:n},i)}}},t.getOrCreateSockFactory=function(e){return e.socketFactory||t.createSocketFactory(e.serialno)},t.push=function(n,i){var r=n.file,s=(n.serialno,n.socket);t.getOrCreateSockFactory(n).newSocket("sync:",function(t){if(t){var n=new ArrayBuffer(8),c=new DataView(n),a=r+",0644";c.setUint32(0,e.ID_SEND,!0),c.setUint32(4,a.length,!0),t.write(n,function(){t.write(o(a),function(){function n(){s.read(function(i){if(i.byteLength>e.DATA_MAX){var o=i.subarray(e.DATA_MAX);i=i.subarray(0,e.DATA_MAX),s.unshift(o)}!function(i){var o=new ArrayBuffer(8),r=new DataView(o);r.setUint32(0,e.ID_DATA,!0),r.setUint32(4,i.byteLength,!0),t.write(o,function(){var e=i.buffer;(i.byteOffset||i.length!=e.byteLength)&&(e=e.slice(i.byteOffset,i.byteOffset+i.byteLength)),t.write(e,function(){n()})})}(i)})}s.onClose=function(){var n=new ArrayBuffer(8),o=new DataView(n);o.setUint32(0,e.ID_DONE,!0),o.setUint32(4,0,!0),t.write(n,function(){t.read(8,function(){i()})})},n()})})}else i()})},window.Adb=t}();var I=[{name:"Default Settings",size:"reset",density:"reset"},{name:"Resizable (96dpi)",size:"reset",density:"96",freeSize:!0},{name:"Resizable (144dpi)",size:"reset",density:"144",freeSize:!0},{name:"1080p (96dpi)",size:"1920x1080",density:"96"},{name:"4K (144dpi)",size:"3840x2160",density:"144"},{name:"Galaxy Nexus",size:"720x1280",density:"320"},{name:"Nexus 4",size:"768x1280",density:"320"},{name:"Nexus 5",size:"1080x1920",density:"480"},{name:"Nexus 6",size:"1440x2560",density:"560"},{name:"Nexus 6p",size:"1440x2560",density:"560"},{name:"Nexus 7 (2012)",size:"800x1280",density:"213"},{name:"Nexus 7 (2013)",size:"1200x1920",density:"320"},{name:"Nexus 9",size:"1536x2048",density:"320"}];function N(t){var e,n=$("#notificationModal"),i=n.find("#modal-ok"),o=n.find("#modal-cancel");i.unbind("click"),o.unbind("click"),n.unbind("hidden.bs.modal"),t.cancelButton=t.cancelButton||"Cancel",t.okButton=t.okButton||"OK",t.title=t.title||chrome.runtime.getManifest().name,t.body=t.body||"",t.hideCancel?o.hide():o.show(),i.text(t.okButton),o.text(t.cancelButton),n.find("#modal-title").text(t.title),n.find("#modal-body").html(t.body),i.click(function(){e=!0,t.ok&&t.ok()||$("#notificationModal").modal("hide")}),t.cancel&&(n.on("hidden.bs.modal",function(){e||t.cancel()}),o.click(t.cancel)),$("#notificationModal").modal(),t.duration&&setTimeout(function(){$("#notificationModal").modal("hide")},t.duration)}function R(t,e){N({title:t,body:e,duration:8e3,hideCancel:!0})}$protobuf=protobuf;var C,O,_,D,U,V=$protobuf.Reader,B=$protobuf.Writer,M=$protobuf.util,z=$protobuf.roots.default||($protobuf.roots.default={});function P(t){this.context=t,this.numSamples=1024,this.numSamplesDiv2=this.numSamples/2,this.numSamplesDiv4=this.numSamples/4,this.cleanup=this.numSamples/2,this.samples=new Array(this.numSamples),this.lastIndex=0}function j(){(this.audioListener=new Server).listen({port:0,address:"127.0.0.1"},function(t){t.bufferWrites=!0,a(t,function(e){if(e){var n,i=$protobuf.roots.default.cast_channel.CastMessage.decode(e);i.payloadUtf8&&(n=JSON.parse(i.payloadUtf8)),console.log("received",i,n);var o=this.onMessage[i.namespace];o?o.bind(this)(t,i,n).async():console.error("unhandled cast message",i)}}.bind(this))}.bind(this),function(){this.onListening&&this.onListening()}.bind(this)),this.castId="fb720c4cbabca202da80e378fc8474dee136e04f"}function F(){var t,e,n,i;$("#listener2").empty(),isElectron()?(t="host",e=null,n="application/x-ppapi-vysor-audio"):(t="pnacl",e="audio_playback/pnacl/Release",n=null),common2.createNaClModule("audio_playback",n,t,e,1,1,{},function(t){}.bind(this),function(){if(i)return console.error("NACL module has already initalized"),console.error(i),void console.error(new Error("NACL New Initialization Stack"));i=new Error("NACL Initialization Stack"),console.log("NACL Audio module initialized")}.bind(this))}function q(t,e,n){var i,o,r,s;$("#listener").empty(),isElectron()?(i="host",o=null,r="application/x-ppapi-vysor"):(i="pnacl",o="video_decode/pnacl/Release",r=null),common.createNaClModule("video_decode",r,i,o,t,e,{},function(t){"decoder-falling-behind"==t.data?this.onDecoderFallingBehind&&this.onDecoderFallingBehind():"paint-falling-behind"==t.data||("graphics-context-null"==t.data?N({title:"Graphics Error: assert !context_->is_null()",body:'Vysor encountered an error with your graphics card. There is a possible solution available on the <a href="https://support.vysor.io/support/technical/graphics/" target="_blank">support page</a>.',hideCancel:!0}):"decoder-ready"==t.data&&(this.onReady?this.onReady():console.error("no listener for decoder-ready")))}.bind(this),function(){if(s)return console.error("NACL module has already initalized"),console.error(s),void console.error(new Error("NACL New Initialization Stack"));s=new Error("NACL Initialization Stack"),console.log("NACL module initialized"),console.log("decoder:",n),common.naclModule.postMessage(n)}.bind(this))}z.cast_channel=((_={}).CastMessage=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.protocolVersion=0,t.prototype.sourceId="",t.prototype.destinationId="",t.prototype.namespace="",t.prototype.payloadType=0,t.prototype.payloadUtf8="",t.prototype.payloadBinary=M.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=B.create()),e.uint32(8).int32(t.protocolVersion),e.uint32(18).string(t.sourceId),e.uint32(26).string(t.destinationId),e.uint32(34).string(t.namespace),e.uint32(40).int32(t.payloadType),null!=t.payloadUtf8&&t.hasOwnProperty("payloadUtf8")&&e.uint32(50).string(t.payloadUtf8),null!=t.payloadBinary&&t.hasOwnProperty("payloadBinary")&&e.uint32(58).bytes(t.payloadBinary),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof V||(t=V.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new z.cast_channel.CastMessage;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.protocolVersion=t.int32();break;case 2:i.sourceId=t.string();break;case 3:i.destinationId=t.string();break;case 4:i.namespace=t.string();break;case 5:i.payloadType=t.int32();break;case 6:i.payloadUtf8=t.string();break;case 7:i.payloadBinary=t.bytes();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("protocolVersion"))throw M.ProtocolError("missing required 'protocolVersion'",{instance:i});if(!i.hasOwnProperty("sourceId"))throw M.ProtocolError("missing required 'sourceId'",{instance:i});if(!i.hasOwnProperty("destinationId"))throw M.ProtocolError("missing required 'destinationId'",{instance:i});if(!i.hasOwnProperty("namespace"))throw M.ProtocolError("missing required 'namespace'",{instance:i});if(!i.hasOwnProperty("payloadType"))throw M.ProtocolError("missing required 'payloadType'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof V||(t=new V(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.protocolVersion){default:return"protocolVersion: enum value expected";case 0:}if(!M.isString(t.sourceId))return"sourceId: string expected";if(!M.isString(t.destinationId))return"destinationId: string expected";if(!M.isString(t.namespace))return"namespace: string expected";switch(t.payloadType){default:return"payloadType: enum value expected";case 0:case 1:}return null!=t.payloadUtf8&&t.hasOwnProperty("payloadUtf8")&&!M.isString(t.payloadUtf8)?"payloadUtf8: string expected":null!=t.payloadBinary&&t.hasOwnProperty("payloadBinary")&&!(t.payloadBinary&&"number"==typeof t.payloadBinary.length||M.isString(t.payloadBinary))?"payloadBinary: buffer expected":null},t.fromObject=function(t){if(t instanceof z.cast_channel.CastMessage)return t;var e=new z.cast_channel.CastMessage;switch(t.protocolVersion){case"CASTV2_1_0":case 0:e.protocolVersion=0}switch(null!=t.sourceId&&(e.sourceId=String(t.sourceId)),null!=t.destinationId&&(e.destinationId=String(t.destinationId)),null!=t.namespace&&(e.namespace=String(t.namespace)),t.payloadType){case"STRING":case 0:e.payloadType=0;break;case"BINARY":case 1:e.payloadType=1}return null!=t.payloadUtf8&&(e.payloadUtf8=String(t.payloadUtf8)),null!=t.payloadBinary&&("string"==typeof t.payloadBinary?M.base64.decode(t.payloadBinary,e.payloadBinary=M.newBuffer(M.base64.length(t.payloadBinary)),0):t.payloadBinary.length&&(e.payloadBinary=t.payloadBinary)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.protocolVersion=e.enums===String?"CASTV2_1_0":0,n.sourceId="",n.destinationId="",n.namespace="",n.payloadType=e.enums===String?"STRING":0,n.payloadUtf8="",e.bytes===String?n.payloadBinary="":(n.payloadBinary=[],e.bytes!==Array&&(n.payloadBinary=M.newBuffer(n.payloadBinary)))),null!=t.protocolVersion&&t.hasOwnProperty("protocolVersion")&&(n.protocolVersion=e.enums===String?z.cast_channel.CastMessage.ProtocolVersion[t.protocolVersion]:t.protocolVersion),null!=t.sourceId&&t.hasOwnProperty("sourceId")&&(n.sourceId=t.sourceId),null!=t.destinationId&&t.hasOwnProperty("destinationId")&&(n.destinationId=t.destinationId),null!=t.namespace&&t.hasOwnProperty("namespace")&&(n.namespace=t.namespace),null!=t.payloadType&&t.hasOwnProperty("payloadType")&&(n.payloadType=e.enums===String?z.cast_channel.CastMessage.PayloadType[t.payloadType]:t.payloadType),null!=t.payloadUtf8&&t.hasOwnProperty("payloadUtf8")&&(n.payloadUtf8=t.payloadUtf8),null!=t.payloadBinary&&t.hasOwnProperty("payloadBinary")&&(n.payloadBinary=e.bytes===String?M.base64.encode(t.payloadBinary,0,t.payloadBinary.length):e.bytes===Array?Array.prototype.slice.call(t.payloadBinary):t.payloadBinary),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.ProtocolVersion=(e={},(n=Object.create(e))[e[0]="CASTV2_1_0"]=0,n),t.PayloadType=function(){var t={},e=Object.create(t);return e[t[0]="STRING"]=0,e[t[1]="BINARY"]=1,e}(),t}(),_.SignatureAlgorithm=(C={},(O=Object.create(C))[C[0]="UNSPECIFIED"]=0,O[C[1]="RSASSA_PKCS1v15"]=1,O[C[2]="RSASSA_PSS"]=2,O),_.HashAlgorithm=function(){var t={},e=Object.create(t);return e[t[0]="SHA1"]=0,e[t[1]="SHA256"]=1,e}(),_.AuthChallenge=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.signatureAlgorithm=1,t.prototype.senderNonce=M.newBuffer([]),t.prototype.hashAlgorithm=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=B.create()),null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm")&&e.uint32(8).int32(t.signatureAlgorithm),null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&e.uint32(18).bytes(t.senderNonce),null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm")&&e.uint32(24).int32(t.hashAlgorithm),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof V||(t=V.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new z.cast_channel.AuthChallenge;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.signatureAlgorithm=t.int32();break;case 2:i.senderNonce=t.bytes();break;case 3:i.hashAlgorithm=t.int32();break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof V||(t=new V(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm"))switch(t.signatureAlgorithm){default:return"signatureAlgorithm: enum value expected";case 0:case 1:case 2:}if(null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&!(t.senderNonce&&"number"==typeof t.senderNonce.length||M.isString(t.senderNonce)))return"senderNonce: buffer expected";if(null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm"))switch(t.hashAlgorithm){default:return"hashAlgorithm: enum value expected";case 0:case 1:}return null},t.fromObject=function(t){if(t instanceof z.cast_channel.AuthChallenge)return t;var e=new z.cast_channel.AuthChallenge;switch(t.signatureAlgorithm){case"UNSPECIFIED":case 0:e.signatureAlgorithm=0;break;case"RSASSA_PKCS1v15":case 1:e.signatureAlgorithm=1;break;case"RSASSA_PSS":case 2:e.signatureAlgorithm=2}switch(null!=t.senderNonce&&("string"==typeof t.senderNonce?M.base64.decode(t.senderNonce,e.senderNonce=M.newBuffer(M.base64.length(t.senderNonce)),0):t.senderNonce.length&&(e.senderNonce=t.senderNonce)),t.hashAlgorithm){case"SHA1":case 0:e.hashAlgorithm=0;break;case"SHA256":case 1:e.hashAlgorithm=1}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.signatureAlgorithm=e.enums===String?"RSASSA_PKCS1v15":1,e.bytes===String?n.senderNonce="":(n.senderNonce=[],e.bytes!==Array&&(n.senderNonce=M.newBuffer(n.senderNonce))),n.hashAlgorithm=e.enums===String?"SHA1":0),null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm")&&(n.signatureAlgorithm=e.enums===String?z.cast_channel.SignatureAlgorithm[t.signatureAlgorithm]:t.signatureAlgorithm),null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&(n.senderNonce=e.bytes===String?M.base64.encode(t.senderNonce,0,t.senderNonce.length):e.bytes===Array?Array.prototype.slice.call(t.senderNonce):t.senderNonce),null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm")&&(n.hashAlgorithm=e.enums===String?z.cast_channel.HashAlgorithm[t.hashAlgorithm]:t.hashAlgorithm),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t}(),_.AuthResponse=function(){function t(t){if(this.intermediateCertificate=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.signature=M.newBuffer([]),t.prototype.clientAuthCertificate=M.newBuffer([]),t.prototype.intermediateCertificate=M.emptyArray,t.prototype.signatureAlgorithm=1,t.prototype.senderNonce=M.newBuffer([]),t.prototype.hashAlgorithm=0,t.prototype.crl=M.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=B.create()),e.uint32(10).bytes(t.signature),e.uint32(18).bytes(t.clientAuthCertificate),null!=t.intermediateCertificate&&t.intermediateCertificate.length)for(var n=0;n<t.intermediateCertificate.length;++n)e.uint32(26).bytes(t.intermediateCertificate[n]);return null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm")&&e.uint32(32).int32(t.signatureAlgorithm),null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&e.uint32(42).bytes(t.senderNonce),null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm")&&e.uint32(48).int32(t.hashAlgorithm),null!=t.crl&&t.hasOwnProperty("crl")&&e.uint32(58).bytes(t.crl),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof V||(t=V.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new z.cast_channel.AuthResponse;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.signature=t.bytes();break;case 2:i.clientAuthCertificate=t.bytes();break;case 3:i.intermediateCertificate&&i.intermediateCertificate.length||(i.intermediateCertificate=[]),i.intermediateCertificate.push(t.bytes());break;case 4:i.signatureAlgorithm=t.int32();break;case 5:i.senderNonce=t.bytes();break;case 6:i.hashAlgorithm=t.int32();break;case 7:i.crl=t.bytes();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("signature"))throw M.ProtocolError("missing required 'signature'",{instance:i});if(!i.hasOwnProperty("clientAuthCertificate"))throw M.ProtocolError("missing required 'clientAuthCertificate'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof V||(t=new V(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(!(t.signature&&"number"==typeof t.signature.length||M.isString(t.signature)))return"signature: buffer expected";if(!(t.clientAuthCertificate&&"number"==typeof t.clientAuthCertificate.length||M.isString(t.clientAuthCertificate)))return"clientAuthCertificate: buffer expected";if(null!=t.intermediateCertificate&&t.hasOwnProperty("intermediateCertificate")){if(!Array.isArray(t.intermediateCertificate))return"intermediateCertificate: array expected";for(var e=0;e<t.intermediateCertificate.length;++e)if(!(t.intermediateCertificate[e]&&"number"==typeof t.intermediateCertificate[e].length||M.isString(t.intermediateCertificate[e])))return"intermediateCertificate: buffer[] expected"}if(null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm"))switch(t.signatureAlgorithm){default:return"signatureAlgorithm: enum value expected";case 0:case 1:case 2:}if(null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&!(t.senderNonce&&"number"==typeof t.senderNonce.length||M.isString(t.senderNonce)))return"senderNonce: buffer expected";if(null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm"))switch(t.hashAlgorithm){default:return"hashAlgorithm: enum value expected";case 0:case 1:}return null!=t.crl&&t.hasOwnProperty("crl")&&!(t.crl&&"number"==typeof t.crl.length||M.isString(t.crl))?"crl: buffer expected":null},t.fromObject=function(t){if(t instanceof z.cast_channel.AuthResponse)return t;var e=new z.cast_channel.AuthResponse;if(null!=t.signature&&("string"==typeof t.signature?M.base64.decode(t.signature,e.signature=M.newBuffer(M.base64.length(t.signature)),0):t.signature.length&&(e.signature=t.signature)),null!=t.clientAuthCertificate&&("string"==typeof t.clientAuthCertificate?M.base64.decode(t.clientAuthCertificate,e.clientAuthCertificate=M.newBuffer(M.base64.length(t.clientAuthCertificate)),0):t.clientAuthCertificate.length&&(e.clientAuthCertificate=t.clientAuthCertificate)),t.intermediateCertificate){if(!Array.isArray(t.intermediateCertificate))throw TypeError(".cast_channel.AuthResponse.intermediateCertificate: array expected");e.intermediateCertificate=[];for(var n=0;n<t.intermediateCertificate.length;++n)"string"==typeof t.intermediateCertificate[n]?M.base64.decode(t.intermediateCertificate[n],e.intermediateCertificate[n]=M.newBuffer(M.base64.length(t.intermediateCertificate[n])),0):t.intermediateCertificate[n].length&&(e.intermediateCertificate[n]=t.intermediateCertificate[n])}switch(t.signatureAlgorithm){case"UNSPECIFIED":case 0:e.signatureAlgorithm=0;break;case"RSASSA_PKCS1v15":case 1:e.signatureAlgorithm=1;break;case"RSASSA_PSS":case 2:e.signatureAlgorithm=2}switch(null!=t.senderNonce&&("string"==typeof t.senderNonce?M.base64.decode(t.senderNonce,e.senderNonce=M.newBuffer(M.base64.length(t.senderNonce)),0):t.senderNonce.length&&(e.senderNonce=t.senderNonce)),t.hashAlgorithm){case"SHA1":case 0:e.hashAlgorithm=0;break;case"SHA256":case 1:e.hashAlgorithm=1}return null!=t.crl&&("string"==typeof t.crl?M.base64.decode(t.crl,e.crl=M.newBuffer(M.base64.length(t.crl)),0):t.crl.length&&(e.crl=t.crl)),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.intermediateCertificate=[]),e.defaults&&(e.bytes===String?n.signature="":(n.signature=[],e.bytes!==Array&&(n.signature=M.newBuffer(n.signature))),e.bytes===String?n.clientAuthCertificate="":(n.clientAuthCertificate=[],e.bytes!==Array&&(n.clientAuthCertificate=M.newBuffer(n.clientAuthCertificate))),n.signatureAlgorithm=e.enums===String?"RSASSA_PKCS1v15":1,e.bytes===String?n.senderNonce="":(n.senderNonce=[],e.bytes!==Array&&(n.senderNonce=M.newBuffer(n.senderNonce))),n.hashAlgorithm=e.enums===String?"SHA1":0,e.bytes===String?n.crl="":(n.crl=[],e.bytes!==Array&&(n.crl=M.newBuffer(n.crl)))),null!=t.signature&&t.hasOwnProperty("signature")&&(n.signature=e.bytes===String?M.base64.encode(t.signature,0,t.signature.length):e.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),null!=t.clientAuthCertificate&&t.hasOwnProperty("clientAuthCertificate")&&(n.clientAuthCertificate=e.bytes===String?M.base64.encode(t.clientAuthCertificate,0,t.clientAuthCertificate.length):e.bytes===Array?Array.prototype.slice.call(t.clientAuthCertificate):t.clientAuthCertificate),t.intermediateCertificate&&t.intermediateCertificate.length){n.intermediateCertificate=[];for(var i=0;i<t.intermediateCertificate.length;++i)n.intermediateCertificate[i]=e.bytes===String?M.base64.encode(t.intermediateCertificate[i],0,t.intermediateCertificate[i].length):e.bytes===Array?Array.prototype.slice.call(t.intermediateCertificate[i]):t.intermediateCertificate[i]}return null!=t.signatureAlgorithm&&t.hasOwnProperty("signatureAlgorithm")&&(n.signatureAlgorithm=e.enums===String?z.cast_channel.SignatureAlgorithm[t.signatureAlgorithm]:t.signatureAlgorithm),null!=t.senderNonce&&t.hasOwnProperty("senderNonce")&&(n.senderNonce=e.bytes===String?M.base64.encode(t.senderNonce,0,t.senderNonce.length):e.bytes===Array?Array.prototype.slice.call(t.senderNonce):t.senderNonce),null!=t.hashAlgorithm&&t.hasOwnProperty("hashAlgorithm")&&(n.hashAlgorithm=e.enums===String?z.cast_channel.HashAlgorithm[t.hashAlgorithm]:t.hashAlgorithm),null!=t.crl&&t.hasOwnProperty("crl")&&(n.crl=e.bytes===String?M.base64.encode(t.crl,0,t.crl.length):e.bytes===Array?Array.prototype.slice.call(t.crl):t.crl),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t}(),_.AuthError=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.errorType=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=B.create()),e.uint32(8).int32(t.errorType),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof V||(t=V.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new z.cast_channel.AuthError;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.errorType=t.int32();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("errorType"))throw M.ProtocolError("missing required 'errorType'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof V||(t=new V(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.errorType){default:return"errorType: enum value expected";case 0:case 1:case 2:}return null},t.fromObject=function(t){if(t instanceof z.cast_channel.AuthError)return t;var e=new z.cast_channel.AuthError;switch(t.errorType){case"INTERNAL_ERROR":case 0:e.errorType=0;break;case"NO_TLS":case 1:e.errorType=1;break;case"SIGNATURE_ALGORITHM_UNAVAILABLE":case 2:e.errorType=2}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.errorType=e.enums===String?"INTERNAL_ERROR":0),null!=t.errorType&&t.hasOwnProperty("errorType")&&(n.errorType=e.enums===String?z.cast_channel.AuthError.ErrorType[t.errorType]:t.errorType),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.ErrorType=(e={},(n=Object.create(e))[e[0]="INTERNAL_ERROR"]=0,n[e[1]="NO_TLS"]=1,n[e[2]="SIGNATURE_ALGORITHM_UNAVAILABLE"]=2,n),t}(),_.DeviceAuthMessage=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.challenge=null,t.prototype.response=null,t.prototype.error=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=B.create()),null!=t.challenge&&t.hasOwnProperty("challenge")&&z.cast_channel.AuthChallenge.encode(t.challenge,e.uint32(10).fork()).ldelim(),null!=t.response&&t.hasOwnProperty("response")&&z.cast_channel.AuthResponse.encode(t.response,e.uint32(18).fork()).ldelim(),null!=t.error&&t.hasOwnProperty("error")&&z.cast_channel.AuthError.encode(t.error,e.uint32(26).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof V||(t=V.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new z.cast_channel.DeviceAuthMessage;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.challenge=z.cast_channel.AuthChallenge.decode(t,t.uint32());break;case 2:i.response=z.cast_channel.AuthResponse.decode(t,t.uint32());break;case 3:i.error=z.cast_channel.AuthError.decode(t,t.uint32());break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof V||(t=new V(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.challenge&&t.hasOwnProperty("challenge")&&(e=z.cast_channel.AuthChallenge.verify(t.challenge))?"challenge."+e:null!=t.response&&t.hasOwnProperty("response")&&(e=z.cast_channel.AuthResponse.verify(t.response))?"response."+e:null!=t.error&&t.hasOwnProperty("error")&&(e=z.cast_channel.AuthError.verify(t.error))?"error."+e:null;var e},t.fromObject=function(t){if(t instanceof z.cast_channel.DeviceAuthMessage)return t;var e=new z.cast_channel.DeviceAuthMessage;if(null!=t.challenge){if("object"!=typeof t.challenge)throw TypeError(".cast_channel.DeviceAuthMessage.challenge: object expected");e.challenge=z.cast_channel.AuthChallenge.fromObject(t.challenge)}if(null!=t.response){if("object"!=typeof t.response)throw TypeError(".cast_channel.DeviceAuthMessage.response: object expected");e.response=z.cast_channel.AuthResponse.fromObject(t.response)}if(null!=t.error){if("object"!=typeof t.error)throw TypeError(".cast_channel.DeviceAuthMessage.error: object expected");e.error=z.cast_channel.AuthError.fromObject(t.error)}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.challenge=null,n.response=null,n.error=null),null!=t.challenge&&t.hasOwnProperty("challenge")&&(n.challenge=z.cast_channel.AuthChallenge.toObject(t.challenge,e)),null!=t.response&&t.hasOwnProperty("response")&&(n.response=z.cast_channel.AuthResponse.toObject(t.response,e)),null!=t.error&&t.hasOwnProperty("error")&&(n.error=z.cast_channel.AuthError.toObject(t.error,e)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t}(),_),P.prototype.verify=function(t){t&&(255==t[0]&&240==(240&t[1])||(this.malformed=v(this.malformed,null,5e3,function(){console.error("got a malformed adts sample?")})))},P.prototype.stop=function(){null!=this.source&&this.source.stop(),this.pepperAudio&&this.pepperAudio.stop(),this.pepperAudio=null,this.source=null},P.prototype.queuePCMData=function(t,e,n){this.audioBuffer.copyToChannel(e,0,t*this.sampleLength),this.audioBuffer.copyToChannel(n,1,t*this.sampleLength),3==this.samplesDecoded&&this.source.start(),this.samplesDecoded++},P.prototype.decode=function(t,e){var n=(t+this.numSamples)%this.numSamples,i=this.samples[n];if(null!=i){var o=(t-1+this.numSamples)%this.numSamples,r=(t+1)%this.numSamples;if(o=this.samples[o],r=this.samples[r],o&&r){var s,c=1;o?(c++,s=f(o,i)):s=i,r&&(c++,s=f(s,r)),this.context.decodeAudioData(s.sliceArrayBuffer(),function(e){this.pepperAudio||(console.log("pepper audio plugin created"),this.pepperAudio=new F);var n=e.length/c;var i=new Float32Array(n),r=new Float32Array(n);e.copyFromChannel(i,0,o?n:0),e.copyFromChannel(r,1,o?n:0),this.pepperAudio.queueAudio(t,i,r)}.bind(this),function(t){this.onError&&this.onError(e,c,s,t)}.bind(this))}}else this.silence&&(this.audioBuffer.copyToChannel(this.silence,0,n*this.sampleLength),this.audioBuffer.copyToChannel(this.silence,1,n*this.sampleLength))},P.prototype.queue=function(t,e,n){var i=t%this.numSamples;if(i>=this.cleanup&&i<this.cleanup+this.numSamplesDiv4){for(var o=(this.cleanup+this.numSamplesDiv2)%this.numSamples,r=o+this.numSamplesDiv4,s=o;s<r;s++)this.samples[s]=null;this.cleanup=(this.cleanup+this.numSamplesDiv4)%this.numSamples}this.samples[i]=e,this.decode(t-1,n),this.decode(t,n),this.decode(t+1,n)},j.prototype.sendUDP=function(t,e,n){var i=new DataView(new ArrayBuffer(8+t.byteLength+4));i.setUint32(0,i.byteLength-4+n.byteLength),i.setUint32(4,t.byteLength);for(var o=0;o<t.byteLength;o++)i.setUint8(8+o,t[o]);i.setUint32(8+t.byteLength,e);var r=f(new Uint8Array(i.buffer,i.byteOffset,i.byteLength),new Uint8Array(n.buffer,n.byteOffset,n.byteLength));this.udpSocket.write(r)},j.prototype.resolveFile=function(t){return"/assets/"+MD5(t)},j.prototype.resolveAjax=function*(t){return yield $.ajax({url:this.resolveFile(t),type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield g,error:yield Error})},j.prototype.stop=function(){this.audioQueue&&(this.audioQueue.stop(),this.audioQueue=null),null!=this.udpSocket&&(this.udpSocket.destroy(),this.udpSocket=null),this.sessionUUID=null,this.onStop&&this.onStop()},j.prototype.timeout=function(){delete this.rtpTimeout,this.stop()},j.prototype.resetTimeout=function(t){t=t||1e4,clearTimeout(this.rtpTimeout),this.rtpTimeout=setTimeout(this.timeout.bind(this),t)},j.prototype.connectUDP=function(t,e){this.stop(),this.onStart&&this.onStart(),this.resetTimeout(6e4),this.udpSocket=new S,this.context=e;h("8fce000400000002000000014341535400000064");var n=h("81c90007000000020000000100000000000000ef0000000027bfaff00000000080cf0004000000020400000283aff46335954e18"),i=0,o=0,r=function(t,e,n){this.resetTimeout(),n.id<i-32768&&o++,i=n.id;var r=new Uint8Array(this.aesIvMask).slice(0);r[11]^=255&n.id,r[10]^=n.id>>8&255,r[9]^=o%8;var s=function(t){this.writeAudio((o<<16)+n.id,t.slice(0));var e={aesKey:this.aesKey,aesIvMask:this.aesIvMask,packet:n,rolloverCount:o};this.audioQueue.queue(n.id,t,e)}.bind(this);window.crypto.subtle.decrypt({name:"AES-CTR",counter:r,length:16},this.cryptoAesKey,n.payload.slice(10)).then(t=>s(new Uint8Array(t)))}.bind(this),c=function(t,e,o){var r=o.getUint32(4),s=o.getUint32(10),c=n.slice(0);(c=new DataView(c)).setUint32(4,r+1),c.setUint32(8,r),c.setUint32(16,i),c.setUint32(24,s),c.setUint32(c.byteLength-4,(new Date).getTime()%4294967295),c.setUint32(c.byteLength-16,r+1),this.sendUDP(t,e,c)}.bind(this),u=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),n=e.getInt32(0),i=t.slice(4,4+n),o=e.getInt32(4+n),s=t.slice(4+n+4),a=new DataView(s.buffer,s.byteOffset,s.byteLength),u=function(t){const e=t.getUint8(0),n=t.getUint8(1)>>>7,i=4*(15&e)+(e>>4&1?16:12),o=t.buffer.slice(t.byteOffset+i);return{id:t.getUint16(2),timestamp:t.getUint32(4),ssrc:t.getUint32(8),length:o.byteLength,marker:n,payload:o}}(a);u.marker?c(i,o,a):r(i,o,u)}.bind(this);(function*(){var n=new Date,i=n.getUTCFullYear()+(n.getUTCMonth()+1).pad(2)+n.getUTCDate().pad(2)+"000000Z";try{var o=yield this.resolveAjax(i+".key.der"),r=yield this.resolveAjax(i+".der"),c=yield t.newSocket("tcp:53519",yield);if(!c)throw new Error("unable to connect to audio socket");this.udpSocket=c;var l=this.audioQueue=new P(e);l.sampleRate=this.sampleRate,l.numberOfChannels=this.numberOfChannels;var f=function(t){console.error("error decoding",t,arguments),this.audioQueue==l&&(this.audioQueue=null),l.stop(),this.udpSocket==c&&(this.udpSocket=null),c.destroy()}.bind(this);l.onError=f,c.onClose=f,c.bufferWrites=!0,yield s(c,password,yield),yield s(c,d(o),yield),yield s(c,d(r),yield),yield s(c,this.castId,yield),a(c,u)}catch(t){console.error("error connecting to udp",t)}}).bind(this)().async()},j.prototype.getPort=function(t,e){return this.audioListener.localPort},j.prototype.respond=function(t,e,n){return this.sendMessage(t,e.destinationId,e.sourceId,e.namespace,n)},j.prototype.sendMessage=function(t,e,n,i,o){"Object"==o.constructor.name&&(o=JSON.stringify(o));var r={protocolVersion:0,sourceId:e,destinationId:n,namespace:i,payloadType:"String"===o.constructor.name?0:1};r.payloadType?r.payloadBinary=o.constructor.encode(o).finish():r.payloadUtf8=o;var s=$protobuf.roots.default.cast_channel.CastMessage.encode(r).finish();!function(t,e,n,i){var o=new ArrayBuffer(4);new DataView(o).setInt32(0,e.byteLength,i),t.write(f(new Uint8Array(o),new Uint8Array(e)).buffer,n)}(t,s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength))},j.prototype.onMessage={},j.prototype.onMessage["urn:x-cast:com.google.cast.tp.deviceauth"]=function*(t,e){try{var n=new Date,i=n.getUTCFullYear()+(n.getUTCMonth()+1).pad(2)+n.getUTCDate().pad(2)+"000000Z",o=yield this.resolveAjax(i+".sig"),r=yield this.resolveAjax("cert-aa.der"),s=yield this.resolveAjax("cert-ab.der"),c=yield this.resolveAjax("cert-ac.der"),a=yield this.resolveAjax("cert-ad.der"),u={response:{signature:o=new Uint8Array(o),clientAuthCertificate:r=new Uint8Array(r),intermediateCertificate:[s=new Uint8Array(s),c=new Uint8Array(c),a=new Uint8Array(a)],signatureAlgorithm:1,senderNonce:null,hashAlgorithm:0,crl:null},error:null};this.respond(t,e,$protobuf.roots.default.cast_channel.DeviceAuthMessage.fromObject(u))}catch(t){console.error("error getting certs",t)}},j.prototype.onJSONMessage={},j.prototype.onJSONMessage.GET_APP_AVAILABILITY=function*(t,e,n){var i={availability:{},requestId:n.requestId,responseType:"GET_APP_AVAILABILITY"};$.each(n.appId,function(t,e){i.availability[e]="APP_UNAVAILABLE"}),i["8E6C866D"]="APP_AVAILABLE",this.respond(t,e,i)},j.prototype.onJSONMessage.STOP=function*(t,e,n){this.sessionUUID=null,yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(t,e,n,!0).async()},j.prototype.onJSONMessage.LAUNCH=function*(t,e,n){this.sessionUUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(t,e,n,!0).async()},j.prototype.onJSONMessage.GET_STATUS=function*(t,e,n){yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(t,e,n).async()},j.prototype.onJSONMessage.RECEIVER_STATUS=function*(t,e,n,i){var o={requestId:n.requestId,status:{userEq:{high_shelf:{frequency:4500,gain_db:0,quality:.707},low_shelf:{frequency:150,gain_db:0,quality:.707},max_peaking_eqs:0,peaking_eqs:[]},volume:{controlType:"master",level:1,muted:!1,stepInterval:.02}},type:"RECEIVER_STATUS"};this.sessionUUID&&(o.status.applications=[{appId:"8E6C866D",displayName:"Audio Mirroring",isIdleScreen:!1,launchedFromCloud:!1,namespaces:[{name:"urn:x-cast:com.google.cast.webrtc"},{name:"urn:x-cast:com.google.cast.media"},{name:"urn:x-cast:com.google.cast.debug"},{name:"urn:x-cast:com.google.cast.remoting"}],sessionId:this.sessionUUID,statusText:"Audio Mirroring",transportId:this.sessionUUID}]),i?this.sendMessage(t,e.destinationId,"*",e.namespace,o):this.respond(t,e,o)},j.prototype.onMessage["urn:x-cast:com.google.cast.receiver"]=function*(t,e,n){var i=this.onJSONMessage[n.type];i?yield i.bind(this)(t,e,n).async():console.error("unhandled cast json message",n)},j.prototype.onMessage["urn:x-cast:com.google.cast.media"]=j.prototype.onMessage["urn:x-cast:com.google.cast.receiver"],j.prototype.onMessage["urn:x-cast:com.google.cast.tp.heartbeat"]=function*(t,e){this.respond(t,e,{type:"PONG"})},j.prototype.onMessage["urn:x-cast:com.google.cast.tp.connection"]=function*(t,e){this.respond(t,e,{protocolVersion:0,type:"CONNECTED"})},j.prototype.onMessage["urn:x-cast:com.google.cast.receiver.discovery"]=function*(t,e,n){var i={controlNotifications:1,deviceCapabilities:2052,deviceIconUrl:"/setup/icon.png",deviceId:this.castId,deviceModel:"Google Home",friendlyName:"Kitchen",receiverMetricsId:"5C1CC5224680F4B2",requestId:n.requestId,type:"DEVICE_INFO",wifiProximityId:"FA8FCA7A7F1C"};this.respond(t,e,i)},j.prototype.onMessage["urn:x-cast:com.google.cast.webrtc"]=function*(t,e,n){for(var i in n.offer.supportedStreams){if(i=n.offer.supportedStreams[i],console.log("audio offer:",i),this.sampleRate=i.sampleRate,this.numberOfChannels=i.channels,null!=this.audioQueue){var o=this.audioQueue;o.sampleRate=this.sampleRate,o.numberOfChannels=this.numberOfChannels}48e3!=i.sampleRate&&console.warn("Offered sample rate is not 48000?",i.sampleRate),2!=i.channels&&console.warn("Offered channels is not 2?",i.channels)}var r={answer:{castMode:"mirroring",receiverRtcpEventLog:[0],rtpExtensions:[["adaptive_playout_delay"]],sendIndexes:[0],ssrcs:[2],udpPort:8010},result:"ok",seqNum:0,type:"ANSWER"};this.aesKey=h(n.offer.supportedStreams[0].aesKey),this.aesIvMask=h(n.offer.supportedStreams[0].aesIvMask),crypto.subtle.importKey("raw",this.aesKey,"AES-CTR",!1,["decrypt"]).then(n=>{this.cryptoAesKey=n,this.respond(t,e,r)})},j.prototype.siphon=function(t){this.pendingAudio=[],this.audioDump=t},j.prototype.writeAudio=function(t,e){if(this.audioDump){this.pendingAudio.push({id:t,decryptedBytes:e}),this.pendingAudio.sort(function(t,e){return t.id-e.id});var n=this.pendingAudio.splice(0,50),i=this.pendingAudio;this.pendingAudio=n;for(var o=0;o<i.length;o++)this.audioDump.dataReceived(i[o].decryptedBytes)}},function(){var t=0;function e(t,e,n,i){this.socket=t,this.videoOnly=!0;var o=new ByteBuffer(1024);o.put("FLV"),o.put(1),this.videoOnly?o.put(1):o.put(5),o.putInt(9),o.putInt(0),o.flip(),this.socket.dataReceived(o),this.setParameter(e,n,i)}function n(e,n){return e.put(t),e.putDouble(n),e}function i(t,e){var n=o(e);return t.putShort(n.byteLength),t.put(n),t}function r(t,e){return t.putShort(e>>8&65535),t.put(255&e),t}e.prototype.setParameter=function(t,e,o){var s=new ByteBuffer(1024);s.put(18),this.videoOnly?r(s,182):r(s,290),r(s,0),s.putInt(0);var c=s.position;s.put(2),i(s,"onMetaData"),s.put(8),this.videoOnly?s.putInt(7):s.putInt(12),i(s,"duration"),n(s,0),i(s,"width"),n(s,t),i(s,"height"),n(s,e),i(s,"framerate"),n(s,o),i(s,"videocodecid"),n(s,7),i(s,"videodatarate"),n(s,0),this.videoOnly||(i(s,"audiodatarate"),n(s,62.5),i(s,"audiosamplerate"),n(s,5112),i(s,"audiosamplesize"),n(s,8),i(s,"stereo"),s.put(0),i(s,"audiocodecid"),n(s,0)),i(s,"encoder"),s.put(2),i(s,"Lavf52.87.1"),i(s,"filesize"),n(s,0),i(s,""),s.put(9);var a=s.position-c;s.putInt(a+11),s.flip(),this.socket.dataReceived(s)},e.prototype.addVideoHeader=function(t){for(var e=4;e<t.length&&(0!=t[e+0]||0!=t[e+1]||0!=t[e+2]||1!=t[e+3]);e++);var n=t.subarray(0,e),i=t.subarray(e),o=new ByteBuffer(1024),s=n.length-4+i.length-4+16;o.put(9),r(o,s),r(o,0),o.put(0),r(o,0),o.put(23),o.put(0),r(o,0),o.put(1),o.put(n[5]),o.put(n[6]),o.put(n[7]),o.put(255),o.put(225),o.putShort(n.length-4),o.put(n.subarray(4)),o.put(1),o.putShort(i.length-4),o.put(i.subarray(4)),o.putInt(11+s),o.flip(),this.socket.dataReceived(o)},e.prototype.addVideoFrame=function(t,e,n){var i=new ByteBuffer(1024);i.put(9),r(i,5+t.length),this.firstPresentationTimestampMs||(this.firstPresentationTimestampMs=e);var o=e-this.firstPresentationTimestampMs;r(i,o),i.put(o>>24&255),r(i,0),i.put(n?23:39),i.put(1),r(i,0),i.flip();var s=new ByteBuffer(t.length);s.put(t),s.flip(),s.putInt(t.length-4),s.position=0;var c=new ByteBuffer(1024);c.putInt(16+t.length),c.flip(),this.socket.dataReceived(i),this.socket.dataReceived(s),this.socket.dataReceived(c)},window.FlashPackager=e}(),F.prototype.queueAudio=function(t,e,n){common2.naclModule&&common2.naclModule.postMessage&&common2.naclModule.postMessage({type:"queueAudio",audioBuffer0:e.buffer,audioBuffer1:n.buffer,id:t,sampleLength:e.byteLength/4})},F.prototype.stop=function(){common2.naclModule&&common2.naclModule.postMessage&&common2.naclModule.postMessage({type:"stop"})},q.prototype.connectH264=function(t,n){common.naclModule&&common.naclModule.postMessage?common.naclModule.postMessage({type:"connectH264",hostCommand:e("host:transport:"+t),clientCommand:e("tcp:53517"),password:n+"\n"}):console.error("connectH264 called before initialization")},q.prototype.decode=function(t,e,n){common.naclModule&&common.naclModule.postMessage?common.naclModule.postMessage({buffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength,presentationTimeMs:e,syncFrame:n}):console.error("decode called before initialization")},q.prototype.queueAudio=function(t,e,n){common.naclModule.postMessage({type:"queueAudio",audioBuffer0:e.buffer,audioBuffer1:n.buffer,offset:t,length:e.byteLength})},function(){var t,e,n,i,o,r,a,u,l,f,h,d,m,g,b,S,C,O,_=36,V=48,B=vysorDefaultSettings,M=function(){};function z(){return!window.chrome||!window.chrome.app||!window.chrome.app.window}if(!z()){var P=new j;P.onStop=function(){$("#headphones").show()},P.onStart=function(){$("#headphones").hide()}}function F(){if(!O)try{O=new AudioContext({latencyHint:"interactive",sampleRate:48e3}),console.log("Created AudioContext",O)}catch(t){console.error("Error creating AudioContext",t)}}function L(){if(!z()&&window._lm&&window._lm._il){if(D&&!P.udpSocket&&O){if(console.log("Connecting to UDP"),!t.castId){t.castId=function(t){for(var e="",n=0;n<t;n++)e+="abcdef0123456789".charAt(Math.floor(Math.random()*"abcdef0123456789".length));return e}(40),ct()}P.castId=t.castId,P.connectUDP(adbSocketFactory,O),N({title:"Vysor Audio Output",body:'Vysor is waiting for the audio stream. Follow the <a target="_blank" href="https://github.com/koush/vysor.io/issues/426">instructions</a> to grant Vysor permission to capture your Android audio output.',okButton:"Open Instructions",ok:function(){setTimeout(function(){chrome.browser.openTab({url:"https://github.com/koush/vysor.io/issues/426"})},0)},cancelButton:"OK"})}Adb.shell({socketFactory:adbSocketFactory,command:"am start -a android.settings.CAST_SETTINGS",serialno:device.serialno},function(t){})}}isElectron()&&F(),sharedGlobals.siphonAudio=function(t){g&&(g.destroy(),g=null),t&&(g=isElectron()?{dataReceived:function(e){e.asUint8Array&&(e=e.asUint8Array()),e.constructor==ArrayBuffer&&(e=new Uint8Array(e)),t.dataReceived(e)},destroy:function(){t.destroy()}}:t,P.siphon(g))},sharedGlobals.siphonFlv=function(e){m&&(m.destroy(),m=null,b=null),e&&(m=isElectron()?{dataReceived:function(t){t.asUint8Array&&(t=t.asUint8Array()),t.constructor==ArrayBuffer&&(t=new Uint8Array(t)),e.dataReceived(t)},destroy:function(){e.destroy()}}:e,b=new FlashPackager(m,r,a,30),S=!0,Q({type:"resolution",resolution:W[t.resolution]}))};var H,G,Y,W=[0,.25,.5,.75,1],K=[5e5,75e4,1e6,15e5,2e6,3e6,4e6,6e6,8e6],J=["software","hardware","hardware_with_fallback"],X=function(t,e){return e};function Q(t){U&&(t.clientX&&(t.downDelta=Date.now()-h,f||(f=$("#listener")),t.clientX=t.clientX/f.width()*i,t.clientX>i||t.clientX<0)||t.clientY&&(f||(f=$("#mirror")),t.clientY=t.clientY/f.height()*o,t.clientY>o||t.clientY<0)||U.send(JSON.stringify(t)))}function Z(t,e){if(t){if("String"==t.constructor.name){if(t.startsWith("KEYCODE_"))return Q({type:"keyevent",keyevent:t}),!0;switch(t){case"VYSOR_SHOW_TITLE_BAR":tt();break;case"VYSOR_RECORD_SCREEN":z()||M(e);break;case"VYSOR_SCREENSHOT":z()||chrome.browser.openTab({url:"http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/screenshot-"+Date.now()+".jpg"});break;case"VYSOR_OPEN_DEVICE_SETTINGS":showSettings(),z()||openList();break;case"VYSOR_ROTATE_SCREEN":Q({type:"rotate"});break;default:return}return!0}return"Number"==t.constructor.name?(Q({type:"keycode",keycode:t}),!0):t.keyevent?(Q({type:"keyevent",keyevent:t.keyevent,shift:!!(t.shiftKey&&e&&e.shiftKey)}),!0):t.keycode?(Q({type:"keycode",keycode:t.keycode,shift:!!(t.shiftKey&&e&&e.shiftKey)}),!0):void 0}}function tt(){if("inkwire"!=e){if(_)return clearTimeout(n),void $(".head").fadeTo(0,1);$(".head").fadeTo(0,.8),clearTimeout(n),n=setTimeout(function(){$(".head").fadeOut()},2e3)}else $(".head").hide()}function et(){return document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullscreenElement||document.fullscreenElement}function nt(){return t&&t.displaySettings&&t.displaySettings.freeSize}function it(){var t=innerWidth,e=innerHeight,n=screen.availWidth,r=screen.availHeight;(et()||nt()||z())&&(n=t,r=e),u>n&&(l=o/i*(u=n));if(l+V+_+0>r&&(u=i/o*(l=r-V-_-0)),u&&l){var s=Math.round(u),c=Math.round(l+V+_);et()||nt()||(C?C=!1:(C=!0,isElectron()?(Math.abs(innerWidth-s)>=2||Math.abs(innerHeight-c)>=2)&&chrome.app.window.current().w.setContentSize(s,c):window.chrome&&window.chrome.app&&window.chrome.app.window&&(Math.abs(innerWidth-s)>=2&&(chrome.app.window.current().innerBounds.width=s),Math.abs(innerHeight-c)>=2&&(chrome.app.window.current().innerBounds.height=c))));var a=(t-u)/2,f=$("#mirror, #listener");f.css("left",a),f.css("top",(e-l-V+_)/2),$(".foot").width(u),$(".foot").css("left",a),$(".overlay").width(u),$(".overlay").css("left",a),(f=$("#mirror, embed, #listener")).width(Math.round(u)),f.height(Math.round(l)),$("#dead, #drag, #reconnect").width(u),$("#dead, #drag, #reconnect").height(l+V+_)}}function ot(e){window.chrome&&window.chrome.storage&&chrome.storage.local.get(["vysorUsage","vysorDailyUsage","lastDailyReport"],function(n){var i=n.vysorUsage,o=n.lastDailyReport,r=n.vysorDailyUsage,s=Date.now();if(i||(i=0),r||(r=0),o){if(s>o+864e5){var c=r/36e5;(c=Math.round(2*c)/2)<=24&&c>=0&&(tracker.sendEvent("daily-usage",c.toString()),tracker.sendEvent("daily-usage-licensed",_lm._il)),r=0,chrome.storage.local.set({lastDailyReport:s})}}else chrome.storage.local.set({lastDailyReport:s});var a=i;i+=e,a<72e5&&i>72e5?window._lm&&window._lm._il||function(){if(t.hasRecommendedPro)return;t.hasRecommendedPro=!0,ct(),N({title:"Vysor Pro",body:"Vysor Pro gives you high quality video, Audio Mirroring, and many more features. Please consider upgrading!",okButton:"Purchase Vysor Pro",ok:function(){_lm.startPurchase()}.bind(this)})}():i>108e5&&function(){if(t.hasRecommendedRate)return;t.hasRecommendedRate=!0,ct(),N({title:"Vysor",body:"You seem to be finding Vysor useful. We'd love to hear your thoughts on the Play Store!'",okButton:"Rate Vysor",ok:function(){adbSocketFactory.newSocket("shell:am start -d http://play.google.com/store/apps/details?id=com.koushikdutta.vysor -a android.intent.action.VIEW")}.bind(this)})}(),r+=e,chrome.storage.local.set({vysorUsage:i,vysorDailyUsage:r})})}function rt(){$(".topbuttonbar>.btn-toolbar").empty(),$(".head").attr("style",B.titleBar.style);var t=B.titleBar.buttonGroups;!function(){if(!z()){var t=$("<span id='headphones'></span>");t.attr("class","btn-group btn-group-xs"),t.attr("role","group");var e=$("<a></a>");e.attr("class","btn btn-default fa fa-headphones"),e.attr("title","Mute Phone and Mirror Audio"),e.click(X("Audio Mirroring",function(t){F(),L()})),t.append(e),$(".topbuttonbar>.btn-toolbar").append(t)}}(),$(t).each(function(t,e){var n=$("<span></span>");n.attr("class","btn-group btn-group-xs"),n.attr("role","group"),$(e).each(function(t,e){var i=$("<a></a>");i.attr("class","btn btn-default fa "+e.class),i.attr("title",e.title),i.click(function(t){Z(e.event,t)}),n.append(i)}),$(".topbuttonbar>.btn-toolbar").append(n)})}function st(){$(".foot-row").empty(),$(".foot-row").attr("style",B.navigationBar.style);var t=B.navigationBar.buttons,e=Math.round(100/t.length)+"%";$(t).each(function(t,n){var i=$("<span></span>");i.attr("class","fa fa-lg "+n.class),i.attr("title",n.title),i.width(e),i.click(function(){Z(n.event)}),$(".foot-row").append(i)})}function ct(){!function(t,e,n){x(e),window.chrome&&window.chrome.storage&&t&&-1==t.indexOf("127.0.0.1")?E(function(i){i[t]=e,chrome.storage.local.set({"device-settings":i},n)}):n&&n()}(device.id||device.serialno,t)}function at(){if(window._lm&&(G||!_lm._il)){for(var e=[],n=1;n<=9;n++)e.unshift(n);var i=e.length+1;$(e).each(function(t){setTimeout(function(){$(".title, title").text("Ad in "+t+" seconds.")},1e3*(i-t))}),Q({type:"toast",toast:"Vysor ad in "+i+" seconds.\nUpgrade for an ad free experience."}),setTimeout(function(){$(".title, title").text(t.friendlyName||device.name),U||(clearInterval(Y),Y=null),tracker.sendEvent("ad-impression"),Q({type:"ad"})},1e3*i)}}function ut(){window._lm&&window._lm._il&&(t.hasRecommendedHighQuality?function(){window._lm&&window._lm._il&&(t.hasRecommendedAudio||(t.hasRecommendedAudio=!0,ct(),N({title:"Audio Mirroring",body:'You can mute your Android and Mirror audio to your computer by clicking the headphone icon in the toolbar above: <span class="fa fa-headphones"></span>',okButton:"Mirror Audio",ok:function(){F(),L()}.bind(this)})))}():(t.hasRecommendedHighQuality=!0,ct(),N({title:"High Quality Video",body:"The video quality can be customized by clicking the Settings icon in the toolbar. Would you like to try the recommended High Quality settings?",okButton:"Use High Quality Settings",ok:function(){$("#high-quality-defaults").click(),ct()}.bind(this)})))}window.tracker||(window.tracker={sendEvent:function(){},sendAppView:function(){}}),$(window).focus(function(){tt(),Q({type:"wakeup"})}),$(window).bind("paste",function(t){var e=t.originalEvent.clipboardData.getData("text");e&&e.length&&Q({type:"keychar",keychar:e})}),window.addEventListener("mousewheel",function(t){Q({type:"scroll",clientX:t.offsetX,clientY:t.offsetY,deltaX:t.wheelDeltaX/100,deltaY:t.wheelDeltaY/100})},!1),$(window).keypress(function(t){var e=String.fromCharCode(t.keyCode);e.length&&Q({type:"keychar",keychar:e})}),$(window).keydown(function(t){Z(B.keydown[t.keyCode]||B.keydown[t.key],t)&&t.stopPropagation()}),$(window).resize(function(e){o&&i&&(clearTimeout(H),H=setTimeout(function(){if(nt())Q({type:"displaySettings",size:innerWidth+"x"+(innerHeight-_-V),density:t.displaySettings.density});else{var e=innerWidth;u=e,l=e*(o/i),it()}},500))}),sharedGlobals.docReady=function(){var e;X=window._lm?function(t,e,n){return function(){if(d&&!_lm._il)return N({title:"Vysor Pro",body:"The "+t+" feature is only available to Vysor Pro users.",okButton:"Upgrade",ok:function(){_lm.startPurchase()}}),void(n&&n.apply(this,arguments));e.apply(this,arguments)}}:function(t,e){return e},M=X("Record Screen",function(t){$(t.target).hasClass("fa-stop-circle-o")?Q({type:"stop-recording"}):Q({type:"start-recording"}),$(t.target).toggleClass("fa-video-camera fa-stop-circle-o")}),$(document).on("dragover",function(t){$("#drag").fadeIn(),clearTimeout(e),t.preventDefault(),t.stopPropagation()}),$(document).on("dragleave",function(){e=setTimeout(function(){$("#drag").fadeOut()},1e3)}),$(document).on("drop",X("Drag and Drop",function(t){if($("#drag").fadeOut(),t.preventDefault(),1==t.originalEvent.dataTransfer.files.length){var e=t.originalEvent.dataTransfer.files[0];console.log(e),Adb.push({socketFactory:adbSocketFactory,socket:new A(e),file:"/sdcard/vysor/"+e.name,serialno:device.serialno},function(){var t="am start -a android.intent.action.VIEW -d file:/sdcard/vysor/"+e.name;if(e.type&&e.type.length)t+=" -t "+e.type;else if(e.name.endsWith(".apk"))return void Adb.shell({socketFactory:adbSocketFactory,command:"pm install -r /sdcard/vysor/"+e.name,serialno:device.serialno},function(t){y("APK installation result: "+t.trim())});Adb.shell({socketFactory:adbSocketFactory,command:t,serialno:device.serialno},function(){y("File has been transfered and is being opened on the Android.")})})}else y("You may only drag and drop one file at a time.")},function(t){$("#drag").fadeOut(),t.preventDefault()})),common.attachDefaultListeners(),common2.attachDefaultListeners(),$("#listener").mouseup(function(t){0==t.button&&Q({type:t.type,clientX:t.offsetX,clientY:t.offsetY})}),$("#listener").bind("touchstart touchend touchmove",function(t){var e;e="touchstart"==t.type?"mousedown":"touchend"==t.type?"mouseup":"mousemove";var n=t.currentTarget;t.stopPropagation(),t.preventDefault();var i=(t=t.originalEvent).touches[0];i||(i=t.changedTouches[0]);var o=document.createEvent("MouseEvent");o.initMouseEvent(e,!0,!0,window,t.detail,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),o.isTouch=!0,n.dispatchEvent(o)}),console.log("docReady"),$("#listener").mousedown(function(t){if(0==t.button)return h=Date.now(),void Q({type:t.type,clientX:t.offsetX,clientY:t.offsetY});Z(B.mousedown[t.button],t)}),$("#listener").mousemove(function(t){(0!=(1&t.buttons)||t.originalEvent.isTouch)&&Q({type:t.type,clientX:t.offsetX,clientY:t.offsetY})}),$(".head").bind("mouseup mousedown mousemove",function(t){t.stopPropagation(),tt()}),$("#rotate-button").click(function(){Q({type:"rotate"})}),$("#screenshot-button").click(function(){chrome.browser.openTab({url:"http://127.0.0.1:"+httpPort+"/device/"+(device.id||device.serialno)+"/screenshot-"+Date.now()+".jpg"})}),$("#record-button").click(X("Record Screen",function(){$("#record-button>span").hasClass("fa-video-camera")?Q({type:"start-recording"}):Q({type:"stop-recording"}),$("#record-button>span").toggleClass("fa-video-camera fa-stop-circle-o")})),window.chrome&&window.chrome.app&&window.chrome.app.window||($("#screenshot-button").hide(),$("#record-button").hide()),$("#power").click(function(){Q({type:"keycode",keycode:26})}),$("#volume-down").click(function(){Q({type:"keycode",keycode:25})}),$("#volume-up").click(function(){Q({type:"keycode",keycode:24})}),st(),rt(),$("#reconnect-button").click(function(){tryReconnect(),$("#reconnect").hide()}),$("#settings-button").click(function(){showSettings(),z()||openList()}),$("#web-video-stream").click(X("Web Video Stream",function(){var t=$("#web-video-stream").text();$("#settings-modal").modal("hide"),p(t),setTimeout(function(){R("Copied Web Video Stream Link",t)},500)}));var n=$("#new-display-name");function i(){$("#settings-modal").modal("hide");var e=$(n).prop("value");t.friendlyName=e,$(".title, title").text(t.friendlyName||device.name),ct();var i=chrome.app.window.get("list");i&&i.contentWindow.updateDeviceName&&i.contentWindow.updateDeviceName(device.id||device.serialno,t.friendlyName||device.name)}function o(e,n){$("#bitrate").prop("selectedIndex",e),$("#resolution").prop("selectedIndex",n),t.bitrate=e,Q({type:"bitrate",bitrate:e=K[e]}),t.resolution=n,Q({type:"resolution",resolution:n=W[n]})}$(n).bind("keypress",function(t){if(t.stopPropagation(),13==t.which)return i(),!1}),$("#settings-ok").click(i),$("#settings-defaults").click(function(){t=k();try{d=!1,T(t)}finally{d=!0}Q({type:"displaySettings",size:"reset",density:"reset",resolution:W[t.resolution]})}),$("#softkeys-check").change(function(){t.showSoftKeys=this.checked,this.checked?($(".foot").show(),V=48):($(".foot").hide(),V=0),it()}),$("#pin-title-check").change(function(){t.pinTitleBar=this.checked,_=this.checked?36:0,it(),tt()}),$("#fullscreen-check").change(X("Fullscreen Mode",function(){this.checked?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullscreen?document.mozExitFullscreen():document.mskitExitFullscreen&&document.mskitExitFullscreen()},function(){this.checked=!1})),$("#always-on-top-check").change(X("Always On Top",function(){t.alwaysOnTop=this.checked,window.chrome&&window.chrome.app&&window.chrome.app.window&&chrome.app.window.current().setAlwaysOnTop(this.checked)},function(){this.checked=!1})),$("#bitrate").change(X("Video Quality",function(){t.bitrate=this.selectedIndex,Q({type:"bitrate",bitrate:K[this.selectedIndex]})},function(){this.selectedIndex=0})),$("#resolution").change(X("Video Resolution",function(){t.resolution=this.selectedIndex,Q({type:"resolution",resolution:W[this.selectedIndex]})},function(){this.selectedIndex=0})),$("#decoder").change(X("Video Decoder",function(){t.decoder=this.selectedIndex,Q({type:"resolution",resolution:W[t.resolution]})},function(){this.selectedIndex=0})),$("#low-quality-defaults").click(X("Video Quality",function(){o(0,0)})),$("#medium-quality-defaults").click(X("Video Quality",function(){o(4,2)})),$("#high-quality-defaults").click(X("Video Quality",function(){o(8,3)})),$("#display-settings").change(X("Display Settings",function(){var e=function(){var e=I[this.selectedIndex],n=e.freeSize?innerWidth+"x"+(innerHeight-_-V):e.size;t.displaySettings=e,ct(),Q({type:"displaySettings",size:n,density:e.density}),this.selectedIndex&&N({title:"Display Settings",body:"Please close the Vysor window before disconnecting your Android to reset your Display Settings.",hideCancel:!0})}.bind(this);0!=this.selectedIndex?N({title:"Display Settings",body:"The Display Settings feature is not recommended for non-Nexus devices and may require you to hard reset your device.",okButton:"Continue",ok:function(){$("#notificationModal").one("hidden.bs.modal",e)}.bind(this),cancel:function(){this.selectedIndex=0}.bind(this)}):e()},function(){this.selectedIndex=0})),$("#dim-display").change(X("Dim Dislay",function(){t.dimDisplay=this.checked,ct(),Q({type:"dimDisplay",dimDisplay:this.checked})},function(){this.checked=!1})),function(){for(var t in I){var e=I[t],n=new Option;$(n).html(e.name),$("#display-settings").append(n)}}(),it(),tt(),window.tracker&&tracker.sendAppView("screen")},sharedGlobals.connectionReady=function(){var e;function n(t){if("displaySize"==t.type){var n=i,s=o;i=t.screenWidth,o=t.screenHeight,function(t,e){if(nt())u=i,l=o;else if(window.chrome&&window.chrome.app&&window.chrome.app.window&&et()&&(u=screen.availWidth,l=screen.availHeight),e==i&&t==o){var n=u;u=l,l=n}else{var r;r=i>o?Math.max(innerWidth,innerHeight):Math.min(innerWidth,innerHeight),u=r,l=r*(o/i)}it()}(n,s)}else if("encodeSize"==t.type){if(r=t.encodeWidth,a=t.encodeHeight,!D)return void N();e=v(e,null,1e3,function(){D.onClose=null,D.destroy(),D=null,N()})}else if("clip"==t.type)p(t.clip);else if("password"==t.type);else if("recording"==t.type){var c=t.recording.replace("/sdcard/vysor/","");chrome.browser.openTab({url:"http://127.0.0.1:"+httpPort+"/device/"+(device.id||device.serialno)+"/sdcard-vysor/"+c})}else console.log("unknown",t)}console.log("connectionReady"),$("#loading").fadeIn(),$("#dead, #reconnect").fadeOut(),tt(),device||console.error("device not defined on window object?"),window.chrome&&window.chrome.storage&&window.chrome.storage.local&&chrome.storage.local.get("vysorSettings",function(t){B={},Object.assign(B,vysorDefaultSettings,t.vysorSettings);var e=B.devices&&B.devices[device.id||device.serialno]||{};B.navigationBar=e.navigationBar||B.navigationBar,B.titleBar=e.titleBar||B.titleBar,Object.assign(B.keydown,e.keydown),Object.assign(B.mousedown,e.mousedown),st(),rt()});var f=0,h=20;function w(){console.log("input websocket failed, retrying. attempt "+f+" out of "+h),setTimeout(m,500)}function m(){++f!=h?g(function(e){e?(U=e,D&&(D.onClose=null,D.destroy(),D=null),U.onopen=function(){console.log("input websocket opened"),z()||Adb.reverse({serialno:device.serialno,from:"tcp:8010",to:"tcp:"+P.getPort()},function(t){console.log("audio listener",t)}),U.onerror=null;var e=t.displaySettings||{},n=e.freeSize?innerWidth+"x"+(innerHeight-V-_):"reset"==e.size?null:e.size,i="reset"==e.density?null:e.density;Q({type:"password",password:password,resolution:W[t.resolution],size:n,density:i,dimDisplay:t.dimDisplay})},U.onerror=w,U.onmessage=function(t){console.log("event from phone",t.data),n(JSON.parse(t.data))}):w()}):I()}window.adbSocketFactory||("adb-client"==adbSocketFactoryFactory.type?adbSocketFactory=Adb.createSocketFactory(adbSocketFactoryFactory.arguments.serialno):console.error("unknown adb socket factory factory",adbSocketFactoryFactory.type));var g=function(t){adbSocketFactory.newSocket("tcp:53518",function(e){if(e){var n,i=function(){var t;n&&(n.length?t=n.shift():n=null,t&&s(e,t,i))};e.close=e.destroy.bind(e),e.send=function(t){n?n.push(t):(n=[],s(e,t,i))}.bind(e),t(e);var o=!1;e.onClose=function(){o||e.onerror&&e.onerror()},c(e,function t(n){o||(o=!0,e.onopen&&e.onopen()),e.onmessage&&e.onmessage({data:n}),c(e,t)})}else t()})};function A(){window.tryReconnect?$("#reconnect").fadeIn():$("#dead").fadeIn(),$("#listener").empty()}function I(e){if(console.log("received socket",e),D&&(D.onClose=null,D.destroy(),D=null),D=e,$(".overlay").fadeOut(),e){e.name="h264",e.onClose=function(){try{A()}catch(t){console.log("eating error that occurs with jquery if window is being closed...")}console.log("closing input "),U&&U.close(),U=null,D==e&&(D=null)};var n,i,o=new q(r,a,J[t.decoder||0]),s=!0,c=function(t){var i=t.subarray(8),r=new DataView(t.buffer,t.byteOffset,8),c=r.getUint32(0,!0),a=0!=r.getUint32(4,!0);b&&e==D&&(s?b.addVideoHeader(i):S||b.addVideoFrame(i,c,a)),s&&(S=!1,s=!1),o.decode(i,c,a);var u=Date.now();if(n){var f=u-n;f>6e4&&(n=u,ot(f))}else n=u,tracker.sendEvent("view-device");l()},u=function(t){if(4!=t.byteLength)throw new Error("WTF");var n=new DataView(t.buffer,t.byteOffset,4).getInt32(0,!0);e.read(n,c)},l=function(){e.read(4,u)};o.onDecoderFallingBehind=function(){i=v(i,null,1e3,function(){console.log("requesting sync frame"),Q({type:"sync-frame"})})},o.onReady=function(){console.log("starting read loop");var n=setTimeout(function(){y("Your Android screen is unavailable right now. This can sometimes be resolved by rebooting your Android.")},5e3);window._lm&&(!G&&_lm._il||Y||(clearInterval(Y),Y=setInterval(at,9e5),setTimeout(function(){at()},12e4))),e.read(4,function(e){clearTimeout(n),ut(),u(e),window.chrome&&window.chrome.storage&&Q({type:"bitrate",bitrate:K[t.bitrate]})})},it()}else A()}function N(){adbSocketFactory.newSocket("tcp:53517",function(t){t?s(t,password,function(){I(t)}):I()})}console.log("init"),function(t,e){t||(t="web");var n=k();"inkwire"==t&&(n.pinTitleBar=!1,n.showSoftKeys=!1),E(function(i){e(x(i[t]||n))})}(device.id||device.serialno,function(e){t=e,m(),window._lm&&window._lm._il||(t.bitrate=0,t.resolution=0,t.alwaysOnTop=!1),T(t),d=!0,it(),$(".title, title").text(t.friendlyName||device.name)})},window.chrome&&window.chrome.app&&window.chrome.app.window?($(document).ready(docReady),function(){function t(){if(!et())return showSettings(),R(null,"Vysor has been maximized. If you wish enable Fullscreen Mode, it can be enabled in Settings."),void setTimeout(function(){chrome.app.window.current().restore()},1e3)}chrome.app.window.current().onFullscreened.addListener(t),chrome.app.window.current().onMaximized.addListener(t)}()):(device={id:"web",serialno:"web"},"inkwire"==(e=w("mode"))&&(device={id:"inkwire",serialno:"inkwire"}),$(document).ready(function(){docReady(),"inkwire"==e&&($("title").text("Inkwire"),_=0,$(".foot").hide(),V=0,it());var t=w("registrationId");if(t){var n=w("senderId");n||(n="64148182473");var i,o=w("audio");"inkwire"==e&&(n="3505780036",o=!0),GcmRtcManager.start({3505780036:"AIzaSyDt0GimPRhk8_d_4XjOYzQUn50UkvXhMtE",64148182473:"AIzaSyDd7k1v017osyYbIC92fyf-36s3pv0z73U"},{iceServers:[{urls:["turn:n0.clockworkmod.com","turn:n1.clockworkmod.com"],username:"foo",credential:"bar"}]},function(e){console.log("attempting to connect to vysor from web"),(i=e).sharedDevices={};var r=w("channel");i.connect({senderId:n,registrationId:t,port:r}).then(function(e){console.log("web connection established"),o&&(console.log("attempting audio"),i.connect({senderId:n,registrationId:t,port:r,audio:!0}).then(function(t){console.log("got audio");var e=new Audio;e.src=(URL||webkitURL||mozURL).createObjectURL(t.peerConnection.getRemoteStreams()[0]),e.play()})),console.log("gcmConn",e),adbSocketFactory=e,console.log("starting remote vysor daemon"),e.newSocket("webstart",function(t){console.log("waiting for password"),c(t,function(e){t.destroy(),console.log("got password",e),window.password=e,connectionReady()})})})})}})),sharedGlobals.updateWindowStatusText=function(t){$("#loading-text").html(t)},sharedGlobals.showSettings=function(){var e=$("#new-display-name");e.prop("value",t.friendlyName),e.prop("placeholder",device.name),$("#web-video-stream").text("http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/video.flv"),$("#web-audio-stream").text("http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/audio.adts"),$("#settings-modal").modal()}}()}("undefined"==typeof window?window={}:window);
