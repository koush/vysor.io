!function(e,t){function n(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function o(e){return r(e.length)+e}function r(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}function i(e){return unescape(encodeURIComponent(e))}function s(e){return decodeURIComponent(escape(e))}function a(e){return"ArrayBuffer"==e.constructor.name&&(e=new Uint8Array(e)),s(String.fromCharCode.apply(null,e))}function c(e,t,n){e=i(e);var o=e.length;n&&o++,t||(t=new ArrayBuffer(o));var r=new Uint8Array(t);n&&(r[e.length]=0);for(var s=0,a=e.length;s<a;s++)r[s]=e.charCodeAt(s);return t}function d(e,t,n){"Object"==t.constructor.name&&(t=JSON.stringify(t)),f(e,t+"\n",n)}function l(e,t){function n(){e.read(function(r){for(var i=0;i<r.byteLength;i++)if(r[i]==M){var s=r.subarray(0,i);o.push(s);var c="";for(var d in o)d=o[d],c+=a(d);var l=r.subarray(i+1);return e.unshift(l),void t(c)}o.push(r),n()})}var o=[];n()}function u(e,t,n){var o=function(o){if(4!=o.byteLength)return e.destroy(),void t(null);var i=new DataView(o.buffer,o.byteOffset,4),s=i.getInt32(0,n);e.read(s,r)},r=function(e){i(),t(e)},i=function(){e.read(4,o)};i()}function h(e,t,n,o){var r=new ArrayBuffer(4),i=new DataView(r);i.setInt32(0,t.byteLength,o),e.write(y(new Uint8Array(r),new Uint8Array(t)).buffer,n)}function p(e,t){function n(t){o+=a(t),e.read(n)}var o="";e.onClose=function(){t(o)},e.read(n)}function f(e,t,n){"Object"==t.constructor.name&&(t=JSON.stringify(t)),e.write(c(t),n)}function y(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}function g(e){for(var t=new ArrayBuffer(e.length/2),n=new Uint8Array(t),o=0;o<e.length/2;o++){var r=e.substr(2*o,2);n[o]=parseInt(r,16)}return t}function m(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,r=0;r<o;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}function v(e,t){t||(t=window.location);for(var n=t.search.substring(1),o=n.split("&"),r=0;r<o.length;r++){var i=o[r].split("=");if(decodeURIComponent(i[0])==e)return decodeURIComponent(i[1])}}function w(e,t,n,o){return e||(e={items:[]}),e.items.push(t),e.timeout||(e.timeout=setTimeout(function(){delete e.timeout,o(e.items),e.items=[]},n)),e}function b(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t)}function A(e,t){if(console.log("notification:",e),window.chrome&&window.chrome.notifications){var n=chrome.runtime.getManifest(),o=n.name;t=t||n.icons[128],chrome.notifications.create({type:"basic",iconUrl:t,title:o,message:e})}}function k(){}function S(e,t){this.promise=fetch(e).then(function(e){this.connected=!0,this.response=e,this.reader=this.response.body.getReader(),this.reader.closed.then(function(){this.onClose&&this.dataReceived(null)}.bind(this)),this.onResume(),t(this)}.bind(this),function(e){t(null,e)})}function C(e){this.internalRead=this.read,this.read=this.readWrapper,this.file=e,this.fileRead=0}function I(e){e&&(this.dataReceived(e),this.dataReceived(null))}function O(){var e={showSoftKeys:!0,pinTitleBar:!0,alwaysOnTop:!1,bitrate:0,resolution:0,decoder:0,displaySettings:V[0],dimDisplay:!1};return e}function T(e){return e?(e.friendlyName&&!e.friendlyName.length&&delete e.friendlyName,e):null}function R(e){window.chrome&&window.chrome.storage?chrome.storage.local.get("device-settings",function(t){e(t["device-settings"]||{})}):e({})}function E(e,t){e||(e="web");var n=O();"inkwire"==e&&(n.pinTitleBar=!1,n.showSoftKeys=!1),R(function(o){t(T(o[e]||n))})}function D(e,t,n){return T(t),window.chrome&&window.chrome.storage&&e&&e.indexOf("127.0.0.1")==-1?void R(function(o){o[e]=t,chrome.storage.local.set({"device-settings":o},n)}):void(n&&n())}function N(){for(var e in V){var t=V[e],n=new Option;$(n).html(t.name),$("#display-settings").append(n)}}function P(e){$("#new-display-name").prop("value",e.friendlyName||null),$("#softkeys-check").prop("checked",!!e.showSoftKeys).change(),$("#pin-title-check").prop("checked",!!e.pinTitleBar).change(),$("#always-on-top-check").prop("checked",!!e.alwaysOnTop).change(),$("#bitrate").prop("selectedIndex",e.bitrate||0),$("#decoder").prop("selectedIndex",e.decoder||0),$("#resolution").prop("selectedIndex",e.resolution||0);var t=e.displaySettings&&e.displaySettings.name,n=0;for(var o in V){var r=V[o];if(r.name==t){n=o;break}}$("#display-settings").prop("selectedIndex",n),$("#dim-display").prop("checked",!!e.dimDisplay)}function x(e){var t=$("#notificationModal"),n=t.find("#modal-ok"),o=t.find("#modal-cancel");n.unbind("click"),o.unbind("click"),t.unbind("hidden.bs.modal"),e.cancelButton=e.cancelButton||"Cancel",e.okButton=e.okButton||"OK",e.title=e.title||chrome.runtime.getManifest().name,e.body=e.body||"",e.hideCancel?o.hide():o.show(),n.text(e.okButton),o.text(e.cancelButton),t.find("#modal-title").text(e.title),t.find("#modal-body").html(e.body);var r;n.click(function(){r=!0,e.ok&&e.ok()||$("#notificationModal").modal("hide")}),e.cancel&&(t.on("hidden.bs.modal",function(){r||e.cancel()}),o.click(e.cancel)),$("#notificationModal").modal(),e.duration&&setTimeout(function(){$("#notificationModal").modal("hide")},e.duration)}function _(e,t){x({title:e,body:t,duration:8e3,hideCancel:!0})}function U(e){const t=e.getUint8(0),n=e.getUint8(1),o=t>>4&1,r=n>>>7,i=15&t,s=4*i+(o?16:12),a=e.buffer.slice(e.byteOffset+s);return{id:e.getUint16(2),timestamp:e.getUint32(4),ssrc:e.getUint32(8),length:a.byteLength,marker:r,payload:a}}function L(e){this.context=e,this.numSamples=1024,this.numSamplesDiv2=this.numSamples/2,this.numSamplesDiv4=this.numSamples/4,this.cleanup=this.numSamples/2,this.samples=new Array(this.numSamples),this.lastIndex=0}function B(){var e=this.audioListener=new Server;e.listen({port:0,address:"127.0.0.1"},function(e){e.bufferWrites=!0,u(e,function(t){if(t){var n,o=$protobuf.roots.default.cast_channel.CastMessage.decode(t);o.payloadUtf8&&(n=JSON.parse(o.payloadUtf8));var r=this.onMessage[o.namespace];return r?void r.bind(this)(e,o,n).async():void console.error("unhandled cast message",o)}}.bind(this))}.bind(this)),this.castId="fb720c4cbabca202da80e378fc8474dee136e04f"}var M="\n".charCodeAt(0);Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t};(new Date).getTime();String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}),Object.fromArray=function(e){var t={};for(var n in e){var o=e[n];t[o]=o}return t},$.ajaxTransport("+binary",function(e,t,n){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,n){var o=new XMLHttpRequest,r=e.url,i=e.type,s=e.async||!0,a=e.responseType||"blob",c=e.data||null,d=e.username||null,l=e.password||null;o.addEventListener("load",function(){var t={};t[e.dataType]=o.response,n(o.status,o.statusText,t,o.getAllResponseHeaders())}),o.addEventListener("error",function(){n(o.status,o.statusText,null,o.getAllResponseHeaders())}),o.open(i,r,s,d,l);for(var u in t)o.setRequestHeader(u,t[u]);o.responseType=a,o.send(c)},abort:function(){n.abort()}}});(function(){var e={};return function(t,n){if(e[t])return void n(e[t]);var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="blob",o.onload=function(o){n(e[t]=window.URL.createObjectURL(this.response))},o.send()}})();!function(){function*e(){}var t=e();t.constructor.prototype.async=function(){function e(){r=o.throw(new Error(arguments)),n()}function t(){var e=arguments[0];r=o.next(e),n()}function n(n){var i,s;if(!r.done){if(!r.value)return void(r=o.next(t));if(r.value.constructor==Promise)return void r.value.then(t).catch(e);if(r.value==Error)i=!0,r=o.next(e);else{if(r.value!=k)throw new Error("Unexpected yield value for callback. Only Error and Success allowed.");s=!0,r=o.next(t)}if(!r.value)throw new Error("Double yield callbacks must explicitly define both Error and Success");if(r.value==Error&&i)throw new Error("Error callback already defined");if(r.value==k&&s)throw new Error("Success callback already defined");if(r.value!=Error&&r.value!=k)throw new Error("Unexpected yield value for callback. Only Error and Success allowed.");r=i?o.next(t):o.next(e)}}var o=this,r=o.next();r.done||n()}}(),window.isElectron=function(){return navigator.userAgent.indexOf("Electron")!=-1},isElectron()||(window.sharedGlobals=window),function(){function e(e){try{for(var t in e)e[t]&&e[t].constructor!=String&&(e[t]=JSON.stringify(e[t]));r+=e.join(" ")+"\n"}catch(e){}}function t(e){return new Promise(function(t,n){return e.getConsoleLog?void e.getConsoleLog(function(e){t({content:e&&e.length?e:"log is empty"})}):void t("getConsoleLog not found")})}var n=console.log,o=console.error,r="";console.error=function(){o.apply(console,arguments),e(Array.prototype.slice.call(arguments))},console.log=function(){n.apply(console,arguments),e(Array.prototype.slice.call(arguments))},sharedGlobals.getConsoleLog=function(e){e(r)},window.gistConsoleLog=function(e,n){chrome.runtime.getBackgroundPage(function(o){t(o).then(function(n){e["background.txt"]=n;var o=chrome.app.window.getAll(),r=o.map(function(n){return t(n.contentWindow).then(function(t){e["window-"+n.id+".txt"]=t})});return Promise.all(r)}).then(function(){var t={description:chrome.runtime.getManifest().name+" console log",public:!1,files:e};fetch("https://vysor.io/gist",{method:"POST",body:JSON.stringify(t)}).then(function(e){e.json().then(function(e){n(e.html_url)})})})})}}(),function(){function e(e){this.buffer=new ArrayBuffer(e),this.dataView=new DataView(this.buffer),this.uint8array=new Uint8Array(this.buffer),this.littleEndian=!1,this.position=0,this.limit=e,this.capacity=e}function t(t,n){var o=8*n,r=t+o,i="get"+r,s="set"+r,a="put"+r;e.prototype[i]=function(){if(this.position+n>this.limit)throw new Error("Not enough room in byte buffer");var e=this.dataView[i](this.position,this.littleEndian);return this.position+=n,e},e.prototype[a]=function(e){if(this.position+n>this.limit)throw new Error("Not enough room in byte buffer");if(null==e||void 0==e||NaN==e||e.constructor!=Number)throw new Error("no value provided");return this.dataView[s](this.position,e,this.littleEndian),this.position+=n,this}}e.prototype.flip=function(){this.limit=this.position,this.position=0},e.prototype.asUint8Array=function(){return this.uint8array.subarray(this.position,this.limit)};var n={Int:[1,2,4],Uint:[1,2,4],Float:[4,8]};for(var o in n){var r=n[o];for(var i in r){var i=r[i];t(o,i)}}e.prototype.put=function(e){if(e.constructor==Number)return this.putInt8(e);if(e.constructor==String&&(e=c(e)),e.constructor==ArrayBuffer&&(e=new Uint8Array(e)),this.position+e.byteLength>this.limit)throw new Error("Not enough room in byte buffer");return this.uint8array.set(e,this.position),this.position+=e.byteLength,this},e.prototype.putByte=e.prototype.putInt8,e.prototype.putShort=e.prototype.putInt16,e.prototype.putInt=e.prototype.putInt32,e.prototype.putFloat=e.prototype.putFloat32,e.prototype.putDouble=e.prototype.putFloat64,window.ByteBuffer=e}(),window.chrome&&window.chrome.sockets&&(chrome.sockets.tcp.onReceive.addListener(function(e){var t=Socket.readers[e.socketId];null!=t&&t.dataReceived(new Uint8Array(e.data))}),chrome.sockets.tcp.onReceiveError.addListener(function(e){var t=Socket.readers[e.socketId];null!=t&&(t.destroy(),t.dataReceived(null))}),chrome.sockets.tcpServer.onAccept.addListener(function(e){chrome.sockets.tcp.setPaused(e.clientSocketId,!1);var t=Server.listeners[e.socketId];null!=t&&t(new Socket({socketId:e.clientSocketId}))})),function(){function e(t,n){if(t.socketId)this.socketId=t.socketId,e.readers[this.socketId]=this;else if(window.chrome&&window.chrome.sockets)chrome.sockets.tcp.create(function(o){this.socketId=o.socketId,chrome.sockets.tcp.connect(this.socketId,t.host,t.port,function(t){t?(chrome.runtime.lastError,this.destroy(),n(null)):(e.readers[o.socketId]=this,n(this))}.bind(this))}.bind(this));else{var o;t.ns?(this.ns=t.ns,o=!0):(this.ns=new require("net").Socket(),this.ns.connect({port:t.port,host:t.host},function(){o=!0,n(this)}.bind(this))),this.ns.on("close",function(){this.destroy(),o||n(null)}.bind(this)),this.ns.on("data",function(e){this.dataReceived(e)}.bind(this))}}function t(){}e.readers={},e.connect=function(t,n){return new e(t,n)},e.pump=function(e,t,n){if(!e||!t)return console.error("Socket.pump called with null socket",e,t),void n();var o=function(){e.read(r)}.bind(e),r=function(e){var n=e.buffer;(e.byteOffset||e.length!=n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+e.length)),t.write(n,o)}.bind(t);e.read(r),e.onClose=n},e.stream=function(t,n,o){e.pump(t,n,function(){if(n&&n.destroy(),o){var e=o;o=null,e()}}),e.pump(n,t,function(){if(t&&t.destroy(),o){var e=o;o=null,e()}})},e.eat=function(e){function t(){e.read(t)}t()},e.prototype.read=function(){if(this.pendingCallback)throw new Error("double callback");if(this.closed&&!this.pending){var e=this.onClose;return void(e&&(delete this.onClose,e()))}var t=0;"Number"==arguments[t].constructor.name?this.pendingLength=arguments[t++]:this.pendingLength=0;var e=arguments[t];if(!this.pending||this.paused)return void(this.pendingCallback=e);if(this.pendingLength){if(this.pendingLength>this.buffered())return void(this.pendingCallback=e)}else this.pendingLength=this.buffered();for(var n,o=0;o<this.pendingLength;){var r=this.pending.shift();this.bufferedLength-=r.length,this.pending.length||delete this.pending;var i=r,s=Math.min(i.byteLength,this.pendingLength-o);if(s!=i.byteLength){var a=i.subarray(0,s),c=i.subarray(s);this.unshift(c),i=a}n||i.byteLength==this.pendingLength||(n=new Uint8Array(this.pendingLength)),n?n.set(i,o):n=i,o+=i.byteLength}e(n)},e.prototype.write=function(e,t){if(this.pendingWrite)if(this.bufferWrites){null!=t&&console.error("using callbacks in buffered mode?");var n=this.pendingWrite;this.pendingWrite=function(){n&&n(),this.write(e,t)}.bind(this)}else console.error("write is already in progress!");if(null==t&&(this.bufferWrites||console.error("write callback is null?"),t=function(){}),this.pendingWrite=t,window.chrome&&window.chrome.sockets)chrome.sockets.tcp.send(this.socketId,e,function(n){return chrome.runtime.lastError,!n||n.resultCode?void delete this.pendingWrite:void(n.bytesSent<e.byteLength?this.write(e.slice(n.bytesSent),t):(delete this.pendingWrite,t()))}.bind(this));else{if(!this.ns)return;if(!e.byteLength)return void require("process").nextTick(function(){delete this.pendingWrite,t()}.bind(this));const n=window.Buffer||require("buffer").Buffer;this.ns.write(n.from(e),function(){delete this.pendingWrite,t()}.bind(this))}},e.prototype.destroy=function(e,t){window.chrome&&window.chrome.sockets?chrome.sockets.tcp.close(this.socketId,function(){chrome.runtime.lastError}):(this.dataReceived(null),this.ns&&(this.ns.destroy(),delete this.ns))},e.prototype.unshift=function(e){0!=e.byteLength&&(this.pending?this.pending.unshift(e):this.pending=[e],this.bufferedLength||(this.bufferedLength=0),this.bufferedLength+=e.length)},e.prototype.dataReceived=function(e){if(e&&(e.asUint8Array&&(e=e.asUint8Array()),e.constructor==ArrayBuffer&&(e=new Uint8Array(e))),e&&e.length){var t=new Uint8Array(e);this.pending?this.pending.push(t):this.pending=[t]}if(null==e?this.closed=!0:(this.bufferedLength||(this.bufferedLength=0),this.bufferedLength+=e.length),this.paused||!this.pending||!this.pending.length){var n=this.onClose;return void(this.closed&&n&&(delete this.onClose,n()))}var o=this.pendingLength,n=this.pendingCallback;n&&(delete this.pendingCallback,this.read(o,n))},e.prototype.buffered=function(){return this.bufferedLength},e.prototype.pause=function(){this.paused||(this.paused=!0,this.onPause())},e.prototype.resume=function(){this.paused&&(this.paused=!1,this.onResume())},e.prototype.onResume=function(){chrome.sockets.tcp.setPaused(this.socketId,!1,function(){})},e.prototype.onPause=function(){chrome.sockets.tcp.setPaused(this.socketId,!0,function(){})},t.listeners={},t.prototype.__proto__=e.prototype,t.prototype.destroy=function(){window.chrome&&window.chrome.sockets?chrome.sockets.tcpServer.close(this.socketId,function(){chrome.runtime.lastError}):this.ns&&(this.ns.close(),delete this.ns)},t.prototype.listen=function(n,o,r){var i,s;"Number"==n.constructor.name?(i=n,s="0.0.0.0"):(s=n.address,i=n.port),window.chrome&&window.chrome.sockets?chrome.sockets.tcpServer.create(function(e){this.socketId=e.socketId,t.listeners[this.socketId]=o,chrome.sockets.tcpServer.listen(e.socketId,s,i,function(e){return chrome.runtime.lastError,e?(this.destroy(),void(r&&r(e))):void chrome.sockets.tcpServer.getInfo(this.socketId,function(t){this.localAddress=t.localAddress,this.localPort=t.localPort,r&&r(e)}.bind(this))}.bind(this))}.bind(this)):(this.ns=require("net").createServer(function(t){o(new e({ns:t}))}.bind(this)),this.ns.on("close",function(){this.destroy()}.bind(this)),this.ns.on("error",function(e){r&&r(e)}.bind(this)),this.ns.on("listening",function(){var e=this.ns.address();this.localAddress=e.address,this.localPort=e.port,r&&r()}.bind(this)),this.ns.listen({port:i,host:s}))},window.Socket=e,window.Server=t}(),S.connect=function(e,t){new S(e,t)},S.prototype.write=function(e,t){throw new Error("write not supported on fetch socket")},S.prototype.destroy=function(){this.promise&&this.promise.cancel&&this.promise.cancel()},S.prototype.unshift=Socket.prototype.unshift,S.prototype.dataReceived=Socket.prototype.dataReceived,S.prototype.read=Socket.prototype.read,S.prototype.pause=Socket.prototype.pause,S.prototype.resume=Socket.prototype.resume,S.prototype.buffered=Socket.prototype.buffered,S.prototype.onPause=function(){},S.prototype.onResume=function(){this.reader.read().then(function(e){e.value&&(this.dataReceived(e.value),this.paused||this.onResume())}.bind(this))},C.prototype.write=function(e,t){throw new Error("write not supported on file socket")},C.prototype.destroy=function(){},C.prototype.buffered=Socket.prototype.buffered,C.prototype.unshift=Socket.prototype.unshift,C.prototype.dataReceived=Socket.prototype.dataReceived,C.prototype.read=Socket.prototype.read,C.prototype.pause=Socket.prototype.pause,C.prototype.resume=Socket.prototype.resume,C.prototype.buffered=Socket.prototype.buffered,C.prototype.onPause=function(){},C.prototype.onResume=function(){},C.prototype.readWrapper=function(){if(this.internalRead.apply(this,arguments),this.pendingCallback){var e=this.pendingLength;if(e||(e=65536),e=Math.min(this.file.size-this.fileRead,e),0==e)return void this.dataReceived(null);var t=this.file.slice(this.fileRead,this.fileRead+e);this.fileRead+=e;var n=new FileReader;n.addEventListener("loadend",function(e){this.dataReceived(new Uint8Array(n.result))}.bind(this)),n.readAsArrayBuffer(t)}},function(){function e(e,t){this.conn=e,this.dc=t,this.gotEof=!1,t.onmessage=function(e){var t=new Uint8Array(e.data),n=1==t[t.byteLength-1];this.dataReceived(t.subarray(0,t.byteLength-1)),n&&(this.gotEof=!0,this.destroy())}.bind(this),t.onclose=t.onerror=this.destroy.bind(this),this.needsBufferShim=!0}function t(e,t,n){this.manager=e,this.pc=t,this.key=n,this.pc.oniceconnectionstatechange=function(){"new"!=this.pc.iceConnectionState&&"checking"!=this.pc.iceConnectionState&&delete e.gcmRtcConnections[n],"disconnected"!=this.pc.iceConnectionState&&"closed"!=this.pc.iceConnectionState||this.destroy()}.bind(this)}function n(e,t,n){this.senders=e,this.registrationId=t,this.rtcc=n,this.gcmRtcConnections={},this.gcmRtcListeners={}}e.prototype.buffered=Socket.prototype.buffered,e.prototype.unshift=Socket.prototype.unshift,e.prototype.dataReceived=Socket.prototype.dataReceived,e.prototype.read=Socket.prototype.read,e.prototype.pause=Socket.prototype.pause,e.prototype.resume=Socket.prototype.resume,e.prototype.buffered=Socket.prototype.buffered,e.prototype.writeable=function(){var e=this.writeCallback;e&&(delete this.writeCallback,e())},e.prototype.write=function(e,t){if(!this.dc||"open"!=this.dc.readyState)return void this.destroy();this.writeCallback=t;var n=new Uint8Array(e.byteLength+1);if(n.set(new Uint8Array(e)),this.dc.send(n.buffer),!this.reentrantWrite)try{for(this.reentrantWrite=!0;this.writeCallback&&(0==this.dc.bufferedAmount||this.needsBufferShim);)this.writeable()}finally{this.reentrantWrite=!1}},e.prototype.destroy=function(){if(this.dataReceived(null),null!=this.dc){var e=this.dc;if(this.dc=null,e.onclose=null,e.onerror=null,"open"==e.readyState)try{e.send(new Uint8Array([1])),this.gotEof?this.conn.recycleChannel(e):this.conn.waitForEof(e)}catch(e){}}},t.prototype.waitForCommand=function(t){t.onmessage=function(n){if(1!=n.data.byteLength){this.removeChannel(t);var o=a(n.data),r=new e(this,t);this.openSocket(o,r)}}.bind(this)},t.prototype.compactChannels=function(){this.inboundChannels&&!this.inboundChannels.length&&(this.inboundChannels=null),this.outboundChannels&&!this.outboundChannels.length&&(this.outboundChannels=null)},t.prototype.getAppropriateChannels=function(e,t){var n;return e.inbound?(!this.inboundChannels&&t&&(this.inboundChannels=[]),n=this.inboundChannels):(!this.outboundChannels&&t&&(this.outboundChannels=[]),n=this.outboundChannels),n},t.prototype.removeChannel=function(e){if(channels=this.getAppropriateChannels(e),channels){var t=channels.indexOf(e);t!=-1&&(channels.splice(t,1),this.compactChannels())}},t.prototype.waitForEof=function(e){e.onmessage=function(t){var n=new Uint8Array(t.data),o=1==n[n.byteLength-1];o&&this.recycleChannel(e)}.bind(this)},t.prototype.recycleChannel=function(e){var t=this.getAppropriateChannels(e,!0);t.push(e),e.onclose=e.onerror=function(){this.removeChannel(e)}.bind(this),this.waitForCommand(e)},t.prototype.addCandidates=function(e){for(var t in e.candidates)this.pc.addIceCandidate(new RTCIceCandidate(e.candidates[t]))},t.prototype.setupPinger=function(e){function t(){e.send(c("ping")),n=setTimeout(t,1e3)}var n;e.onmessage=function(e){},e.onclose=e.onerror=function(){clearTimeout(n),this.destroy()}.bind(this),t()},t.prototype.listenSockets=function(){this.pc.ondatachannel=function(e){e.channel.inbound=!0,this.waitForCommand(e.channel)}.bind(this)},t.prototype.prepareChannel=function(e){var t=this.pc.createDataChannel(e||"gcm",{reliable:!0,ordered:!0});return t.binaryType="arraybuffer",t},t.prototype.newSocket=function(t,n){if("closed"==this.pc.signalingState)return void n();if(this.outboundChannels){var o=this.outboundChannels.shift();this.compactChannels(),o.send(c(t));var r=new e(this,o);return void n(r,this)}var o=this.prepareChannel("gcm");o.onopen=function(){o.send(c(t));var r=new e(this,o);n(r,this)}.bind(this)},t.prototype.destroy=function(){delete this.manager.gcmRtcConnections[this.key],"closed"!=this.pc.signalingState&&this.pc.close();var e=this.onClose;e&&(delete this.onClose,e())},n.prototype.onMessage=function(e){var t=JSON.parse(e.message),o=e.type,r=e.senderId,i=e.src,s=e.srcPort,a=e.dstPort;if("offer"==o){var c=this.gcmRtcListeners[a];return void(c?c.listener.incoming(r,i,s,a,t,c.listenCallback):console.log("not listening on "+a))}if("answer"==o){var d=n.getKey(i,s,a),l=this.gcmRtcConnections[d];return l?void l.manager.incoming(r,i,s,a,t):void console.log("pending connection not found")}n.onUnknownMessage?n.onUnknownMessage(e):console.log("unknown message "+o)},n.hasLoadedChannels=!1,n.start=function(e,t,o){if(console.log("starting GtcRtcManger"),window.chrome&&window.chrome.gcm){var r=Object.keys(e);chrome.gcm.register(r,function(r){if(chrome.runtime.lastError,!r)return void o();var i=new n(e,r,t);chrome.gcm.onMessage.addListener(function(e){i.onMessage(e.data)}),o(i)})}else{var i=new n(e,null,t);$.getScript("https://push.clockworkmod.com/socket.io/socket.io.js",function(){var e=io("https://push.clockworkmod.com");e.on("registration",function(e){e="web:"+e,i.registrationId?(i.registrationId=e,i.onRegistrationIdChanged&&i.onRegistrationIdChanged(e)):(i.registrationId=e,o(i))}),e.on("data",function(e){i.onMessage(e)})})}},n.prototype.ensureChannel=function(){function e(){return delete n.channelPromise,n.gcmRtcConnections={},n.channel&&(delete n.channel,!Object.keys(n.gcmRtcListeners).length)?void console.log("not reconnecting, no listeners"):void t()}function t(){console.error("scheduling gcm reconnect"),n.reconnectTimeout=w(n.reconnectTimeout,null,3e5,function(){console.error("reconnecting gcm"),n.ensureChannel()})}if(this.channel)return Promise.resolve();var n=this;return this.channelPromise?this.channelPromise:this.channelPromise=new Promise(function(o,r){$.ajax({type:"GET",url:"https://vysor-1026.appspot.com/listen",error:function(){delete n.channelPromise,console.error("error ensuring gcm channe",error),t()},success:function(t){var r=new goog.appengine.Channel(t.token),i={onopen:function(){n.channel=r;var e="web:"+t.channel;n.registrationId=e,n.onRegistrationIdChanged&&n.onRegistrationIdChanged(e),o()},onmessage:function(e){n.onMessage(JSON.parse(e.data))},onerror:function(){console.error("gcm onerror",arguments),e()},onclose:function(){console.error("gcm onclose",arguments),e()}};r.open(i)}})})},n.prototype.sendGcm=function(e,t,n,o,r,i){e||(e=this.defaultSenderId),t.startsWith("web:")?$.ajax({type:"POST",url:"https://vysor-1026.appspot.com/send",data:JSON.stringify({channel:t.substring(4),data:{senderId:e,src:this.registrationId,srcPort:o,dstPort:n,type:r,message:JSON.stringify(i)}}),contentType:"application/json",dataType:"json",success:function(){}}):$.ajax({type:"POST",url:"https://gcm-http.googleapis.com/gcm/send",headers:{Authorization:"key="+this.senders[e]},data:JSON.stringify({to:t,data:{senderId:e,src:this.registrationId,srcPort:o,dstPort:n,type:r,message:JSON.stringify(i)}}),contentType:"application/json",dataType:"json",error:function(){console.log("gcm error",arguments)},success:function(){console.log("gcm",arguments)}})},n.getKey=function(e,t,n){return n+":"+t+":"+e},n.prototype.setupPeerConnection=function(e,o,r,i,s,a){var c,d=window.RTCPeerConnection||window.webkitRTCPeerConnection,l=new d(this.rtcc),u=function(t){var n=[];for(var c in t)c=t[c],n.push(c),JSON.stringify(n).length>3200&&(this.sendGcm(o,r,i,s,e,{desc:a(),candidates:n}),n=[]);n.length>0&&this.sendGcm(o,r,i,s,e,{desc:a(),candidates:n})}.bind(this);l.onicecandidate=function(e){null!=e.candidate&&(console.log(e.candidate),c=w(c,e.candidate,500,u))}.bind(this);var h=n.getKey(r,i,s),p=new t(this,l,h);return l.onsignalingstatechange=function(e){"stable"==l.signalingState?this.gcmRtcConnections[h]==p:"closed"==l.signalingState&&p.destroy()}.bind(this),this.gcmRtcConnections[h]=p,p},n.gcmPortCount=0,n.prototype.connect=function(e,t){function o(e){l.createOffer(e).then(function(e){r=e,l.setLocalDescription(e)})}var r,i=e.senderId,s=e.registrationId,a=e.port,c=n.gcmPortCount++,d=this.setupPeerConnection("offer",i,s,a,c,function(){return r}),l=d.pc;if(e.audio)navigator.webkitGetUserMedia({audio:!0,video:!1},function(e){l.addStream(e),l.onaddstream=function(e){console.log("got the remote stream"),t(d,e)},o({offerToReceiveAudio:!0,offerToReceiveVideo:!1,voiceActivityDetection:!1})},function(){console.error("audio fail",arguments),o({offerToReceiveAudio:!0,offerToReceiveVideo:!1,voiceActivityDetection:!1})});else{var u=d.prepareChannel("pinger");u.onopen=function(){console.log("got rtc pinger"),d.setupPinger(u),t(d)},d.listenSockets(),o({})}},n.prototype.isListening=function(e){return null!=this.gcmRtcListeners[e]},n.prototype.stopListen=function(e){delete this.gcmRtcListeners[e]},n.prototype.listen=function(e,t){return this.gcmRtcListeners[e]?void console.log("already listening on gcm port "+e):void(this.gcmRtcListeners[e]={listener:this,listenCallback:t})},n.prototype.incoming=function(e,t,o,r,i,s){var a=n.getKey(t,o,r),c=this.gcmRtcConnections[a];if(c){if(!c.remoteDesc){c.remoteDesc=new RTCSessionDescription(i.desc);var d=c.pc;d.setRemoteDescription(c.remoteDesc)}}else{var l;c=this.setupPeerConnection("answer",e,t,o,r,function(){return l}),c.remoteDesc=new RTCSessionDescription(i.desc);var d=c.pc;d.ondatachannel=function(e){console.log("got rtc pinger"),this.setupPinger(e.channel),s(c),this.listenSockets()}.bind(c),d.setRemoteDescription(c.remoteDesc,function(){d.createAnswer().then(function(e){l=e,d.setLocalDescription(e)},function(){console.error("answer error",arguments)})})}c.addCandidates(i)},window.GcmRtcSocket=e,window.GcmRtcManager=n}(),I.prototype.write=function(e,t){throw new Error("write not supported on dummy socket")},I.prototype.destroy=function(){this.dataReceived(null)},I.prototype.buffered=Socket.prototype.buffered,I.prototype.unshift=Socket.prototype.unshift,I.prototype.dataReceived=Socket.prototype.dataReceived,I.prototype.read=Socket.prototype.read,I.prototype.pause=Socket.prototype.pause,I.prototype.resume=Socket.prototype.resume,I.prototype.buffered=Socket.prototype.buffered,I.prototype.onPause=function(){},I.prototype.onResume=function(){},function(){function e(){}var t={};t.sendHostCommand=function(e,t){Socket.connect({host:"127.0.0.1",port:5037},function(n){if(!n)return void t();var o=e;e=r(e.length)+e,n.read(4,function(e){var r=a(e);return"OKAY"!=r?(console.error("error in response to adb host command",o,r),n.destroy(),void t()):void n.read(4,function(e){var o=a(e);return e=parseInt(o,16),0==e||"OKAY"==o?void t(n,new ArrayBuffer(0)):void n.read(e,function(e){t(n,e)})})}),n.write(c(e),function(){})})},t.devices=function(e){function n(e){var t=e;e=e.replace("\t"," ");var n=e.indexOf(" ");if(n!=-1){var r=e.substring(0,n);e=e.substring(n).trim();for(var i;i!=e;)i=e,e=e.replace("  "," ");var s={},a=e.indexOf(" ");a==-1&&(a=e.length);var c=e.substring(0,a);for(e=e.substring(a+1);e.length&&(n=e.indexOf(":"),n!=-1);){var d,l=e.substring(0,n),u=e.substring(n+1),h=u.indexOf(" "),p=u.indexOf(":");if(h==-1||p==-1)d=u,e="";else for(;h!=-1&&h<p;)d=u.substring(0,h),e=u.substring(h+1),h=u.indexOf(" ",h+1);s[l]=d}var f;f=s.model?s.model.replace("_"," "):r,o[r]={serialno:r,name:f,status:c,properties:t}}}var o={};t.sendHostCommand("host:devices-l",function(t,r){if(!t)return void e();t.destroy(),r=a(r),console.log("ADB devices:",r),r=r.trim();var i=r.split("\n");for(var s in i)s=i[s],n(s);console.log("parsed ADB devices:",o),e(o)})},t.killServer=function(e){t.sendHostCommand("host:kill-server",function(t,n){return t?(t.destroy(),n=a(n),void(e&&e())):void e()})},t.sendClientCommand=function(e,t){var n=e.command,o=e.serialno;Socket.connect({host:"127.0.0.1",port:5037},function(e){if(!e)return void t();e.read(4,function(o){var i=a(o);if("OKAY"!=i)return e.destroy(),void t(null);var s=n;s=r(s.length)+s,e.read(4,function(n){var o=a(n);return"OKAY"!=o?(e.destroy(),void t(null)):void t(e)}),e.write(c(s),function(){})});var i="host:transport:"+o;i=r(i.length)+i,e.write(c(i),function(){})})},t.shell=function(e,n){var o=e.command;e.serialno;t.getOrCreateSockFactory(e).newSocket("shell:"+o,function(e){return e?void p(e,function(e){n(e)}):void n()})},t.forward=function(e,n){var o="host-serial:"+e.serialno+":forward:"+e.from+";"+e.to;t.sendHostCommand(o,function(e,t){e&&e.destroy(),n(e,t)})},t.reverse=function(e,n){var o="reverse:forward:"+e.from+";"+e.to;t.sendClientCommand({serialno:e.serialno,command:o},function(e,t){e?p(e,n):n()})},e.MKID=function(e,t,n,o){return e.charCodeAt(0)|t.charCodeAt(0)<<8|n.charCodeAt(0)<<16|o.charCodeAt(0)<<24},e.ID_RECV=e.MKID("R","E","C","V"),e.ID_SEND=e.MKID("S","E","N","D"),e.ID_DONE=e.MKID("D","O","N","E"),e.ID_DATA=e.MKID("D","A","T","A"),e.DATA_MAX=65536,t.pull=function(n,o){var r=n.file,i=(n.serialno,n.fileEntry),s=n.socket;s||!function(){var e;s={write:function(t,n){return e?(e.onwriteend=n,void e.write(new Blob([t]))):void i.createWriter(function(o){
e=o,s.write(t,n)})}}}();var a=new I;Socket.pump(a,s,function(){o(i)}),t.getOrCreateSockFactory(n).newSocket("sync:",function(t){function n(e){t.read(e,function(e){a.dataReceived(e),i()})}function i(){t.read(8,function(r){var i=new DataView(r.buffer,r.byteOffset,r.byteLength),s=i.getUint32(0,!0);if(s==e.ID_DATA){var c=i.getUint32(4,!0);return void n(c)}return t.destroy(),s==e.ID_DONE?void a.dataReceived(null):void o()})}if(!t)return void o();var s=new ArrayBuffer(8),d=new DataView(s);d.setUint32(0,e.ID_RECV,!0),d.setUint32(4,r.length,!0),t.write(s,function(){t.write(c(r),function(){i()})})})},t.createSocketFactory=function(e){return{newSocket:function(n,o){t.sendClientCommand({serialno:e,command:n},o)}}},t.getOrCreateSockFactory=function(e){return e.socketFactory||t.createSocketFactory(e.serialno)},t.push=function(n,o){var r=n.file,i=(n.serialno,n.socket);t.getOrCreateSockFactory(n).newSocket("sync:",function(t){if(!t)return void o();var n=new ArrayBuffer(8),s=new DataView(n),a=r+",0644";s.setUint32(0,e.ID_SEND,!0),s.setUint32(4,a.length,!0),t.write(n,function(){t.write(c(a),function(){function n(){i.read(function(t){if(t.byteLength>e.DATA_MAX){var n=t.subarray(e.DATA_MAX);t=t.subarray(0,e.DATA_MAX),i.unshift(n)}r(t)})}function r(o){var r=new ArrayBuffer(8),i=new DataView(r);i.setUint32(0,e.ID_DATA,!0),i.setUint32(4,o.byteLength,!0),t.write(r,function(){var e=o.buffer;(o.byteOffset||o.length!=e.byteLength)&&(e=e.slice(o.byteOffset,o.byteOffset+o.byteLength)),t.write(e,function(){n()})})}i.onClose=function(){var n=new ArrayBuffer(8),r=new DataView(n);r.setUint32(0,e.ID_DONE,!0),r.setUint32(4,0,!0),t.write(n,function(){t.read(8,function(){o()})})},n()})})})},window.Adb=t}();var V=[{name:"Default Settings",size:"reset",density:"reset"},{name:"Resizable (96dpi)",size:"reset",density:"96",freeSize:!0},{name:"Resizable (144dpi)",size:"reset",density:"144",freeSize:!0},{name:"1080p (96dpi)",size:"1920x1080",density:"96"},{name:"4K (144dpi)",size:"3840x2160",density:"144"},{name:"Galaxy Nexus",size:"720x1280",density:"320"},{name:"Nexus 4",size:"768x1280",density:"320"},{name:"Nexus 5",size:"1080x1920",density:"480"},{name:"Nexus 6",size:"1440x2560",density:"560"},{name:"Nexus 6p",size:"1440x2560",density:"560"},{name:"Nexus 7 (2012)",size:"800x1280",density:"213"},{name:"Nexus 7 (2013)",size:"1200x1920",density:"320"},{name:"Nexus 9",size:"1536x2048",density:"320"}];$protobuf=protobuf;var F=$protobuf.Reader,j=$protobuf.Writer,z=$protobuf.util,W=$protobuf.roots.default||($protobuf.roots.default={});W.cast_channel=function(){var e={};return e.CastMessage=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.protocolVersion=0,e.prototype.sourceId="",e.prototype.destinationId="",e.prototype.namespace="",e.prototype.payloadType=0,e.prototype.payloadUtf8="",e.prototype.payloadBinary=z.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=j.create()),t.uint32(8).int32(e.protocolVersion),t.uint32(18).string(e.sourceId),t.uint32(26).string(e.destinationId),t.uint32(34).string(e.namespace),t.uint32(40).int32(e.payloadType),null!=e.payloadUtf8&&e.hasOwnProperty("payloadUtf8")&&t.uint32(50).string(e.payloadUtf8),null!=e.payloadBinary&&e.hasOwnProperty("payloadBinary")&&t.uint32(58).bytes(e.payloadBinary),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new W.cast_channel.CastMessage;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.protocolVersion=e.int32();break;case 2:o.sourceId=e.string();break;case 3:o.destinationId=e.string();break;case 4:o.namespace=e.string();break;case 5:o.payloadType=e.int32();break;case 6:o.payloadUtf8=e.string();break;case 7:o.payloadBinary=e.bytes();break;default:e.skipType(7&r)}}if(!o.hasOwnProperty("protocolVersion"))throw z.ProtocolError("missing required 'protocolVersion'",{instance:o});if(!o.hasOwnProperty("sourceId"))throw z.ProtocolError("missing required 'sourceId'",{instance:o});if(!o.hasOwnProperty("destinationId"))throw z.ProtocolError("missing required 'destinationId'",{instance:o});if(!o.hasOwnProperty("namespace"))throw z.ProtocolError("missing required 'namespace'",{instance:o});if(!o.hasOwnProperty("payloadType"))throw z.ProtocolError("missing required 'payloadType'",{instance:o});return o},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";switch(e.protocolVersion){default:return"protocolVersion: enum value expected";case 0:}if(!z.isString(e.sourceId))return"sourceId: string expected";if(!z.isString(e.destinationId))return"destinationId: string expected";if(!z.isString(e.namespace))return"namespace: string expected";switch(e.payloadType){default:return"payloadType: enum value expected";case 0:case 1:}return null!=e.payloadUtf8&&e.hasOwnProperty("payloadUtf8")&&!z.isString(e.payloadUtf8)?"payloadUtf8: string expected":null!=e.payloadBinary&&e.hasOwnProperty("payloadBinary")&&!(e.payloadBinary&&"number"==typeof e.payloadBinary.length||z.isString(e.payloadBinary))?"payloadBinary: buffer expected":null},e.fromObject=function(e){if(e instanceof W.cast_channel.CastMessage)return e;var t=new W.cast_channel.CastMessage;switch(e.protocolVersion){case"CASTV2_1_0":case 0:t.protocolVersion=0}switch(null!=e.sourceId&&(t.sourceId=String(e.sourceId)),null!=e.destinationId&&(t.destinationId=String(e.destinationId)),null!=e.namespace&&(t.namespace=String(e.namespace)),e.payloadType){case"STRING":case 0:t.payloadType=0;break;case"BINARY":case 1:t.payloadType=1}return null!=e.payloadUtf8&&(t.payloadUtf8=String(e.payloadUtf8)),null!=e.payloadBinary&&("string"==typeof e.payloadBinary?z.base64.decode(e.payloadBinary,t.payloadBinary=z.newBuffer(z.base64.length(e.payloadBinary)),0):e.payloadBinary.length&&(t.payloadBinary=e.payloadBinary)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.protocolVersion=t.enums===String?"CASTV2_1_0":0,n.sourceId="",n.destinationId="",n.namespace="",n.payloadType=t.enums===String?"STRING":0,n.payloadUtf8="",t.bytes===String?n.payloadBinary="":(n.payloadBinary=[],t.bytes!==Array&&(n.payloadBinary=z.newBuffer(n.payloadBinary)))),null!=e.protocolVersion&&e.hasOwnProperty("protocolVersion")&&(n.protocolVersion=t.enums===String?W.cast_channel.CastMessage.ProtocolVersion[e.protocolVersion]:e.protocolVersion),null!=e.sourceId&&e.hasOwnProperty("sourceId")&&(n.sourceId=e.sourceId),null!=e.destinationId&&e.hasOwnProperty("destinationId")&&(n.destinationId=e.destinationId),null!=e.namespace&&e.hasOwnProperty("namespace")&&(n.namespace=e.namespace),null!=e.payloadType&&e.hasOwnProperty("payloadType")&&(n.payloadType=t.enums===String?W.cast_channel.CastMessage.PayloadType[e.payloadType]:e.payloadType),null!=e.payloadUtf8&&e.hasOwnProperty("payloadUtf8")&&(n.payloadUtf8=e.payloadUtf8),null!=e.payloadBinary&&e.hasOwnProperty("payloadBinary")&&(n.payloadBinary=t.bytes===String?z.base64.encode(e.payloadBinary,0,e.payloadBinary.length):t.bytes===Array?Array.prototype.slice.call(e.payloadBinary):e.payloadBinary),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.ProtocolVersion=function(){var e={},t=Object.create(e);return t[e[0]="CASTV2_1_0"]=0,t}(),e.PayloadType=function(){var e={},t=Object.create(e);return t[e[0]="STRING"]=0,t[e[1]="BINARY"]=1,t}(),e}(),e.SignatureAlgorithm=function(){var e={},t=Object.create(e);return t[e[0]="UNSPECIFIED"]=0,t[e[1]="RSASSA_PKCS1v15"]=1,t[e[2]="RSASSA_PSS"]=2,t}(),e.HashAlgorithm=function(){var e={},t=Object.create(e);return t[e[0]="SHA1"]=0,t[e[1]="SHA256"]=1,t}(),e.AuthChallenge=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.signatureAlgorithm=1,e.prototype.senderNonce=z.newBuffer([]),e.prototype.hashAlgorithm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=j.create()),null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm")&&t.uint32(8).int32(e.signatureAlgorithm),null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&t.uint32(18).bytes(e.senderNonce),null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm")&&t.uint32(24).int32(e.hashAlgorithm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new W.cast_channel.AuthChallenge;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.signatureAlgorithm=e.int32();break;case 2:o.senderNonce=e.bytes();break;case 3:o.hashAlgorithm=e.int32();break;default:e.skipType(7&r)}}return o},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm"))switch(e.signatureAlgorithm){default:return"signatureAlgorithm: enum value expected";case 0:case 1:case 2:}if(null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&!(e.senderNonce&&"number"==typeof e.senderNonce.length||z.isString(e.senderNonce)))return"senderNonce: buffer expected";if(null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm"))switch(e.hashAlgorithm){default:return"hashAlgorithm: enum value expected";case 0:case 1:}return null},e.fromObject=function(e){if(e instanceof W.cast_channel.AuthChallenge)return e;var t=new W.cast_channel.AuthChallenge;switch(e.signatureAlgorithm){case"UNSPECIFIED":case 0:t.signatureAlgorithm=0;break;case"RSASSA_PKCS1v15":case 1:t.signatureAlgorithm=1;break;case"RSASSA_PSS":case 2:t.signatureAlgorithm=2}switch(null!=e.senderNonce&&("string"==typeof e.senderNonce?z.base64.decode(e.senderNonce,t.senderNonce=z.newBuffer(z.base64.length(e.senderNonce)),0):e.senderNonce.length&&(t.senderNonce=e.senderNonce)),e.hashAlgorithm){case"SHA1":case 0:t.hashAlgorithm=0;break;case"SHA256":case 1:t.hashAlgorithm=1}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.signatureAlgorithm=t.enums===String?"RSASSA_PKCS1v15":1,t.bytes===String?n.senderNonce="":(n.senderNonce=[],t.bytes!==Array&&(n.senderNonce=z.newBuffer(n.senderNonce))),n.hashAlgorithm=t.enums===String?"SHA1":0),null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm")&&(n.signatureAlgorithm=t.enums===String?W.cast_channel.SignatureAlgorithm[e.signatureAlgorithm]:e.signatureAlgorithm),null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&(n.senderNonce=t.bytes===String?z.base64.encode(e.senderNonce,0,e.senderNonce.length):t.bytes===Array?Array.prototype.slice.call(e.senderNonce):e.senderNonce),null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm")&&(n.hashAlgorithm=t.enums===String?W.cast_channel.HashAlgorithm[e.hashAlgorithm]:e.hashAlgorithm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),e.AuthResponse=function(){function e(e){if(this.intermediateCertificate=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.signature=z.newBuffer([]),e.prototype.clientAuthCertificate=z.newBuffer([]),e.prototype.intermediateCertificate=z.emptyArray,e.prototype.signatureAlgorithm=1,e.prototype.senderNonce=z.newBuffer([]),e.prototype.hashAlgorithm=0,e.prototype.crl=z.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=j.create()),t.uint32(10).bytes(e.signature),t.uint32(18).bytes(e.clientAuthCertificate),null!=e.intermediateCertificate&&e.intermediateCertificate.length)for(var n=0;n<e.intermediateCertificate.length;++n)t.uint32(26).bytes(e.intermediateCertificate[n]);return null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm")&&t.uint32(32).int32(e.signatureAlgorithm),null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&t.uint32(42).bytes(e.senderNonce),null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm")&&t.uint32(48).int32(e.hashAlgorithm),null!=e.crl&&e.hasOwnProperty("crl")&&t.uint32(58).bytes(e.crl),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new W.cast_channel.AuthResponse;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.signature=e.bytes();break;case 2:o.clientAuthCertificate=e.bytes();break;case 3:o.intermediateCertificate&&o.intermediateCertificate.length||(o.intermediateCertificate=[]),o.intermediateCertificate.push(e.bytes());break;case 4:o.signatureAlgorithm=e.int32();break;case 5:o.senderNonce=e.bytes();break;case 6:o.hashAlgorithm=e.int32();break;case 7:o.crl=e.bytes();break;default:e.skipType(7&r)}}if(!o.hasOwnProperty("signature"))throw z.ProtocolError("missing required 'signature'",{instance:o});if(!o.hasOwnProperty("clientAuthCertificate"))throw z.ProtocolError("missing required 'clientAuthCertificate'",{instance:o});return o},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(!(e.signature&&"number"==typeof e.signature.length||z.isString(e.signature)))return"signature: buffer expected";if(!(e.clientAuthCertificate&&"number"==typeof e.clientAuthCertificate.length||z.isString(e.clientAuthCertificate)))return"clientAuthCertificate: buffer expected";if(null!=e.intermediateCertificate&&e.hasOwnProperty("intermediateCertificate")){if(!Array.isArray(e.intermediateCertificate))return"intermediateCertificate: array expected";for(var t=0;t<e.intermediateCertificate.length;++t)if(!(e.intermediateCertificate[t]&&"number"==typeof e.intermediateCertificate[t].length||z.isString(e.intermediateCertificate[t])))return"intermediateCertificate: buffer[] expected"}if(null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm"))switch(e.signatureAlgorithm){default:return"signatureAlgorithm: enum value expected";case 0:case 1:case 2:}if(null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&!(e.senderNonce&&"number"==typeof e.senderNonce.length||z.isString(e.senderNonce)))return"senderNonce: buffer expected";if(null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm"))switch(e.hashAlgorithm){default:return"hashAlgorithm: enum value expected";case 0:case 1:}return null!=e.crl&&e.hasOwnProperty("crl")&&!(e.crl&&"number"==typeof e.crl.length||z.isString(e.crl))?"crl: buffer expected":null},e.fromObject=function(e){if(e instanceof W.cast_channel.AuthResponse)return e;var t=new W.cast_channel.AuthResponse;if(null!=e.signature&&("string"==typeof e.signature?z.base64.decode(e.signature,t.signature=z.newBuffer(z.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.clientAuthCertificate&&("string"==typeof e.clientAuthCertificate?z.base64.decode(e.clientAuthCertificate,t.clientAuthCertificate=z.newBuffer(z.base64.length(e.clientAuthCertificate)),0):e.clientAuthCertificate.length&&(t.clientAuthCertificate=e.clientAuthCertificate)),e.intermediateCertificate){if(!Array.isArray(e.intermediateCertificate))throw TypeError(".cast_channel.AuthResponse.intermediateCertificate: array expected");t.intermediateCertificate=[];for(var n=0;n<e.intermediateCertificate.length;++n)"string"==typeof e.intermediateCertificate[n]?z.base64.decode(e.intermediateCertificate[n],t.intermediateCertificate[n]=z.newBuffer(z.base64.length(e.intermediateCertificate[n])),0):e.intermediateCertificate[n].length&&(t.intermediateCertificate[n]=e.intermediateCertificate[n])}switch(e.signatureAlgorithm){case"UNSPECIFIED":case 0:t.signatureAlgorithm=0;break;case"RSASSA_PKCS1v15":case 1:t.signatureAlgorithm=1;break;case"RSASSA_PSS":case 2:t.signatureAlgorithm=2}switch(null!=e.senderNonce&&("string"==typeof e.senderNonce?z.base64.decode(e.senderNonce,t.senderNonce=z.newBuffer(z.base64.length(e.senderNonce)),0):e.senderNonce.length&&(t.senderNonce=e.senderNonce)),e.hashAlgorithm){case"SHA1":case 0:t.hashAlgorithm=0;break;case"SHA256":case 1:t.hashAlgorithm=1}return null!=e.crl&&("string"==typeof e.crl?z.base64.decode(e.crl,t.crl=z.newBuffer(z.base64.length(e.crl)),0):e.crl.length&&(t.crl=e.crl)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.intermediateCertificate=[]),t.defaults&&(t.bytes===String?n.signature="":(n.signature=[],t.bytes!==Array&&(n.signature=z.newBuffer(n.signature))),t.bytes===String?n.clientAuthCertificate="":(n.clientAuthCertificate=[],t.bytes!==Array&&(n.clientAuthCertificate=z.newBuffer(n.clientAuthCertificate))),n.signatureAlgorithm=t.enums===String?"RSASSA_PKCS1v15":1,t.bytes===String?n.senderNonce="":(n.senderNonce=[],t.bytes!==Array&&(n.senderNonce=z.newBuffer(n.senderNonce))),n.hashAlgorithm=t.enums===String?"SHA1":0,t.bytes===String?n.crl="":(n.crl=[],t.bytes!==Array&&(n.crl=z.newBuffer(n.crl)))),null!=e.signature&&e.hasOwnProperty("signature")&&(n.signature=t.bytes===String?z.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),null!=e.clientAuthCertificate&&e.hasOwnProperty("clientAuthCertificate")&&(n.clientAuthCertificate=t.bytes===String?z.base64.encode(e.clientAuthCertificate,0,e.clientAuthCertificate.length):t.bytes===Array?Array.prototype.slice.call(e.clientAuthCertificate):e.clientAuthCertificate),e.intermediateCertificate&&e.intermediateCertificate.length){n.intermediateCertificate=[];for(var o=0;o<e.intermediateCertificate.length;++o)n.intermediateCertificate[o]=t.bytes===String?z.base64.encode(e.intermediateCertificate[o],0,e.intermediateCertificate[o].length):t.bytes===Array?Array.prototype.slice.call(e.intermediateCertificate[o]):e.intermediateCertificate[o]}return null!=e.signatureAlgorithm&&e.hasOwnProperty("signatureAlgorithm")&&(n.signatureAlgorithm=t.enums===String?W.cast_channel.SignatureAlgorithm[e.signatureAlgorithm]:e.signatureAlgorithm),null!=e.senderNonce&&e.hasOwnProperty("senderNonce")&&(n.senderNonce=t.bytes===String?z.base64.encode(e.senderNonce,0,e.senderNonce.length):t.bytes===Array?Array.prototype.slice.call(e.senderNonce):e.senderNonce),null!=e.hashAlgorithm&&e.hasOwnProperty("hashAlgorithm")&&(n.hashAlgorithm=t.enums===String?W.cast_channel.HashAlgorithm[e.hashAlgorithm]:e.hashAlgorithm),null!=e.crl&&e.hasOwnProperty("crl")&&(n.crl=t.bytes===String?z.base64.encode(e.crl,0,e.crl.length):t.bytes===Array?Array.prototype.slice.call(e.crl):e.crl),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),e.AuthError=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.errorType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=j.create()),t.uint32(8).int32(e.errorType),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new W.cast_channel.AuthError;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.errorType=e.int32();break;default:e.skipType(7&r)}}if(!o.hasOwnProperty("errorType"))throw z.ProtocolError("missing required 'errorType'",{instance:o});return o},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";switch(e.errorType){default:return"errorType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof W.cast_channel.AuthError)return e;var t=new W.cast_channel.AuthError;switch(e.errorType){case"INTERNAL_ERROR":case 0:t.errorType=0;break;case"NO_TLS":case 1:t.errorType=1;break;case"SIGNATURE_ALGORITHM_UNAVAILABLE":case 2:t.errorType=2}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.errorType=t.enums===String?"INTERNAL_ERROR":0),null!=e.errorType&&e.hasOwnProperty("errorType")&&(n.errorType=t.enums===String?W.cast_channel.AuthError.ErrorType[e.errorType]:e.errorType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.ErrorType=function(){var e={},t=Object.create(e);return t[e[0]="INTERNAL_ERROR"]=0,t[e[1]="NO_TLS"]=1,t[e[2]="SIGNATURE_ALGORITHM_UNAVAILABLE"]=2,t}(),e}(),e.DeviceAuthMessage=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.challenge=null,e.prototype.response=null,e.prototype.error=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=j.create()),null!=e.challenge&&e.hasOwnProperty("challenge")&&W.cast_channel.AuthChallenge.encode(e.challenge,t.uint32(10).fork()).ldelim(),null!=e.response&&e.hasOwnProperty("response")&&W.cast_channel.AuthResponse.encode(e.response,t.uint32(18).fork()).ldelim(),null!=e.error&&e.hasOwnProperty("error")&&W.cast_channel.AuthError.encode(e.error,t.uint32(26).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var n=void 0===t?e.len:e.pos+t,o=new W.cast_channel.DeviceAuthMessage;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:o.challenge=W.cast_channel.AuthChallenge.decode(e,e.uint32());break;case 2:o.response=W.cast_channel.AuthResponse.decode(e,e.uint32());break;case 3:o.error=W.cast_channel.AuthError.decode(e,e.uint32());break;default:e.skipType(7&r)}}return o},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.challenge&&e.hasOwnProperty("challenge")){var t=W.cast_channel.AuthChallenge.verify(e.challenge);if(t)return"challenge."+t}if(null!=e.response&&e.hasOwnProperty("response")){var t=W.cast_channel.AuthResponse.verify(e.response);if(t)return"response."+t}if(null!=e.error&&e.hasOwnProperty("error")){var t=W.cast_channel.AuthError.verify(e.error);if(t)return"error."+t}return null},e.fromObject=function(e){if(e instanceof W.cast_channel.DeviceAuthMessage)return e;var t=new W.cast_channel.DeviceAuthMessage;if(null!=e.challenge){if("object"!=typeof e.challenge)throw TypeError(".cast_channel.DeviceAuthMessage.challenge: object expected");t.challenge=W.cast_channel.AuthChallenge.fromObject(e.challenge)}if(null!=e.response){if("object"!=typeof e.response)throw TypeError(".cast_channel.DeviceAuthMessage.response: object expected");t.response=W.cast_channel.AuthResponse.fromObject(e.response)}if(null!=e.error){if("object"!=typeof e.error)throw TypeError(".cast_channel.DeviceAuthMessage.error: object expected");t.error=W.cast_channel.AuthError.fromObject(e.error)}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.challenge=null,n.response=null,n.error=null),null!=e.challenge&&e.hasOwnProperty("challenge")&&(n.challenge=W.cast_channel.AuthChallenge.toObject(e.challenge,t)),null!=e.response&&e.hasOwnProperty("response")&&(n.response=W.cast_channel.AuthResponse.toObject(e.response,t)),null!=e.error&&e.hasOwnProperty("error")&&(n.error=W.cast_channel.AuthError.toObject(e.error,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),e}(),L.prototype.verify=function(e){e&&(255==e[0]&&240==(240&e[1])||(this.malformed=w(this.malformed,null,5e3,function(){console.error("got a malformed adts sample?")})))},L.prototype.stop=function(){null!=this.source&&this.source.stop(),this.source=null},L.prototype.decode=function(e,t){var n=this.samples[e];if(null==n)return void(this.silence&&(this.audioBuffer.copyToChannel(this.silence,0,e*this.sampleLength),this.audioBuffer.copyToChannel(this.silence,1,e*this.sampleLength)));var o=(e-1+this.numSamples)%this.numSamples,r=(e+1)%this.numSamples;o=this.samples[o]||n,r=this.samples[r]||n;var i,s=1;o?(s++,i=y(o,n)):i=n,r&&(s++,i=y(i,r)),this.context.decodeAudioData(i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength),function(t){if(!this.source){this.sampleLength=t.length/s;var n=new AudioBuffer({length:this.sampleLength,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate});this.silence=new Float32Array(this.sampleLength),n.copyFromChannel(this.silence,0),this.audioBuffer=new AudioBuffer({length:this.sampleLength*this.numSamples,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate}),this.source=this.context.createBufferSource(),this.source.buffer=this.audioBuffer,this.source.loop=!0,this.source.connect(this.context.destination),this.samplesDecoded=0}if(t.length!=this.sampleLength*s)return void console.error("unexpected decoded length");var r=new Float32Array(this.sampleLength),i=new Float32Array(this.sampleLength);t.copyFromChannel(r,0,o?this.sampleLength:0),t.copyFromChannel(i,1,o?this.sampleLength:0),this.audioBuffer.copyToChannel(r,0,e*this.sampleLength),this.audioBuffer.copyToChannel(i,1,e*this.sampleLength),3==this.samplesDecoded&&this.source.start(),this.samplesDecoded++}.bind(this),function(e){this.onError&&this.onError(t,s,i,e)}.bind(this)).catch(function(){})},L.prototype.queue=function(e,t,n){var o=e%this.numSamples;if(o>=this.cleanup&&o<this.cleanup+this.numSamplesDiv4){for(var r=(this.cleanup+this.numSamplesDiv2)%this.numSamples,i=r+this.numSamplesDiv4,s=r;s<i;s++)this.samples[s]=null;this.cleanup=(this.cleanup+this.numSamplesDiv4)%this.numSamples}if(o>this.cleanup+o.numSamples/2){for(var s=this.cleanup;s<this.cleanup+this.numSamples/2;s++)this.samples[s]=null;this.cleanup=(this.cleanup+this.numSamples/2)%this.numSamples}this.samples[o]=t;var a=(o-1+this.numSamples)%this.numSamples,c=(o+1)%this.numSamples;this.decode(a,n),this.decode(o,n),this.decode(c,n)},B.prototype.sendUDP=function(e,t,n){var o=new DataView(new ArrayBuffer(8+e.byteLength+4));o.setUint32(0,o.byteLength-4+n.byteLength),o.setUint32(4,e.byteLength);for(var r=0;r<e.byteLength;r++)o.setUint8(8+r,e[r]);o.setUint32(8+e.byteLength,t);var i=y(new Uint8Array(o.buffer,o.byteOffset,o.byteLength),new Uint8Array(n.buffer,n.byteOffset,n.byteLength));this.udpSocket.write(i)},B.prototype.stop=function(){this.audioQueue&&(this.audioQueue.stop(),this.audioQueue=null),null!=this.udpSocket&&(this.udpSocket.destroy(),this.udpSocket=null),this.sessionUUID=null,this.onStop&&this.onStop()},B.prototype.timeout=function(){delete this.rtpTimeout,this.stop()},B.prototype.resetTimeout=function(){clearTimeout(this.rtpTimeout),this.rtpTimeout=setTimeout(this.timeout.bind(this),5e3)},B.prototype.connectUDP=function(e,t){function n(e,t,n){this.resetTimeout(),n.id<c-32768&&l++,c=n.id;var o=s.slice(0);o=new DataView(o),o.setUint8(o.byteLength-4,n.id%256),this.sendUDP(e,t,o);var r=11,i=new Uint8Array(this.aesIvMask).slice(0);i[r]^=255&n.id,i[r-1]^=n.id>>8&255,i[r-2]^=l%8;var a=new aesjs.ModeOfOperation.ctr(new Uint8Array(this.aesKey),new aesjs.Counter(i)),d=a.decrypt(new Uint8Array(n.payload.slice(10)));this.writeAudio((l<<16)+n.id,d.slice(0));var u={aesKey:this.aesKey,aesIvMask:this.aesIvMask,packet:n,rolloverCount:l};this.audioQueue.queue(n.id,d,u)}function o(e,t,n){var o=n.getUint32(4),r=n.getUint32(10),i=a.slice(0);i=new DataView(i),i.setUint32(4,o+1),i.setUint32(8,o),i.setUint32(16,c),i.setUint32(24,r),i.setUint32(i.byteLength-4,(new Date).getTime()%4294967295),i.setUint32(i.byteLength-16,o+1),this.sendUDP(e,t,i)}function r(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.getInt32(0),i=e.slice(4,4+r),s=t.getInt32(4+r),a=e.slice(4+r+4),c=new DataView(a.buffer,a.byteOffset,a.byteLength),d=U(c);d.marker?o.bind(this)(i,s,c):n.bind(this)(i,s,d)}function*i(){var n=new Date,o="/drm/"+n.getUTCFullYear()+(n.getUTCMonth()+1).pad(2)+n.getUTCDate().pad(2)+"000000";try{var i=yield $.ajax({url:o+"Z.key.der",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error}),s=yield $.ajax({url:o+"Z.der",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error}),a=yield e.newSocket("tcp:53519",yield);if(!a)throw new Error("unable to connect to audio socket");this.udpSocket=a;var c=this.audioQueue=new L(t),l=function(e){console.error("error decoding",e,arguments),this.audioQueue==c&&(this.audioQueue=null),c.stop(),this.udpSocket==a&&(this.udpSocket=null),a.destroy()}.bind(this);c.onError=l,a.onClose=l,a.bufferWrites=!0,yield d(a,password,yield),yield d(a,m(i),yield),yield d(a,m(s),yield),yield d(a,this.castId,yield),u(a,r.bind(this))}catch(e){console.error("error connecting to udp",e)}}this.stop(),this.onStart&&this.onStart(),this.resetTimeout(),this.udpSocket=new I,this.context=t;var s=g("8fce000400000002000000014341535400000064"),a=g("81c90007000000020000000100000000000000ef0000000027bfaff00000000080cf0004000000020400000283aff46335954e18"),c=0,l=0;i.bind(this)().async()},B.prototype.getPort=function(e,t){return this.audioListener.localPort},B.prototype.respond=function(e,t,n){return this.sendMessage(e,t.destinationId,t.sourceId,t.namespace,n)},B.prototype.sendMessage=function(e,t,n,o,r){"Object"==r.constructor.name&&(r=JSON.stringify(r));var i={protocolVersion:0,sourceId:t,destinationId:n,namespace:o,payloadType:"String"===r.constructor.name?0:1};i.payloadType?i.payloadBinary=r.constructor.encode(r).finish():i.payloadUtf8=r;var s=$protobuf.roots.default.cast_channel.CastMessage.encode(i).finish();h(e,s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength))},B.prototype.onMessage={},B.prototype.onMessage["urn:x-cast:com.google.cast.tp.deviceauth"]=function*(e,t){try{var n=new Date,o="/drm/"+n.getUTCFullYear()+(n.getUTCMonth()+1).pad(2)+n.getUTCDate().pad(2)+"000000",r=yield $.ajax({url:o+"Z.sig",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error}),i=yield $.ajax({url:"/drm/cert-aa.der",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error}),s=yield $.ajax({url:"/drm/cert-ab.der",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error}),a=yield $.ajax({url:"/drm/cert-ac.der",type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1,success:yield k,error:yield Error});r=new Uint8Array(r),i=new Uint8Array(i),s=new Uint8Array(s),a=new Uint8Array(a);var c={response:{signature:r,clientAuthCertificate:i,intermediateCertificate:[s,a],signatureAlgorithm:1,senderNonce:null,hashAlgorithm:0,crl:null},error:null};this.respond(e,t,$protobuf.roots.default.cast_channel.DeviceAuthMessage.fromObject(c))}catch(e){console.error("error getting certs",e)}},B.prototype.onJSONMessage={},B.prototype.onJSONMessage.GET_APP_AVAILABILITY=function*(e,t,n){var o={availability:{},requestId:n.requestId,responseType:"GET_APP_AVAILABILITY"};$.each(n.appId,function(e,t){o.availability[t]="APP_UNAVAILABLE"}),o["8E6C866D"]="APP_AVAILABLE",this.respond(e,t,o)},B.prototype.onJSONMessage.STOP=function*(e,t,n){this.sessionUUID=null,yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(e,t,n,!0).async()},B.prototype.onJSONMessage.LAUNCH=function*(e,t,o){this.sessionUUID=n(),yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(e,t,o,!0).async()},B.prototype.onJSONMessage.GET_STATUS=function*(e,t,n){yield this.onJSONMessage.RECEIVER_STATUS.bind(this)(e,t,n).async()},B.prototype.onJSONMessage.RECEIVER_STATUS=function*(e,t,n,o){var r={requestId:n.requestId,status:{userEq:{high_shelf:{frequency:4500,gain_db:0,quality:.707},low_shelf:{frequency:150,gain_db:0,quality:.707},max_peaking_eqs:0,peaking_eqs:[]},volume:{controlType:"master",level:1,muted:!1,stepInterval:.02}},type:"RECEIVER_STATUS"};this.sessionUUID&&(r.status.applications=[{appId:"8E6C866D",displayName:"Audio Mirroring",isIdleScreen:!1,launchedFromCloud:!1,namespaces:[{name:"urn:x-cast:com.google.cast.webrtc"},{name:"urn:x-cast:com.google.cast.media"},{name:"urn:x-cast:com.google.cast.debug"},{name:"urn:x-cast:com.google.cast.remoting"}],sessionId:this.sessionUUID,statusText:"Audio Mirroring",transportId:this.sessionUUID}]),o?this.sendMessage(e,t.destinationId,"*",t.namespace,r):this.respond(e,t,r);
},B.prototype.onMessage["urn:x-cast:com.google.cast.receiver"]=function*(e,t,n){var o=this.onJSONMessage[n.type];return o?void(yield o.bind(this)(e,t,n).async()):void console.error("unhandled cast json message",n)},B.prototype.onMessage["urn:x-cast:com.google.cast.tp.heartbeat"]=function*(e,t){this.respond(e,t,{type:"PONG"})},B.prototype.onMessage["urn:x-cast:com.google.cast.tp.connection"]=function*(e,t){this.respond(e,t,{protocolVersion:0,type:"CONNECTED"})},B.prototype.onMessage["urn:x-cast:com.google.cast.receiver.discovery"]=function*(e,t,n){var o={controlNotifications:1,deviceCapabilities:2052,deviceIconUrl:"/setup/icon.png",deviceId:this.castId,deviceModel:"Google Home",friendlyName:"Kitchen",receiverMetricsId:"5C1CC5224680F4B2",requestId:n.requestId,type:"DEVICE_INFO",wifiProximityId:"FA8FCA7A7F1C"};this.respond(e,t,o)},B.prototype.onMessage["urn:x-cast:com.google.cast.webrtc"]=function*(e,t,n){var o={answer:{castMode:"mirroring",receiverRtcpEventLog:[0],rtpExtensions:[["adaptive_playout_delay"]],sendIndexes:[0],ssrcs:[2],udpPort:8010},result:"ok",seqNum:0,type:"ANSWER"};this.aesKey=g(n.offer.supportedStreams[0].aesKey),this.aesIvMask=g(n.offer.supportedStreams[0].aesIvMask),this.respond(e,t,o)},B.prototype.siphon=function(e){this.pendingAudio=[],this.audioDump=e},B.prototype.writeAudio=function(e,t){if(this.audioDump){this.pendingAudio.push({id:e,decryptedBytes:t}),this.pendingAudio.sort(function(e,t){return e.id-t.id});var n=this.pendingAudio.splice(0,50),o=this.pendingAudio;this.pendingAudio=n;for(var r=0;r<o.length;r++)this.audioDump.dataReceived(o[r].decryptedBytes)}},function(){function e(e,t,n,o){this.socket=e,this.videoOnly=!0;var r=new ByteBuffer(1024);r.put("FLV"),r.put(1),this.videoOnly?r.put(1):r.put(5),r.putInt(9),r.putInt(0),r.flip(),this.socket.dataReceived(r),this.setParameter(t,n,o)}function t(e,t){return e.put(a),e.putDouble(t),e}function n(e,t){var n=c(t);return e.putShort(n.byteLength),e.put(n),e}function o(e,t){return e.putShort(t>>8&65535),e.put(255&t),e}var r=9,i=9,s=18,a=0,d=2,l=8,u=7,h=4,p=1<<h|7,f=2<<h|7;e.prototype.setParameter=function(e,i,a){var c=new ByteBuffer(1024);c.put(s),this.videoOnly?o(c,182):o(c,290),o(c,0),c.putInt(0);var h=c.position;c.put(d),n(c,"onMetaData"),c.put(l),this.videoOnly?c.putInt(7):c.putInt(12),n(c,"duration"),t(c,0),n(c,"width"),t(c,e),n(c,"height"),t(c,i),n(c,"framerate"),t(c,a),n(c,"videocodecid"),t(c,u),n(c,"videodatarate"),t(c,0),this.videoOnly||(n(c,"audiodatarate"),t(c,62.5),n(c,"audiosamplerate"),t(c,5112),n(c,"audiosamplesize"),t(c,8),n(c,"stereo"),c.put(0),n(c,"audiocodecid"),t(c,0)),n(c,"encoder"),c.put(d),n(c,"Lavf52.87.1"),n(c,"filesize"),t(c,0),n(c,""),c.put(r);var p=c.position,f=p-h;c.putInt(f+11),c.flip(),this.socket.dataReceived(c)},e.prototype.addVideoHeader=function(e){for(var t=4;t<e.length&&(0!=e[t+0]||0!=e[t+1]||0!=e[t+2]||1!=e[t+3]);t++);var n=e.subarray(0,t),r=e.subarray(t),s=new ByteBuffer(1024),a=n.length-4+r.length-4+16;s.put(i),o(s,a),o(s,0),s.put(0),o(s,0),s.put(7|p),s.put(0),o(s,0),s.put(1),s.put(n[5]),s.put(n[6]),s.put(n[7]),s.put(255),s.put(225),s.putShort(n.length-4),s.put(n.subarray(4)),s.put(1),s.putShort(r.length-4),s.put(r.subarray(4)),s.putInt(11+a),s.flip(),this.socket.dataReceived(s)},e.prototype.addVideoFrame=function(e,t,n){var r=new ByteBuffer(1024);r.put(i),o(r,5+e.length),this.firstPresentationTimestampMs||(this.firstPresentationTimestampMs=t);var s=t-this.firstPresentationTimestampMs;o(r,s),r.put(s>>24&255),o(r,0),r.put(n?p:f),r.put(1),o(r,0),r.flip();var a=new ByteBuffer(e.length);a.put(e),a.flip(),a.putInt(e.length-4),a.position=0;var c=new ByteBuffer(1024);c.putInt(16+e.length),c.flip(),this.socket.dataReceived(r),this.socket.dataReceived(a),this.socket.dataReceived(c)},window.FlashPackager=e}();var q,H;!function(){function e(){return!window.chrome||!window.chrome.app||!window.chrome.app.window}function t(){ie||(console.log("Created AudioContext"),ie=new AudioContext)}function n(){function t(e){for(var t="",n="abcdef0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}e()||window._lm&&window._lm._il&&q&&!le.udpSocket&&ie&&(console.log("Connecting to UDP"),M.castId||(M.castId=t(40),k()),le.castId=M.castId,le.connectUDP(adbSocketFactory,ie))}function r(e){H&&(e.clientX&&(e.downDelta=Date.now()-Q,X||(X=$("#listener")),e.clientX=e.clientX/X.width()*z,e.clientX>z||e.clientX<0)||e.clientY&&(X||(X=$("#mirror")),e.clientY=e.clientY/X.height()*W,e.clientY>W||e.clientY<0)||H.send(JSON.stringify(e)))}function i(e,t){if(e){if("String"==e.constructor.name){if(e.startsWith("KEYCODE_"))return r({type:"keyevent",keyevent:e}),!0;switch(e){case"VYSOR_SHOW_TITLE_BAR":s();break;case"VYSOR_RECORD_SCREEN":de(t);break;case"VYSOR_SCREENSHOT":chrome.browser.openTab({url:"http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/screenshot-"+Date.now()+".jpg"});break;case"VYSOR_OPEN_DEVICE_SETTINGS":showSettings(),openList();break;case"VYSOR_ROTATE_SCREEN":r({type:"rotate"});break;default:return}return!0}return"Number"==e.constructor.name?(r({type:"keycode",keycode:e}),!0):e.keyevent?(r({type:"keyevent",keyevent:e.keyevent,shift:!!(e.shiftKey&&t&&t.shiftKey)}),!0):e.keycode?(r({type:"keycode",keycode:e.keycode,shift:!!(e.shiftKey&&t&&t.shiftKey)}),!0):void 0}}function s(){return"inkwire"==F?void $(".head").hide():se?(clearTimeout(j),void $(".head").fadeTo(0,1)):($(".head").fadeTo(0,.8),clearTimeout(j),void(j=setTimeout(function(){$(".head").fadeOut()},2e3)))}function a(e,t){if(u())K=z,J=W;else if(window.chrome&&window.chrome.app&&window.chrome.app.window&&c()&&(K=screen.availWidth,J=screen.availHeight),t==z&&e==W){var n=K;K=J,J=n}else{var o;o=z>W?Math.max(innerWidth,innerHeight):Math.min(innerWidth,innerHeight);var r=o*(W/z);K=o,J=r}h()}function c(){return document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullscreenElement||document.fullscreenElement}function u(){return M&&M.displaySettings&&M.displaySettings.freeSize}function h(){var t=innerWidth,n=innerHeight,o=screen.availWidth,r=screen.availHeight;(c()||u()||e())&&(o=t,r=n),K>o&&(K=o,J=W/z*K);var i=0;if(J+ae+se+i>r&&(J=r-ae-se-i,K=z/W*J),K&&J){var s=Math.round(K),a=Math.round(J+ae+se);c()||u()||(re?re=!1:(re=!0,isElectron()?(Math.abs(innerWidth-s)>=2||Math.abs(innerHeight-a)>=2)&&chrome.app.window.current().w.setContentSize(s,a):window.chrome&&window.chrome.app&&window.chrome.app.window&&(Math.abs(innerWidth-s)>=2&&(chrome.app.window.current().innerBounds.width=s),Math.abs(innerHeight-a)>=2&&(chrome.app.window.current().innerBounds.height=a))));var d=(t-K)/2,l=$("#mirror, #listener");l.css("left",d),l.css("top",(n-J-ae+se)/2),$(".foot").width(K),$(".foot").css("left",d),$(".overlay").width(K),$(".overlay").css("left",d),l=$("#mirror, embed, #listener"),l.width(Math.round(K)),l.height(Math.round(J)),$("#dead, #drag, #reconnect").width(K),$("#dead, #drag, #reconnect").height(J+ae+se)}}function p(e){window.chrome&&window.chrome.storage&&chrome.storage.local.get(["vysorUsage","vysorDailyUsage","lastDailyReport"],function(t){var n=t.vysorUsage,o=t.lastDailyReport,r=t.vysorDailyUsage,i=Date.now();if(n||(n=0),r||(r=0),o){if(i>o+864e5){var s=r/36e5;s=Math.round(2*s)/2,s<=24&&s>=0&&(tracker.sendEvent("daily-usage",s.toString()),tracker.sendEvent("daily-usage-licensed",_lm._il)),r=0,chrome.storage.local.set({lastDailyReport:i})}}else chrome.storage.local.set({lastDailyReport:i});var a=n;n+=e,a<72e5&&n>72e5?window._lm&&window._lm._il||T():n>108e5&&R(),r+=e,chrome.storage.local.set({vysorUsage:n,vysorDailyUsage:r})})}function f(){$("#listener").empty();var e,t,n;isElectron()?(e="host",t=null,n="application/x-ppapi-vysor"):(e="pnacl",t="video_decode/pnacl/Release",n=null);var o;common.createNaClModule("video_decode",n,e,t,G,Y,{},function(e){"decoder-falling-behind"==e.data?this.onDecoderFallingBehind&&this.onDecoderFallingBehind():"paint-falling-behind"==e.data||("graphics-context-null"==e.data?x({title:"Graphics Error: assert !context_->is_null()",body:'Vysor encountered an error with your graphics card. There is a possible solution available on the <a href="https://support.vysor.io/support/technical/graphics/" target="_blank">support page</a>.',hideCancel:!0}):"decoder-ready"==e.data&&(this.onReady?this.onReady():console.error("no listener for decoder-ready")))}.bind(this),function(){if(o)return console.error("NACL module has already initalized"),console.error(o),void console.error(new Error("NACL New Initialization Stack"));o=new Error("NACL Initialization Stack"),console.log("NACL module initialized");var e=pe[M.decoder||0];console.log("decoder:",e),common.naclModule.postMessage(e)}.bind(this)),h()}function y(e){e?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozExitFullscreen?document.mozExitFullscreen():document.mskitExitFullscreen&&document.mskitExitFullscreen()}function g(){$(".topbuttonbar>.btn-toolbar").empty(),$(".head").attr("style",ce.titleBar.style);var o=ce.titleBar.buttonGroups;!function(){if(!e()){var o=$("<span id='headphones'></span>");o.attr("class","btn-group btn-group-xs"),o.attr("role","group");var r=$("<a></a>");r.attr("class","btn btn-default fa fa-headphones"),r.attr("title","Mute Phone and Mirror Audio"),r.click(fe("Audio Mirroring",function(e){t(),n()})),o.append(r),$(".topbuttonbar>.btn-toolbar").append(o)}}(),$(o).each(function(e,t){var n=$("<span></span>");n.attr("class","btn-group btn-group-xs"),n.attr("role","group"),$(t).each(function(e,t){var o=$("<a></a>");o.attr("class","btn btn-default fa "+t.class),o.attr("title",t.title),o.click(function(e){i(t.event,e)}),n.append(o)}),$(".topbuttonbar>.btn-toolbar").append(n)})}function m(){$(".foot-row").empty(),$(".foot-row").attr("style",ce.navigationBar.style);var e=ce.navigationBar.buttons,t=Math.round(100/e.length)+"%";$(e).each(function(e,n){var o=$("<span></span>");o.attr("class","fa fa-lg "+n.class),o.attr("title",n.title),o.width(t),o.click(function(){i(n.event)}),$(".foot-row").append(o)})}function k(){D(device.id||device.serialno,M)}function S(){if(window._lm&&(ge||!_lm._il)){for(var e=[],t=1;t<=9;t++)e.unshift(t);var n=e.length+1;$(e).each(function(e){setTimeout(function(){$(".title, title").text("Ad in "+e+" seconds.")},1e3*(n-e))}),r({type:"toast",toast:"Vysor ad in "+n+" seconds.\nUpgrade for an ad free experience."}),setTimeout(function(){$(".title, title").text(M.friendlyName||device.name),H||(clearInterval(me),me=null),tracker.sendEvent("ad-impression"),r({type:"ad"})},1e3*n)}}function I(){window._lm&&(!ge&&_lm._il||me||(clearInterval(me),me=setInterval(S,18e5),S()))}function T(){M.hasRecommendedPro||(M.hasRecommendedPro=!0,k(),x({title:"Vysor Pro",body:"Vysor Pro gives you high quality video, Audio Mirroring, and many more features. Please consider upgrading!",okButton:"Purchase Vysor Pro",ok:function(){_lm.startPurchase()}.bind(this)}))}function R(){M.hasRecommendedRate||(M.hasRecommendedRate=!0,k(),x({title:"Vysor",body:"You seem to be finding Vysor useful. We'd love to hear your thoughts on the Play Store!'",okButton:"Rate Vysor",ok:function(){adbSocketFactory.newSocket("shell:am start -d http://play.google.com/store/apps/details?id=com.koushikdutta.vysor -a android.intent.action.VIEW")}.bind(this)}))}function U(){window._lm&&window._lm._il&&(M.hasRecommendedAudio||(M.hasRecommendedAudio=!0,k(),x({title:"Audio Mirroring",body:'You can mute your Android and Mirror audio to your computer by clicking the headphone icon in the toolbar above: <span class="fa fa-headphones"></span>',okButton:"Mirror Audio",ok:function(){t(),n()}.bind(this)})))}function L(){if(window._lm&&window._lm._il){if(M.hasRecommendedHighQuality)return void U();M.hasRecommendedHighQuality=!0,k(),x({title:"High Quality Video",body:"The video quality can be customized by clicking the Settings icon in the toolbar. Would you like to try the recommended High Quality settings?",okButton:"Use High Quality Settings",ok:function(){$("#high-quality-defaults").click(),k()}.bind(this)})}}var M,F,j,z,W,G,Y,K,J,X,Q,Z,ee,te,ne,oe,re,ie,se=36,ae=48,ce=vysorDefaultSettings,de=function(){};if(!e()){var le=new B;le.onStop=function(){$("#headphones").show()},le.onStart=function(){$("#headphones").hide()}}sharedGlobals.siphonAudio=function(e){te&&(te.destroy(),te=null),e&&(te=isElectron()?{dataReceived:function(t){t.asUint8Array&&(t=t.asUint8Array()),t.constructor==ArrayBuffer&&(t=new Uint8Array(t)),e.dataReceived(t)},destroy:function(){e.destroy()}}:e,le.siphon(te))},sharedGlobals.siphonFlv=function(e){ee&&(ee.destroy(),ee=null,ne=null),e&&(ee=isElectron()?{dataReceived:function(t){t.asUint8Array&&(t=t.asUint8Array()),t.constructor==ArrayBuffer&&(t=new Uint8Array(t)),e.dataReceived(t)},destroy:function(){e.destroy()}}:e,ne=new FlashPackager(ee,G,Y,30),oe=!0,r({type:"resolution",resolution:ue[M.resolution]}))};var ue=[0,.25,.5,.75,1],he=[5e5,75e4,1e6,15e5,2e6,3e6,4e6,6e6,8e6],pe=["software","hardware","hardware_with_fallback"],fe=function(e,t){return t};window.tracker||(window.tracker={sendEvent:function(){},sendAppView:function(){}}),$(window).focus(function(){s(),r({type:"wakeup"})}),$(window).bind("paste",function(e){var t=e.originalEvent.clipboardData.getData("text");t&&t.length&&r({type:"keychar",keychar:t})}),window.addEventListener("mousewheel",function(e){r({type:"scroll",clientX:e.offsetX,clientY:e.offsetY,deltaX:e.wheelDeltaX/100,deltaY:e.wheelDeltaY/100})},!1),$(window).keypress(function(e){var t=String.fromCharCode(e.keyCode);t.length&&r({type:"keychar",keychar:t})}),$(window).keydown(function(e){i(ce.keydown[e.keyCode]||ce.keydown[e.key],e)&&e.stopPropagation()});var ye;$(window).resize(function(e){W&&z&&(clearTimeout(ye),ye=setTimeout(function(){if(u())r({type:"displaySettings",size:innerWidth+"x"+(innerHeight-se-ae),density:M.displaySettings.density});else{var e=innerWidth,t=e*(W/z);K=e,J=t,h()}},500))}),f.prototype.connectH264=function(e,t){return common.naclModule&&common.naclModule.postMessage?void common.naclModule.postMessage({type:"connectH264",hostCommand:o("host:transport:"+e),clientCommand:o("tcp:53517"),password:t+"\n"}):void console.error("connectH264 called before initialization")},f.prototype.decode=function(e,t,n){return common.naclModule&&common.naclModule.postMessage?void common.naclModule.postMessage({buffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength,presentationTimeMs:t,syncFrame:n}):void console.error("decode called before initialization")},sharedGlobals.docReady=function(){function e(){$("#settings-modal").modal("hide");var e=$(o).prop("value");M.friendlyName=e,$(".title, title").text(M.friendlyName||device.name),k();var t=chrome.app.window.get("list");t&&t.contentWindow.updateDeviceName&&t.contentWindow.updateDeviceName(device.id||device.serialno,M.friendlyName||device.name)}function t(e,t){$("#bitrate").prop("selectedIndex",e),$("#resolution").prop("selectedIndex",t),M.bitrate=e;var e=he[e];r({type:"bitrate",bitrate:e}),M.resolution=t;var t=ue[t];r({type:"resolution",resolution:t})}fe=window._lm?function(e,t,n){return function(){return Z&&!_lm._il?(x({title:"Vysor Pro",body:"The "+e+" feature is only available to Vysor Pro users.",okButton:"Upgrade",ok:function(){_lm.startPurchase()}}),void(n&&n.apply(this,arguments))):void t.apply(this,arguments)}}:function(e,t){return t},de=fe("Record Screen",function(e){r($(e.target).hasClass("fa-stop-circle-o")?{type:"stop-recording"}:{type:"start-recording"}),$(e.target).toggleClass("fa-video-camera fa-stop-circle-o")});var n;$(document).on("dragover",function(e){$("#drag").fadeIn(),clearTimeout(n),e.preventDefault(),e.stopPropagation()}),$(document).on("dragleave",function(){n=setTimeout(function(){$("#drag").fadeOut()},1e3)}),$(document).on("drop",fe("Drag and Drop",function(e){if($("#drag").fadeOut(),e.preventDefault(),1!=e.originalEvent.dataTransfer.files.length)return void A("You may only drag and drop one file at a time.");var t=e.originalEvent.dataTransfer.files[0];console.log(t),Adb.push({socketFactory:adbSocketFactory,socket:new C(t),file:"/sdcard/vysor/"+t.name,serialno:device.serialno},function(){var e="am start -a android.intent.action.VIEW -d file:/sdcard/vysor/"+t.name;if(t.type&&t.type.length)e+=" -t "+t.type;else if(t.name.endsWith(".apk"))return void Adb.shell({socketFactory:adbSocketFactory,command:"pm install -r /sdcard/vysor/"+t.name,serialno:device.serialno},function(e){A("APK installation result: "+e.trim())});Adb.shell({socketFactory:adbSocketFactory,command:e,serialno:device.serialno},function(){A("File has been transfered and is being opened on the Android.")})})},function(e){$("#drag").fadeOut(),e.preventDefault()})),common.attachDefaultListeners(),$("#listener").mouseup(function(e){0==e.button&&r({type:e.type,clientX:e.offsetX,clientY:e.offsetY})}),$("#listener").bind("touchstart touchend touchmove",function(e){var t;t="touchstart"==e.type?"mousedown":"touchend"==e.type?"mouseup":"mousemove";var n=e.currentTarget;e.stopPropagation(),e.preventDefault(),e=e.originalEvent;var o=e.touches[0];o||(o=e.changedTouches[0]);var r=document.createEvent("MouseEvent");r.initMouseEvent(t,!0,!0,window,e.detail,o.screenX,o.screenY,o.clientX,o.clientY,!1,!1,!1,!1,0,null),r.isTouch=!0,n.dispatchEvent(r)}),console.log("docReady"),$("#listener").mousedown(function(e){return 0==e.button?(Q=Date.now(),void r({type:e.type,clientX:e.offsetX,clientY:e.offsetY})):void i(ce.mousedown[e.button],e)}),$("#listener").mousemove(function(e){(0!=(1&e.buttons)||e.originalEvent.isTouch)&&r({type:e.type,clientX:e.offsetX,clientY:e.offsetY})}),$(".head").bind("mouseup mousedown mousemove",function(e){e.stopPropagation(),s()}),$("#rotate-button").click(function(){r({type:"rotate"})}),$("#screenshot-button").click(function(){chrome.browser.openTab({url:"http://127.0.0.1:"+httpPort+"/device/"+(device.id||device.serialno)+"/screenshot-"+Date.now()+".jpg"})}),$("#record-button").click(fe("Record Screen",function(){r($("#record-button>span").hasClass("fa-video-camera")?{type:"start-recording"}:{type:"stop-recording"}),$("#record-button>span").toggleClass("fa-video-camera fa-stop-circle-o")})),window.chrome&&window.chrome.app&&window.chrome.app.window||($("#screenshot-button").hide(),$("#record-button").hide()),$("#power").click(function(){r({type:"keycode",keycode:26})}),$("#volume-down").click(function(){r({type:"keycode",keycode:25})}),$("#volume-up").click(function(){r({type:"keycode",keycode:24})}),m(),g(),$("#reconnect-button").click(function(){tryReconnect(),$("#reconnect").hide()}),$("#settings-button").click(function(){showSettings(),openList()}),$("#web-video-stream").click(fe("Web Video Stream",function(){var e=$("#web-video-stream").text();$("#settings-modal").modal("hide"),b(e),setTimeout(function(){_("Copied Web Video Stream Link",e)},500)}));var o=$("#new-display-name");$(o).bind("keypress",function(t){t.stopPropagation();var n=t.which;if(13==n)return e(),!1}),$("#settings-ok").click(e),$("#settings-defaults").click(function(){M=O();try{Z=!1,P(M)}finally{Z=!0}r({type:"displaySettings",size:"reset",density:"reset",resolution:ue[M.resolution]})}),$("#softkeys-check").change(function(){M.showSoftKeys=this.checked,this.checked?($(".foot").show(),ae=48):($(".foot").hide(),ae=0),h()}),$("#pin-title-check").change(function(){M.pinTitleBar=this.checked,se=this.checked?36:0,h(),s()}),$("#fullscreen-check").change(fe("Fullscreen Mode",function(){y(this.checked)},function(){this.checked=!1})),$("#always-on-top-check").change(fe("Always On Top",function(){M.alwaysOnTop=this.checked,window.chrome&&window.chrome.app&&window.chrome.app.window&&chrome.app.window.current().setAlwaysOnTop(this.checked)},function(){this.checked=!1})),$("#bitrate").change(fe("Video Quality",function(){M.bitrate=this.selectedIndex;var e=he[this.selectedIndex];r({type:"bitrate",bitrate:e})},function(){this.selectedIndex=0})),$("#resolution").change(fe("Video Resolution",function(){M.resolution=this.selectedIndex;var e=ue[this.selectedIndex];r({type:"resolution",resolution:e})},function(){this.selectedIndex=0})),$("#decoder").change(fe("Video Decoder",function(){M.decoder=this.selectedIndex,r({type:"resolution",resolution:ue[M.resolution]})},function(){this.selectedIndex=0})),$("#low-quality-defaults").click(fe("Video Quality",function(){t(0,0)})),$("#medium-quality-defaults").click(fe("Video Quality",function(){t(4,2)})),$("#high-quality-defaults").click(fe("Video Quality",function(){t(8,3)})),$("#display-settings").change(fe("Display Settings",function(){var e=function(){var e=V[this.selectedIndex],t=e.freeSize?innerWidth+"x"+(innerHeight-se-ae):e.size;M.displaySettings=e,k(),r({type:"displaySettings",size:t,density:e.density}),this.selectedIndex&&x({title:"Display Settings",body:"Please close the Vysor window before disconnecting your Android to reset your Display Settings.",hideCancel:!0})}.bind(this);return 0==this.selectedIndex?void e():void x({title:"Display Settings",body:"The Display Settings feature is not recommended for non-Nexus devices and may require you to hard reset your device.",okButton:"Continue",ok:function(){$("#notificationModal").one("hidden.bs.modal",e)}.bind(this),cancel:function(){this.selectedIndex=0}.bind(this)})},function(){this.selectedIndex=0})),$("#dim-display").change(fe("Dim Dislay",function(){M.dimDisplay=this.checked,k(),r({type:"dimDisplay",dimDisplay:this.checked})},function(){this.checked=!1})),N(),h(),s(),window.tracker&&tracker.sendAppView("screen")};var ge,me;sharedGlobals.connectionReady=function(){function t(e){if("displaySize"==e.type){var t=z,n=W;z=e.screenWidth,W=e.screenHeight,a(t,n)}else if("encodeSize"==e.type){if(G=e.encodeWidth,Y=e.encodeHeight,!q)return void u();y=w(y,null,1e3,function(){q.onClose=null,q.destroy(),q=null,u()})}else if("clip"==e.type)b(e.clip);else if("password"==e.type);else if("recording"==e.type){var o=e.recording.replace("/sdcard/vysor/","");chrome.browser.openTab({url:"http://127.0.0.1:"+httpPort+"/device/"+(device.id||device.serialno)+"/sdcard-vysor/"+o})}else console.log("unknown",e)}function n(){console.log("input websocket failed, retrying. attempt "+v+" out of "+k),setTimeout(o,500)}function o(){return v++,v==k?void c():void S(function(o){return o?(H=o,q&&(q.onClose=null,q.destroy(),q=null),H.onopen=function(){console.log("input websocket opened"),e()||Adb.reverse({serialno:device.serialno,from:"tcp:8010",to:"tcp:"+le.getPort()},function(e){console.log("audio listener",e)}),H.onerror=null;var t=M.displaySettings||{},n=t.freeSize?innerWidth+"x"+(innerHeight-ae-se):"reset"==t.size?null:t.size,o="reset"==t.density?null:t.density;r({type:"password",password:password,resolution:ue[M.resolution],size:n,density:o,dimDisplay:M.dimDisplay})},H.onerror=n,void(H.onmessage=function(e){console.log("event from phone",e.data);var n=JSON.parse(e.data);t(n)})):void n()})}function i(){window.tryReconnect?$("#reconnect").fadeIn():$("#dead").fadeIn(),$("#listener").empty()}function c(e){function t(){console.log("starting read loop");var t=setTimeout(function(){A("Your Android screen is unavailable right now. This can sometimes be resolved by rebooting your Android.")},5e3);I(),e.read(4,function(e){clearTimeout(t),L(),l(e),window.chrome&&window.chrome.storage&&r({type:"bitrate",bitrate:he[M.bitrate]})})}function n(){s=w(s,null,1e3,function(){console.log("requesting sync frame"),r({type:"sync-frame"})})}if(console.log("received socket",e),q&&(q.onClose=null,q.destroy(),q=null),q=e,$(".overlay").fadeOut(),!e)return void i();e.name="h264",e.onClose=function(){try{i()}catch(e){console.log("eating error that occurs with jquery if window is being closed...")}console.log("closing input "),H&&H.close(),H=null,q==e&&(q=null)};var o,s,a=new f,c=!0,d=function(t){var n=t.subarray(8),r=new DataView(t.buffer,t.byteOffset,8),i=r.getUint32(0,!0),s=0!=r.getUint32(4,!0);ne&&e==q&&(c?ne.addVideoHeader(n):oe||ne.addVideoFrame(n,i,s)),c&&(oe=!1,c=!1),a.decode(n,i,s);var d=Date.now();if(o){var l=d-o;l>6e4&&(o=d,p(l))}else o=d,tracker.sendEvent("view-device");u()},l=function(t){if(4!=t.byteLength)throw new Error("WTF");var n=new DataView(t.buffer,t.byteOffset,4),o=n.getInt32(0,!0);e.read(o,d)},u=function(){e.read(4,l)};a.onDecoderFallingBehind=n,a.onReady=t}function u(){adbSocketFactory.newSocket("tcp:53517",function(e){return e?void d(e,password,function(){c(e)}):void c()})}console.log("connectionReady"),$("#loading").fadeIn(),$("#dead, #reconnect").fadeOut(),s(),device||console.error("device not defined on window object?"),window.chrome&&window.chrome.storage&&window.chrome.storage.local&&chrome.storage.local.get("vysorSettings",function(e){ce={},Object.assign(ce,vysorDefaultSettings,e.vysorSettings);var t=ce.devices&&ce.devices[device.id||device.serialno]||{};ce.navigationBar=t.navigationBar||ce.navigationBar,ce.titleBar=t.titleBar||ce.titleBar,Object.assign(ce.keydown,t.keydown),Object.assign(ce.mousedown,t.mousedown),m(),g()});var y,v=0,k=20;window.adbSocketFactory||("adb-client"==adbSocketFactoryFactory.type?adbSocketFactory=Adb.createSocketFactory(adbSocketFactoryFactory.arguments.serialno):console.error("unknown adb socket factory factory",adbSocketFactoryFactory.type));var S=function(e){adbSocketFactory.newSocket("tcp:53518",function(t){function n(e){i||(i=!0,t.onopen&&t.onopen()),t.onmessage&&t.onmessage({data:e}),l(t,n)}if(!t)return void e();var o,r=function(){if(o){var e;o.length?e=o.shift():o=null,e&&d(t,e,r)}};t.close=t.destroy.bind(t),t.send=function(e){return o?void o.push(e):(o=[],void d(t,e,r))}.bind(t),e(t);var i=!1;t.onClose=function(){i||t.onerror&&t.onerror()},l(t,n)})};console.log("init"),E(device.id||device.serialno,function(e){M=e,o(),window._lm&&window._lm._il||(M.bitrate=0,M.resolution=0,M.alwaysOnTop=!1),P(M),Z=!0,h(),$(".title, title").text(M.friendlyName||device.name)})},window.chrome&&window.chrome.app&&window.chrome.app.window?($(document).ready(docReady),function(){function e(){if(!c())return showSettings(),_(null,"Fullscreen Mode must be enabled in Settings."),void setTimeout(function(){chrome.app.window.current().restore()},1e3)}chrome.app.window.current().onFullscreened.addListener(e),chrome.app.window.current().onMaximized.addListener(e)}()):(device={id:"web",serialno:"web"},F=v("mode"),"inkwire"==F&&(device={id:"inkwire",serialno:"inkwire"}),$(document).ready(function(){docReady(),"inkwire"==F&&($("title").text("Inkwire"),se=0,$(".foot").hide(),ae=0,h());var e=v("registrationId");if(e){var t=v("senderId");t||(t="64148182473");var n=v("audio");"inkwire"==F&&(t="3505780036",n=!0);var o;GcmRtcManager.start({3505780036:"AIzaSyDt0GimPRhk8_d_4XjOYzQUn50UkvXhMtE",64148182473:"AIzaSyDd7k1v017osyYbIC92fyf-36s3pv0z73U"},{iceServers:[{url:"turn:n0.clockworkmod.com",username:"foo",credential:"bar"},{url:"turn:n1.clockworkmod.com",username:"foo",credential:"bar"}]},function(r){console.log("attempting to connect to vysor from web"),o=r,o.sharedDevices={};var i=v("channel");o.connect({senderId:t,registrationId:e,port:i},function(o){console.log("web connection established"),n&&(console.log("attempting audio"),r.connect({senderId:t,registrationId:e,port:i,audio:!0},function(e,t){console.log("got audio");var n=new Audio;t.stream.getAudioTracks()[0];n.src=(URL||webkitURL||mozURL).createObjectURL(t.stream),n.play()})),console.log("gcmConn",o),adbSocketFactory=o,console.log("starting remote vysor daemon"),o.newSocket("webstart",function(e){console.log("waiting for password"),l(e,function(t){e.destroy(),console.log("got password",t),window.password=t,connectionReady()})})})})}})),sharedGlobals.updateWindowStatusText=function(e){$("#loading-text").html(e)},sharedGlobals.showSettings=function(){var e=$("#new-display-name");e.prop("value",M.friendlyName),e.prop("placeholder",device.name),$("#web-video-stream").text("http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/video.flv"),$("#web-audio-stream").text("http://127.0.0.1:"+window.httpPort+"/device/"+(device.id||device.serialno)+"/audio.adts"),$("#settings-modal").modal()}}(),t[""]=e}({},function(){return this}());
